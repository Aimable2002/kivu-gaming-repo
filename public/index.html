<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Kivu Super App ‚Äî Market, Travel & Services (Rwanda, East Africa)</title>
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" href="favicon.png?v=2">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Kivu">
    <link rel="apple-touch-icon" href="favicon.png?v=2">
    <meta name="description" content="The all-in-one platform for East Africa. Buy & sell machinery, book bus tickets, listen to music, and find jobs in Kigali, Nairobi, and Kampala. Gura, Gurisha, Tembera.">
    <meta name="keywords" content="Rwanda, Kigali, Marketplace, Bus Tickets, Music, East Africa, Heavy Machines, Gura, Gurisha, Super App">
    
    <meta property="og:title" content="Kivu Super App ‚Äî One Account. Infinite Possibilities.">
    <meta property="og:description" content="Join the biggest digital ecosystem in East Africa. Market, Travel, Music, and more.">
    <meta property="og:image" content="https://kivu.site/preview-image.jpg"> <meta name="apple-mobile-web-app-capable" content="yes">
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script type="importmap">
  {
    "imports": {
      "@google/generative-ai": "https://esm.run/@google/generative-ai"
    }
  }
</script>
<script type="module">
  import { GoogleGenerativeAI } from "@google/generative-ai";
  // –î–µ–ª–∞–µ–º –¥–æ—Å—Ç—É–ø–Ω—ã–º –≥–ª–æ–±–∞–ª—å–Ω–æ –¥–ª—è script.js
  window.GoogleGenerativeAI = GoogleGenerativeAI;
</script>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.css" />
    <script src="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.js"></script>

    <link rel="stylesheet" href="style.css">
    
   <style> 
        /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–∞—Ä—Ç (–æ—Å—Ç–∞–≤–ª—è–µ–º) */
        .leaflet-pane { z-index: 0 !important; } 
        .leaflet-top, .leaflet-bottom { z-index: 10 !important; } 

        /* –î–û–ë–ê–í–ò–¢–¨ –í–û–¢ –≠–¢–û: –°–∫—Ä—ã–≤–∞–µ–º –±–µ–ª—É—é —Ç–∞–±–ª–∏—á–∫—É —Å –º–∞—Ä—à—Ä—É—Ç–æ–º */
        .leaflet-routing-container { display: none !important; }
    </style>

    <script>
        tailwind.config = {
            theme: { extend: { colors: { kivu: { teal: '#00695C', dark: '#004D40', bg: '#F5F7FA', orange: '#FF6600', gold: '#FFD700', danger: '#DC2626' } }, fontSize: { 'xxs': '0.65rem' } } }
        }
    </script>
</head>
<body class="bg-gray-100 font-sans text-gray-800 h-[100dvh] w-screen overflow-hidden flex justify-center">
    <div class="w-full max-w-md h-[100dvh] bg-kivu-bg flex flex-col relative shadow-2xl overflow-hidden mx-auto">
        
        <div id="super-app-launcher" class="h-full overflow-y-auto no-scrollbar bg-white flex flex-col relative z-10 pb-10">
            <div class="bg-kivu-dark text-white p-6 pt-10 rounded-b-[30px] shadow-lg mb-4">
                <div class="flex justify-between items-start mb-4">
                    <div><h1 class="font-bold text-2xl italic tracking-tighter">üá∑üáºKivu Super App</h1><p class="text-xs opacity-80 text-gray-200">One Account. Infinite Possibilities.</p></div>
                    <div>
    <div id="launcher-guest-btns" class="flex gap-2 relative z-100">
        <button onclick="toggleAuthModal(); switchAuthTab('signin')" class="bg-white/10 border border-white/20 text-white text-[10px] font-bold px-3 py-2 rounded-lg hover:bg-white/20 transition backdrop-blur-sm">
            Log In
        </button>
        <button onclick="toggleAuthModal(); switchAuthTab('signup')" class="bg-white text-kivu-dark text-[10px] font-bold px-3 py-2 rounded-lg shadow-lg hover:bg-gray-100 transition">
            Sign Up
        </button>
    </div>

    <div id="launcher-user-badge" class="hidden flex items-center gap-3 select-none">
        <div class="text-right">
            <p class="text-[9px] text-gray-300 uppercase font-bold">Welcome,</p>
            <p id="launcher-username" class="font-bold text-sm text-white leading-none">User</p>
        </div>
        <div class="w-10 h-10 rounded-full bg-white text-kivu-dark flex items-center justify-center font-bold text-lg border-2 border-white/20 shadow-lg">
            <i class="fas fa-user"></i>
        </div>
    </div>
</div>
                </div>
                <div class="grid grid-cols-2 gap-3 mt-4">
                    <button onclick="openSuperModule('maps')" class="bg-white/10 p-3 rounded-xl text-left hover:bg-white/20 transition active:scale-95 border border-white/5"><div class="text-[10px] uppercase text-gray-300 font-bold mb-1"><i class="fas fa-map-marked-alt mr-1"></i> Maps</div><div class="font-bold text-sm text-white">üóìÔ∏èEvents & ‚òÄÔ∏èWeather</div></button>
                    <button onclick="openFinanceModule()" class="bg-white/10 p-3 rounded-xl text-left hover:bg-white/20 transition active:scale-95 border border-white/5">
    <div class="text-[10px] uppercase text-gray-300 font-bold mb-1"><i class="fas fa-building-columns mr-1"></i> Finance</div>
    <div class="font-bold text-sm text-white">üè¶Banks & üõ°Ô∏èInsurance</div>
</button>
                </div>
            </div>
            <div class="grid grid-cols-4 gap-4 p-4">
    
    <div onclick="openSuperModule('market')" class="flex flex-col items-center gap-2 cursor-pointer active:scale-95 transition">
        <div class="w-14 h-14 rounded-2xl bg-green-100 text-green-700 flex items-center justify-center text-2xl shadow-sm"><i class="fas fa-store"></i></div>
        <span class="text-[10px] font-bold text-center text-gray-700 leading-tight">Market</span>
    </div>

    <div onclick="openSuperModule('auction')" class="flex flex-col items-center gap-2 cursor-pointer active:scale-95 transition">
        <div class="w-14 h-14 rounded-2xl bg-orange-100 text-orange-600 flex items-center justify-center text-2xl shadow-sm"><i class="fas fa-tractor"></i></div>
        <span class="text-[10px] font-bold text-center text-gray-700 leading-tight">Machines</span>
    </div>

    <div onclick="openSuperModule('travel')" class="flex flex-col items-center gap-2 cursor-pointer active:scale-95 transition">
        <div class="w-14 h-14 rounded-2xl bg-cyan-600 text-white flex items-center justify-center text-2xl shadow-lg border-b-4 border-cyan-800">
            <i class="fas fa-bus"></i>
        </div>
        <span class="text-[10px] font-bold text-center text-gray-700 leading-tight">Travel</span>
    </div>

    <div onclick="openSuperModule('music')" class="flex flex-col items-center gap-2 cursor-pointer active:scale-95 transition">
        <div class="w-14 h-14 rounded-2xl bg-gradient-to-br from-green-900 to-black text-white flex items-center justify-center text-2xl shadow-lg border border-green-800 relative">
            <i class="fas fa-music"></i>
            <div class="absolute top-1 right-1 w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
        </div>
        <span class="text-[10px] font-bold text-center text-gray-700 leading-tight">Vibe</span>
    </div>

    <button class="flex flex-col items-center gap-2 cursor-pointer" onclick="window.location.href='/arcade.html'">
        <div class="w-14 h-14 rounded-2xl bg-purple-600 text-white flex items-center justify-center text-2xl shadow-lg border-b-4 border-purple-800">
            <i class="fas fa-gamepad"></i>
        </div>
        <span class="text-[10px] font-bold text-center text-gray-700 leading-tight">Arcade</span>
    </button>


    <div class="col-span-4 relative mt-2 rounded-xl overflow-hidden">
        
        <div onclick="showToast('Coming Soon üöß')" class="absolute inset-0 z-20 bg-gray-100/60 backdrop-blur-[2px] flex items-center justify-center cursor-not-allowed">
            <div class="bg-black/80 text-white px-6 py-3 rounded-full shadow-2xl transform hover:scale-110 transition duration-300 border border-white/20">
                <span class="font-bold text-sm uppercase tracking-widest">üöÄ Soon...</span>
            </div>
        </div>

        <div class="grid grid-cols-4 gap-4 p-2 opacity-50 pointer-events-none filter grayscale-[0.5]">
            
            <div class="flex flex-col items-center gap-2">
                <div class="w-14 h-14 rounded-2xl bg-emerald-900 text-emerald-400 flex items-center justify-center text-2xl shadow-sm border border-emerald-800"><i class="fas fa-chart-line"></i></div>
                <span class="text-[10px] font-bold text-center text-gray-700 leading-tight">Invest</span>
            </div>

            <div class="flex flex-col items-center gap-2">
                <div class="w-14 h-14 rounded-2xl bg-teal-900 text-teal-400 flex items-center justify-center text-2xl shadow-lg border-2 border-teal-700 relative overflow-hidden"><i class="fas fa-wallet relative z-10"></i></div>
                <span class="text-[10px] font-bold text-center text-gray-700 leading-tight">Pay</span>
            </div>

            <div class="flex flex-col items-center gap-2">
                <div class="w-14 h-14 rounded-2xl bg-blue-600 text-white flex items-center justify-center text-2xl shadow-md border-b-4 border-blue-800"><i class="fas fa-landmark"></i></div>
                <span class="text-[10px] font-bold text-center text-gray-700 leading-tight">Gov</span>
            </div>

            <div class="flex flex-col items-center gap-2">
                <div class="w-14 h-14 rounded-2xl bg-red-800 text-white flex items-center justify-center text-2xl shadow-lg border-2 border-red-500"><i class="fas fa-play"></i></div>
                <span class="text-[10px] font-bold text-center text-gray-700 leading-tight">Play</span>
            </div>

            <div class="flex flex-col items-center gap-2">
                <div class="w-14 h-14 rounded-2xl bg-indigo-100 text-indigo-600 flex items-center justify-center text-2xl shadow-sm"><i class="fas fa-comments"></i></div>
                <span class="text-[10px] font-bold text-center text-gray-700 leading-tight">Forum</span>
            </div>

            <div class="flex flex-col items-center gap-2">
                <div class="w-14 h-14 rounded-2xl bg-blue-100 text-blue-600 flex items-center justify-center text-2xl shadow-sm"><i class="fas fa-graduation-cap"></i></div>
                <span class="text-[10px] font-bold text-center text-gray-700 leading-tight">Learn</span>
            </div>

            <div class="flex flex-col items-center gap-2">
                <div class="w-14 h-14 rounded-2xl bg-teal-600 text-white flex items-center justify-center text-2xl shadow-lg border-b-4 border-teal-800">
                    <i class="fas fa-language"></i>
                </div>
                <span class="text-[10px] font-bold text-center text-gray-700 leading-tight">Lingo<br>Learn</span>
            </div>

            <div class="flex flex-col items-center gap-2">
                <div class="w-14 h-14 rounded-2xl bg-orange-500 text-white flex items-center justify-center text-2xl shadow-lg border-b-4 border-orange-700">
                    <i class="fas fa-utensils"></i>
                </div>
                <span class="text-[10px] font-bold text-center text-gray-700 leading-tight">Kivu<br>Kitchen</span>
            </div>

            <div class="flex flex-col items-center gap-2">
                <div class="w-14 h-14 rounded-2xl bg-black text-white flex items-center justify-center text-2xl shadow-lg border border-gray-700 relative">
                    <i class="fas fa-video"></i>
                </div>
                <span class="text-[10px] font-bold text-center text-gray-700 leading-tight">Kivu<br>Stars</span>
            </div>

            <div class="flex flex-col items-center gap-2">
                <div class="w-14 h-14 rounded-2xl bg-gray-800 text-white flex items-center justify-center text-2xl shadow-lg border border-gray-600 relative">
                    <i class="fas fa-toolbox"></i>
                </div>
                <span class="text-[10px] font-bold text-center text-gray-700 leading-tight">Kivu<br>Tools</span>
            </div>

            <div class="flex flex-col items-center gap-2">
                <div class="w-14 h-14 rounded-2xl bg-gray-900 text-red-500 flex items-center justify-center text-2xl shadow-lg border border-red-900 relative overflow-hidden">
                    <i class="fas fa-user-secret relative z-10"></i>
                </div>
                <span class="text-[10px] font-bold text-center text-gray-700 leading-tight">Priv√©</span>
            </div>

        </div>
    </div>

</div>

            </div> 
            <div class="mt-auto p-4 pb-6 space-y-3">
    
    <div onclick="openVisionModal()" class="bg-indigo-600 rounded-xl p-4 text-white shadow-lg relative group overflow-hidden cursor-pointer hover:scale-[1.01] transition-transform duration-300">
        
        <button id="admin-edit-vision-btn" onclick="openContentEditor('vision'); event.stopPropagation();" class="hidden absolute top-2 right-2 bg-white/20 hover:bg-white text-white hover:text-indigo-600 p-1.5 rounded-full z-20 transition">
            <i class="fas fa-pencil-alt text-[10px]"></i>
        </button>

        <div class="relative z-10">
            <h3 class="font-bold text-lg flex items-center gap-2">
                <i class="fas fa-eye text-indigo-300"></i> <span id="display-vision-title">Vision 2050</span>
            </h3>
            <p class="text-[10px] opacity-80 line-clamp-1 mt-0.5" id="display-vision-text">Loading...</p>
        </div>
        
        <div class="absolute -bottom-4 -right-4 w-20 h-20 bg-white/10 rounded-full blur-xl"></div>
    </div>

    <div class="flex justify-center items-center text-[10px] font-bold text-gray-400">
        <button onclick="openInfoPanel('about')" class="hover:text-kivu-teal transition px-2 py-2">‚ÑπÔ∏èAbout Us</button>
        <span class="text-gray-300">/</span>
        <button onclick="openInfoPanel('contact')" class="hover:text-blue-600 transition px-2 py-2">üí¨Contact</button>
        <span class="text-gray-300">/</span>
        <button onclick="openInfoPanel('partner')" class="hover:text-orange-500 transition px-2 py-2">üíºPartnership</button>
    </div>

</div>

<div id="info-panel-modal" class="hidden fixed inset-0 z-[100] bg-black/60 backdrop-blur-sm flex items-end justify-center fade-in">
    <div class="bg-white w-full max-w-md rounded-t-2xl p-6 slide-up relative">
        <button onclick="document.getElementById('info-panel-modal').classList.add('hidden')" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600">
            <i class="fas fa-times text-xl"></i>
        </button>
        
        <button id="admin-edit-info-btn" class="hidden absolute top-4 right-12 text-blue-600 font-bold text-xs bg-blue-50 px-2 py-1 rounded border border-blue-200 hover:bg-blue-100">
            <i class="fas fa-edit"></i> Edit Text
        </button>

        <div class="flex justify-between items-center mb-4 pr-8">
    <h3 id="info-panel-title" class="text-xl font-bold text-gray-900 flex items-center gap-2">Title</h3>
    
    <div class="flex gap-3"> <a href="https://www.instagram.com/kivu_super_app?igsh=MTA3MGZnOTliYnF5Nw==" target="_blank" class="text-pink-600 hover:scale-110 transition text-xl">
            <i class="fab fa-instagram"></i>
        </a>

        <a href="https://www.facebook.com/share/1GmREu19aS/" target="_blank" class="text-blue-600 hover:scale-110 transition text-xl">
            <i class="fab fa-facebook"></i>
        </a>

        <a href="https://www.linkedin.com/in/kivu-super-app-940766397?utm_source=share&utm_campaign=share_via&utm_content=profile&utm_medium=android_app" target="_blank" class="text-blue-800 hover:scale-110 transition text-xl">
            <i class="fab fa-linkedin"></i>
        </a>

        <a href="https://m.youtube.com/channel/UCPmz4nvihq7joqwy3W58vTw" target="_blank" class="text-red-600 hover:scale-110 transition text-xl">
            <i class="fab fa-youtube"></i>
        </a>
        
        <a href="https://x.com/Kivu_Super_App" target="_blank" class="text-black hover:scale-110 transition text-xl">
            <i class="fab fa-twitter"></i>
        </a>

        <a href="https://wa.me/250791893060" target="_blank" class="text-green-500 hover:scale-110 transition text-xl">
            <i class="fab fa-whatsapp"></i>
        </a>
    </div>
</div>
        
        <div class="bg-gray-50 p-4 rounded-xl border border-gray-100 text-sm text-gray-700 whitespace-pre-line leading-relaxed h-64 overflow-y-auto" id="info-panel-content">
            Loading...
        </div>

        <form id="contact-form" onsubmit="sendEmail(event)" class="hidden space-y-3 mt-2 h-64 overflow-y-auto">
            <div>
                <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Your Name</label>
                <input type="text" name="user_name" required class="w-full border border-gray-200 rounded p-2 text-sm bg-gray-50">
            </div>
            <div>
                <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Your Email</label>
                <input type="email" name="user_email" required class="w-full border border-gray-200 rounded p-2 text-sm bg-gray-50">
            </div>
            <div>
                <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Message</label>
                <textarea name="message" rows="4" required class="w-full border border-gray-200 rounded p-2 text-sm bg-gray-50"></textarea>
            </div>
            <button type="submit" class="w-full bg-indigo-600 text-white font-bold py-3 rounded-lg shadow-md">
                Send Message
            </button>
            <p id="email-status" class="text-xs text-center mt-2 hidden"></p>
        </form>
        </div>
</div>

<div id="cms-editor-modal" class="hidden fixed inset-0 z-[200] bg-black/80 flex items-center justify-center p-4 fade-in">
    <div class="bg-white w-full max-w-sm rounded-xl p-5 shadow-2xl relative slide-up">
        <h3 class="font-bold text-lg mb-4 text-gray-800">Edit Content (Admin)</h3>
        
        <div id="cms-title-group">
            <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Title</label>
            <input id="cms-input-title" type="text" class="w-full border border-gray-300 rounded-lg p-3 text-sm mb-3 font-bold focus:border-indigo-500 outline-none">
        </div>
        
        <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Text Content</label>
        <textarea id="cms-input-text" rows="6" class="w-full border border-gray-300 rounded-lg p-3 text-sm mb-4 focus:border-indigo-500 outline-none"></textarea>
        
        <input type="hidden" id="cms-current-key-title">
        <input type="hidden" id="cms-current-key-text">

        <div class="flex gap-2">
            <button onclick="document.getElementById('cms-editor-modal').classList.add('hidden')" class="flex-1 bg-gray-100 text-gray-700 py-3 rounded-lg font-bold text-sm">Cancel</button>
            <button onclick="saveCmsContent()" class="flex-1 bg-indigo-600 text-white py-3 rounded-lg font-bold text-sm shadow hover:bg-indigo-700">Save Changes</button>
        </div>
    </div>
</div>
<div id="module-market" class="hidden h-full flex flex-col bg-gray-100 absolute inset-0 z-[60]">
            <header class="bg-kivu-dark text-white pt-4 pb-3 shrink-0 z-20 shadow-md">
            <div class="px-3 flex items-center gap-2">
                
                <button onclick="closeSuperModule()" class="flex items-center gap-2 mr-1 text-white active:scale-95 transition shrink-0 group">
                    <div class="w-10 h-10 rounded-full bg-white/20 flex items-center justify-center group-hover:bg-white/30">
                        <i class="fas fa-arrow-left text-lg"></i>
                    </div>
                    <span class="font-bold text-2xl italic tracking-tighter">Market</span>
                </button>
                <div class="flex-1 relative">
                    <input type="text" oninput="currentProductPage = 0; renderProducts(this.value)" class="block w-full pl-9 pr-4 py-2.5 rounded-full text-sm text-gray-900 bg-white border-0 focus:ring-2 focus:ring-kivu-orange placeholder-gray-500 shadow-inner" placeholder="Search...">
                    <i class="fas fa-search absolute left-3 top-3 text-gray-400 text-sm"></i>
                </div>
                
                <button onclick="toggleSettings()" class="p-2 relative hover:bg-white/10 rounded-full transition">
                    <i class="fas fa-cog text-xl"></i>
                </button>
            </div>
        </header>

        <main class="flex-1 overflow-y-auto no-scrollbar relative" id="main-container">
            <div id="subpage-address" class="hidden absolute inset-0 z-30 bg-gray-50 flex flex-col slide-up">
                <div class="bg-white p-4 shadow-sm flex items-center gap-3"><button onclick="closeSubPage('subpage-address')"><i class="fas fa-arrow-left text-lg text-gray-600"></i></button><h2 class="font-bold text-lg">My Address</h2></div>
                <div class="p-4 overflow-y-auto pb-24">
                    <div id="address-display" class="hidden mb-6">
                        <div class="addr-card">
                            <i class="fas fa-map-marker-alt addr-icon"></i>
                            <div class="addr-content">
                                <div class="text-xs text-gray-400 uppercase font-bold mb-1">Primary Address</div>
                                <p class="text-sm font-bold text-gray-800" id="addr-show-full">...</p>
                            </div>
                            <button onclick="editAddress()" class="addr-edit"><i class="fas fa-pencil-alt"></i></button>
                        </div>
                    </div>
                    <div id="address-form" class="bg-white p-4 rounded shadow-sm">
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Country</label>
                        <select id="addr-country" class="w-full border border-gray-200 rounded p-3 text-sm mb-3 bg-white">
                            <option>Rwanda</option><option>Kenya</option><option>Uganda</option>
                        </select>
                        <div class="flex gap-3 mb-3">
                            <div class="flex-1"><label class="block text-xs font-bold text-gray-500 uppercase mb-2">City</label><input type="text" id="addr-city" class="w-full border border-gray-200 rounded p-3 text-sm"></div>
                            <div class="w-1/3"><label class="block text-xs font-bold text-gray-500 uppercase mb-2">Zip/Index</label><input type="text" id="addr-zip" class="w-full border border-gray-200 rounded p-3 text-sm"></div>
                        </div>
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Street Address</label>
                        <input type="text" id="addr-street" class="w-full border border-gray-200 rounded p-3 text-sm mb-3" placeholder="e.g. KN 5 Rd">
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-2">House/Apt Number</label>
                        <input type="text" id="addr-house" class="w-full border border-gray-200 rounded p-3 text-sm mb-6" placeholder="e.g. House 42">
                        <button onclick="saveAddress()" class="w-full bg-kivu-teal text-white font-bold py-3 rounded text-sm shadow">Save Address</button>
                    </div>
                </div>
            </div>

            <div id="subpage-support" class="hidden absolute inset-0 z-30 bg-gray-50 flex flex-col slide-up">
                <div class="bg-kivu-teal text-white p-4 flex items-center gap-3 shadow-md shrink-0"><button onclick="closeSubPage('subpage-support')"><i class="fas fa-arrow-left text-lg"></i></button><h2 class="font-bold text-lg">Help Center</h2></div>
                <div class="p-5 flex-1 overflow-y-auto pb-24">
                    <div class="bg-white rounded-lg shadow-sm p-4 mb-4">
                        <p class="text-xs text-gray-500 mb-4 font-bold uppercase">Submit a ticket</p>
                        
                        <div class="flex gap-3 mb-3">
                            <input type="text" id="tick-fname" placeholder="First Name" class="flex-1 border rounded p-2 text-sm">
                            <input type="text" id="tick-lname" placeholder="Last Name" class="flex-1 border rounded p-2 text-sm">
                        </div>
                        <input type="tel" id="tick-phone" placeholder="Phone Number" class="w-full border rounded p-2 text-sm mb-3">
                        <select id="tick-type" class="w-full border rounded p-2 text-sm mb-3 bg-white">
                            <option value="" disabled selected>Select Issue Type</option>
                            <option value="order">Order Issue</option>
                            <option value="payment">Payment Problem</option>
                            <option value="account">Account Access</option>
                            <option value="other">Other</option>
                        </select>
                        <textarea id="tick-msg" rows="5" class="w-full border mb-4 p-2 text-sm" placeholder="Describe your problem..."></textarea>
                        <button onclick="submitTicket()" class="w-full bg-kivu-teal text-white font-bold py-3 rounded-lg shadow-md">Submit Ticket</button>
                    </div>
                </div>
            </div>

            <div id="subpage-favorites" class="hidden absolute inset-0 z-30 bg-gray-50 flex flex-col slide-up"><div class="bg-white p-4 shadow-sm flex items-center gap-3"><button onclick="closeSubPage('subpage-favorites')"><i class="fas fa-arrow-left text-lg text-gray-600"></i></button><h2 class="font-bold text-lg">Favorites</h2></div><div class="flex-1 flex flex-col items-center justify-center text-gray-400"><i class="far fa-heart text-4xl mb-3"></i><p>No favorites.</p></div></div>
            <div id="subpage-orders" class="hidden absolute inset-0 z-30 bg-gray-50 flex flex-col slide-up"><div class="bg-white p-4 shadow-sm flex items-center gap-3 sticky top-0 z-10"><button onclick="closeSubPage('subpage-orders')"><i class="fas fa-arrow-left text-lg text-gray-600"></i></button><h2 class="font-bold text-lg">My Orders</h2></div><div id="orders-list-content" class="p-3 pb-24 flex flex-col gap-3"></div></div>
            <div id="subpage-my-ads" class="hidden absolute inset-0 z-30 bg-gray-50 flex flex-col slide-up"><div class="bg-white p-4 shadow-sm flex items-center gap-3 sticky top-0 z-10"><button onclick="closeSubPage('subpage-my-ads')"><i class="fas fa-arrow-left text-lg text-gray-600"></i></button><h2 class="font-bold text-lg">My Ads</h2></div><div id="my-ads-list" class="p-2 grid grid-cols-2 gap-2 overflow-y-auto pb-24"></div></div>
            <div id="subpage-profile" class="hidden absolute inset-0 z-30 bg-gray-50 flex flex-col slide-up"><div class="bg-white p-4 shadow-sm flex items-center gap-3"><button onclick="closeSubPage('subpage-profile')"><i class="fas fa-arrow-left text-lg text-gray-600"></i></button><h2 class="font-bold text-lg">Profile Settings</h2></div><div class="p-5"><label class="block text-xs font-bold text-gray-500 uppercase mb-2">Full Name</label><input type="text" id="prof-name" class="w-full border rounded p-3 mb-4 text-sm"><label class="block text-xs font-bold text-gray-500 uppercase mb-2">Phone</label><input type="tel" id="prof-phone" class="w-full border rounded p-3 mb-4 text-sm"><label class="block text-xs font-bold text-gray-500 uppercase mb-2">Country</label><select id="prof-country" class="w-full border rounded p-3 mb-4 text-sm bg-white" onchange="updateCitySelect('prof-city', this.value)"></select><label class="block text-xs font-bold text-gray-500 uppercase mb-2">City</label><select id="prof-city" class="w-full border rounded p-3 mb-6 text-sm bg-white"></select><button onclick="updateProfile()" class="w-full bg-kivu-teal text-white font-bold py-3 rounded-lg shadow-md">Save Changes</button></div></div>

            <div id="page-home" class="min-h-full pb-24"> <div class="bg-white py-3 px-2 mb-2 overflow-x-auto no-scrollbar flex gap-4 border-b border-gray-200 shadow-sm sticky top-0 z-10" id="quick-cat-bar"></div>
    
    <div id="product-feed" class="min-h-full pb-32 overflow-y-auto"></div>
</div>

            <div id="page-pools" class="hidden h-full flex flex-col bg-gray-50"><div class="p-4 bg-white shadow-sm border-b border-gray-200 sticky top-0 z-10"><h2 class="font-bold text-lg text-kivu-teal"><i class="fas fa-users mr-2"></i>My Active Pools</h2></div><div id="pool-list" class="flex-1 p-3 overflow-y-auto pb-20"></div></div>
            <div id="page-cart" class="hidden h-full flex flex-col bg-gray-50"><div class="p-4 bg-white shadow-sm border-b border-gray-200 sticky top-0 z-10"><h2 class="font-bold text-lg text-kivu-orange"><i class="fas fa-shopping-cart mr-2"></i>Shopping Cart</h2></div><div id="cart-items" class="flex-1 p-3 overflow-y-auto pb-32"></div><div class="p-4 bg-white border-t border-gray-200 absolute bottom-0 w-full pb-24 shadow-[0_-4px_10px_rgba(0,0,0,0.05)]"><div class="flex justify-between mb-3 text-sm"><span>Total:</span><span class="font-bold text-xl text-kivu-orange" id="cart-total-price">0</span></div><button class="w-full bg-kivu-orange text-white font-bold py-3 rounded-full shadow-lg active:scale-95 transition">Checkout Now</button></div></div>
            
            <div id="page-local" class="hidden h-full flex flex-col bg-gray-50">
                <div class="bg-white border-b border-gray-200 sticky top-0 z-10 shadow-sm">
                    <div class="p-4 pb-2 flex justify-between items-center">
                        <h2 class="font-bold text-lg text-gray-800">Local Market</h2>
                        <div id="admin-tabs" class="hidden flex bg-gray-100 rounded p-1">
                            <button onclick="setLocalTab('active')" id="lt-active" class="px-3 py-1 rounded text-xs font-bold bg-white shadow-sm transition">Active</button>
                            <button onclick="setLocalTab('pending')" id="lt-pending" class="px-3 py-1 rounded text-xs font-bold text-gray-500 transition">Pending (<span id="pending-count">0</span>)</button>
                        </div>
                    </div>
                    <div class="px-4 pb-3 flex gap-2 overflow-x-auto no-scrollbar">
                        <button onclick="toggleLocalCats()" class="flex items-center gap-2 bg-gray-100 px-4 py-2 rounded-full text-xs font-bold text-gray-700 whitespace-nowrap active:bg-gray-200 border border-gray-200"><i class="fas fa-th-large"></i> Categories <span id="loc-cat-badge" class="hidden bg-kivu-teal w-2 h-2 rounded-full"></span></button>
                        <button onclick="toggleLocalFilters()" class="flex items-center gap-2 bg-gray-100 px-4 py-2 rounded-full text-xs font-bold text-gray-700 whitespace-nowrap active:bg-gray-200 border border-gray-200"><i class="fas fa-sliders-h"></i> Filters <span id="loc-filter-badge" class="hidden bg-kivu-teal w-2 h-2 rounded-full"></span></button>
                        <button onclick="toggleMapView()" id="btn-map-toggle" class="flex items-center gap-2 bg-gray-100 px-4 py-2 rounded-full text-xs font-bold text-gray-700 whitespace-nowrap active:bg-gray-200 border border-gray-200">
    <i class="fas fa-map-marked-alt"></i> Map
</button>
                        <button onclick="openSubPage('subpage-my-ads'); renderMyAds()" class="flex items-center gap-2 bg-gray-100 px-4 py-2 rounded-full text-xs font-bold text-gray-700 whitespace-nowrap active:bg-gray-200 border border-gray-200"><i class="fas fa-user-tag"></i> My Ads</button>
                        <button onclick="toggleCreateAd()" class="flex items-center gap-2 bg-kivu-teal text-white px-4 py-2 rounded-full text-xs font-bold whitespace-nowrap shadow-md active:bg-teal-800 ml-auto"><i class="fas fa-plus"></i> Post Ad</button>
                    </div>
                </div>
                <div id="local-map-view" class="hidden flex-1 relative w-full h-full z-0">
    <div id="main-map" class="w-full h-full"></div>
    <div id="map-item-card" class="absolute bottom-24 left-4 right-4 bg-white p-3 rounded-xl shadow-2xl hidden z-[1000] border border-gray-200 slide-up">
        </div>
</div>
                <div id="local-feed" class="flex-1 p-2 grid grid-cols-2 gap-4 overflow-y-auto pb-24 content-start"></div>
                <div id="local-filter-modal" class="hidden absolute inset-0 z-50 bg-black/60 backdrop-blur-sm flex items-end justify-center fade-in">
                    <div class="bg-white rounded-t-2xl shadow-2xl w-full max-w-md p-6 slide-up">
                        <div class="flex justify-between items-center mb-4"><h2 class="font-bold text-lg">Filter & Sort</h2><button onclick="toggleLocalFilters()"><i class="fas fa-times text-gray-400"></i></button></div>
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Deal Type</label>
<div class="flex gap-2 mb-4">
    <button onclick="toggleDealType('SALE')" id="btn-type-sale" class="flex-1 py-3 rounded-lg text-xs font-bold border border-gray-200 text-gray-500 bg-white transition hover:bg-gray-50">
        üí∞ Buy
    </button>
    <button onclick="toggleDealType('RENT')" id="btn-type-rent" class="flex-1 py-3 rounded-lg text-xs font-bold border border-gray-200 text-gray-500 bg-white transition hover:bg-gray-50">
        üìÖ Rent
    </button>
</div>
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Sort By</label>
                        <select id="filter-sort" class="w-full border rounded p-2 text-sm mb-4 bg-white"><option value="newest">Newest First</option><option value="price_asc">Price: Low to High</option><option value="price_desc">Price: High to Low</option></select>
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Price (RWF)</label>
                        <div class="flex gap-2 mb-4"><input type="number" id="filter-min" placeholder="Min" class="w-1/2 border rounded p-2 text-sm"><input type="number" id="filter-max" placeholder="Max" class="w-1/2 border rounded p-2 text-sm"></div>
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Location</label>
                        <select id="filter-loc" class="w-full border rounded p-2 text-sm mb-6 bg-white"><option value="all">All Locations</option><option value="Rwanda">Rwanda</option><option value="Kenya">Kenya</option><option value="Uganda">Uganda</option><option value="Tanzania">Tanzania</option><option value="Burundi">Burundi</option><option value="DRC">DRC</option><option value="Ethiopia">Ethiopia</option></select>
                        <div class="flex gap-2"><button onclick="resetLocalFilters()" class="flex-1 bg-gray-100 text-gray-700 py-3 rounded font-bold">Reset</button><button onclick="applyLocalFilters()" class="flex-1 bg-kivu-teal text-white py-3 rounded font-bold">Apply</button></div>
                    </div>
                </div>
                <div id="local-cats-modal" class="hidden absolute inset-0 z-50 bg-white flex flex-col slide-up"><div class="bg-kivu-teal text-white p-4 flex items-center gap-3 shadow-md shrink-0"><button onclick="toggleLocalCats()"><i class="fas fa-times text-lg"></i></button><h2 class="font-bold text-lg">Select Category</h2></div><div class="p-2 grid grid-cols-2 gap-2" id="local-cats-grid"></div></div>
                <div id="tools-modal" class="hidden absolute inset-0 z-[60] bg-white flex flex-col slide-up">
    <div class="bg-kivu-dark text-white p-4 flex items-center gap-3 shadow-md shrink-0">
        <button onclick="document.getElementById('tools-modal').classList.add('hidden')"><i class="fas fa-arrow-left text-lg"></i></button>
        <h2 class="font-bold text-lg">Kivu Workspace</h2>
    </div>
    
    <div id="tools-list" class="flex-1 overflow-y-auto p-4 bg-gray-50 grid grid-cols-2 gap-3 content-start">
        <div onclick="openToolFrame('Photo Editor', 'https://www.photopea.com')" class="bg-white p-4 rounded-xl shadow-sm border border-gray-100 flex flex-col items-center justify-center gap-2 active:scale-95 transition cursor-pointer h-32">
            <div class="w-12 h-12 bg-blue-900 rounded-full flex items-center justify-center text-white text-2xl"><i class="fas fa-magic"></i></div>
            <span class="font-bold text-xs text-center">Photo Editor<br>(Photoshop)</span>
        </div>

        <div onclick="openToolFrame('PDF Tools', 'https://tinywow.com/pdf')" class="bg-white p-4 rounded-xl shadow-sm border border-gray-100 flex flex-col items-center justify-center gap-2 active:scale-95 transition cursor-pointer h-32">
            <div class="w-12 h-12 bg-red-500 rounded-full flex items-center justify-center text-white text-2xl"><i class="fas fa-file-pdf"></i></div>
            <span class="font-bold text-xs text-center">PDF Converter<br>& Editor</span>
        </div>

        <div onclick="openToolFrame('Documents', 'https://docs.google.com')" class="bg-white p-4 rounded-xl shadow-sm border border-gray-100 flex flex-col items-center justify-center gap-2 active:scale-95 transition cursor-pointer h-32">
            <div class="w-12 h-12 bg-blue-500 rounded-full flex items-center justify-center text-white text-2xl"><i class="fas fa-file-word"></i></div>
            <span class="font-bold text-xs text-center">Word / Docs<br>(Office)</span>
        </div>

        <div onclick="openToolFrame('Translator', 'https://www.deepl.com/translator')" class="bg-white p-4 rounded-xl shadow-sm border border-gray-100 flex flex-col items-center justify-center gap-2 active:scale-95 transition cursor-pointer h-32">
            <div class="w-12 h-12 bg-indigo-600 rounded-full flex items-center justify-center text-white text-2xl"><i class="fas fa-language"></i></div>
            <span class="font-bold text-xs text-center">AI Translator<br>(DeepL)</span>
        </div>
        
        <div onclick="openToolFrame('Cinema', 'https://www.youtube.com/embed/videoseries?list=PLU12uITxBEPFbJ2G_X-04V82k6_3Wn-0_')" class="bg-white p-4 rounded-xl shadow-sm border border-gray-100 flex flex-col items-center justify-center gap-2 active:scale-95 transition cursor-pointer h-32">
            <div class="w-12 h-12 bg-red-600 rounded-full flex items-center justify-center text-white text-2xl"><i class="fas fa-play-circle"></i></div>
            <span class="font-bold text-xs text-center">Free Cinema<br>(Movies)</span>
        </div>
    </div>

    <div id="tool-frame-container" class="hidden absolute inset-0 z-20 bg-white flex flex-col">
        <div class="bg-gray-900 text-white p-2 flex justify-between items-center shadow-md">
            <span id="tool-title" class="font-bold text-sm ml-2">Tool Name</span>
            <button onclick="closeToolFrame()" class="bg-red-500 px-3 py-1 rounded text-xs font-bold">Close X</button>
        </div>
        <iframe id="tool-iframe" src="" class="flex-1 w-full border-none" allow="camera; microphone; clipboard-write;"></iframe>
    </div>
</div>
            </div>

            <div id="page-me" class="hidden h-full bg-gray-100 overflow-y-auto pb-24">
                <div class="bg-gradient-to-r from-kivu-dark to-kivu-teal text-white p-6 pt-10 pb-16">
                    <div class="flex items-center gap-4 mb-4"><div class="w-16 h-16 rounded-full bg-gray-200 border-2 border-white overflow-hidden"><img src="https://images.unsplash.com/photo-1535713875002-d1d0cf377fde?auto=format&fit=crop&w=100&q=80" class="w-full h-full object-cover"></div><div><h2 class="font-bold text-xl" id="user-name">Guest</h2><div class="flex items-center gap-2 mt-1"><span class="bg-kivu-gold text-black text-[10px] px-2 py-0.5 rounded font-bold">USER</span><span class="text-xs opacity-80" id="user-id">Not Logged In</span></div></div></div>
                </div>
                <div id="me-logged-in" class="hidden">
                    <div class="mx-4 -mt-8 bg-white rounded-lg shadow-md p-4 relative z-10">
                        <div onclick="openSubPage('subpage-orders'); renderMyOrders();" class="flex justify-between items-center mb-3 border-b border-gray-100 pb-2 cursor-pointer active:opacity-50"><h3 class="font-bold text-sm">My Orders</h3><span class="text-xs text-gray-400">View All ></span></div>
                        <div class="flex justify-between text-center overflow-x-auto no-scrollbar gap-4 pb-2">
                            <div class="flex flex-col items-center gap-1 min-w-[50px]"><i class="fas fa-wallet text-gray-400 text-lg"></i><span class="text-[9px] text-gray-500">Unpaid</span></div>
                            <div class="flex flex-col items-center gap-1 min-w-[50px]"><i class="fas fa-check-circle text-gray-400 text-lg"></i><span class="text-[9px] text-gray-500">Paid</span></div>
                            <div class="flex flex-col items-center gap-1 min-w-[50px]"><i class="fas fa-industry text-gray-400 text-lg"></i><span class="text-[9px] text-gray-500">Factory</span></div>
                            <div class="flex flex-col items-center gap-1 min-w-[50px]"><i class="fas fa-box text-gray-400 text-lg"></i><span class="text-[9px] text-gray-500">Packing</span></div>
                            <div class="flex flex-col items-center gap-1 min-w-[50px]"><i class="fas fa-ship text-gray-400 text-lg"></i><span class="text-[9px] text-gray-500">Shipping</span></div>
                            <div class="flex flex-col items-center gap-1 min-w-[50px]"><i class="fas fa-truck text-gray-400 text-lg"></i><span class="text-[9px] text-gray-500">Delivery</span></div>
                        </div>
                    </div>
                    <div class="m-4 flex flex-col gap-3">
                         <div class="bg-white rounded-lg shadow-sm overflow-hidden">
                            <div onclick="openSubPage('subpage-favorites')" class="p-4 border-b border-gray-100 flex justify-between items-center active:bg-gray-50 cursor-pointer"><span class="text-sm font-medium">Favorites</span><i class="fas fa-chevron-right text-gray-300 text-xs"></i></div>
                            <div onclick="openSubPage('subpage-address'); renderAddress()" class="p-4 border-b border-gray-100 flex justify-between items-center active:bg-gray-50 cursor-pointer"><span class="text-sm font-medium">My Address</span><i class="fas fa-chevron-right text-gray-300 text-xs"></i></div>
                            <div onclick="openToolsModal()" class="p-4 border-b border-gray-100 flex justify-between items-center active:bg-gray-50 cursor-pointer">
    <span class="text-sm font-medium flex items-center gap-2"><i class="fas fa-toolbox text-kivu-teal"></i> Free Tools (AI, PDF, Editor)</span>
    <i class="fas fa-chevron-right text-gray-300 text-xs"></i>
</div>
                            <div onclick="openSubPage('subpage-support')" class="p-4 border-b border-gray-100 flex justify-between items-center active:bg-gray-50 cursor-pointer"><span class="text-sm font-medium">Help Center</span><i class="fas fa-chevron-right text-gray-300 text-xs"></i></div>
                            <div onclick="openSubPage('subpage-profile'); loadProfileForm()" class="p-4 border-b border-gray-100 flex justify-between items-center active:bg-gray-50 cursor-pointer"><span class="text-sm font-medium">Profile Settings</span><i class="fas fa-chevron-right text-gray-300 text-xs"></i></div>
                        </div>
                        <button onclick="handleLogout()" class="bg-white text-red-500 font-bold py-4 rounded-lg shadow-sm text-sm mb-4">Log Out</button>
                    </div>
                </div>
                <div id="me-guest" class="m-4 -mt-8 relative z-10"><div class="bg-white rounded-lg shadow-md p-6 text-center"><h3 class="font-bold text-lg mb-2">Welcome!</h3><p class="text-sm text-gray-500 mb-4">Join our platform.</p><button onclick="toggleAuthModal(); switchAuthTab('signin')" class="w-full bg-kivu-teal text-white font-bold py-3 rounded-lg shadow-lg mb-3">Sign In</button><button onclick="toggleAuthModal(); switchAuthTab('signup')" class="w-full bg-white border border-kivu-teal text-kivu-teal font-bold py-3 rounded-lg shadow-sm">Register</button></div></div>
            </div>
        </main>
        
        <nav class="bg-white border-t border-gray-200 flex justify-between items-end px-4 py-2 shrink-0 z-30 pb-safe shadow-[0_-4px_10px_rgba(0,0,0,0.05)] h-[60px]">
            <div onclick="navTo('home')" id="nav-home" class="text-kivu-teal flex-1 flex flex-col items-center justify-center cursor-pointer transition h-full"><i class="fas fa-store text-xl mb-1"></i><span class="text-[9px] font-bold" data-i18n="nav_market">Market</span></div>
            <div onclick="navTo('pools')" id="nav-pools" class="text-gray-400 flex-1 flex flex-col items-center justify-center cursor-pointer transition h-full relative"><i class="fas fa-users text-xl mb-1"></i><span class="text-[9px] font-bold" data-i18n="nav_pools">Pools</span></div>
            <div onclick="navTo('cart')" id="nav-cart" class="text-gray-400 flex-1 flex flex-col items-center justify-center cursor-pointer transition h-full relative"><div class="bg-white rounded-full -mt-8 p-1.5 shadow-lg border border-gray-100"><div class="bg-kivu-orange text-white w-10 h-10 rounded-full flex items-center justify-center text-lg"><i class="fas fa-shopping-cart"></i></div></div><span class="text-[9px] font-bold mt-1" data-i18n="nav_cart">Cart</span><span id="cart-count" class="hidden absolute top-0 right-4 bg-red-600 text-white text-[9px] font-bold w-4 h-4 rounded-full flex items-center justify-center border border-white">0</span></div>
            <div onclick="navTo('local')" id="nav-local" class="text-gray-400 flex-1 flex flex-col items-center justify-center cursor-pointer transition h-full"><i class="fas fa-handshake text-xl mb-1"></i><span class="text-[9px] font-bold" data-i18n="nav_local">Local</span></div>
            <div onclick="navTo('me')" id="nav-me" class="text-gray-400 flex-1 flex flex-col items-center justify-center cursor-pointer transition h-full"><i class="fas fa-user text-xl mb-1"></i><span class="text-[9px] font-bold" data-i18n="nav_me">Me</span></div>
        </nav>
    <button id="btn-pool-admin" onclick="openPoolAdminModal()" class="hidden w-full bg-indigo-900 text-white font-bold py-3 rounded-lg shadow-sm text-sm mb-3">
    <i class="fas fa-boxes mr-2"></i> POOL ADMIN
</button>
<div id="pool-admin-modal" class="hidden fixed inset-0 z-[10000] bg-gray-100 flex flex-col slide-up">
    <div class="bg-gray-900 text-white p-4 flex justify-between items-center shadow-lg shrink-0">
        <h2 class="font-bold text-lg flex items-center text-yellow-400">
            <i class="fas fa-database mr-2"></i> ADMIN POOL
        </h2>
        <button onclick="document.getElementById('pool-admin-modal').classList.add('hidden')" 
                class="w-10 h-10 bg-red-600 text-white rounded-full flex items-center justify-center shadow-md active:scale-90 transition">
            <i class="fas fa-times text-xl"></i>
        </button>
    </div>

    <div class="p-2 bg-white shadow-sm border-b text-xs flex justify-between items-center shrink-0 z-10">
        <span class="font-bold ml-2 text-gray-500 uppercase">–°–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤</span>
        <button onclick="renderPoolAdmin()" class="bg-indigo-50 text-indigo-600 px-4 py-2 rounded-lg font-bold border border-indigo-200 hover:bg-indigo-100 transition flex items-center gap-2">
            <i class="fas fa-sync-alt"></i> –û–±–Ω–æ–≤–∏—Ç—å
        </button>
    </div>

    <div id="pool-admin-list" class="flex-1 overflow-y-auto p-0 bg-gray-50 pb-24">
        </div>
</div>

            

</div> 

<div id="module-auction" class="hidden h-full flex flex-col bg-gray-100 fixed inset-0 z-[60]">
    <div class="bg-gray-900 text-white p-4 shadow-md shrink-0 z-10">
        <div class="flex items-center justify-between mb-4">
            <div class="flex items-center gap-3">
                <button onclick="closeSuperModule()" class="w-8 h-8 flex items-center justify-center rounded-full bg-white/20 hover:bg-white/30 transition">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <button onclick="document.getElementById('create-machine-modal').classList.remove('hidden')" 
            class="bg-kivu-orange text-white px-3 py-1.5 rounded-lg text-xs font-bold shadow-lg animate-pulse">
        <i class="fas fa-plus-circle"></i> SELL
    </button>
</div>
                <button id="btn-auction-admin" onclick="openAuctionAdmin()" class="hidden w-8 h-8 flex items-center justify-center rounded-full bg-kivu-gold text-black hover:scale-110 transition shadow-lg">
                    <i class="fas fa-crown text-xs"></i>
                </button>
                <div>
                    <h2 class="font-bold text-lg text-white tracking-wide">HEAVY MACHINES</h2>
                    <p class="text-[10px] text-gray-400">Import & Local Market</p>
                </div>
            </div>
            <button onclick="openMyAds()" class="bg-white/10 text-white px-3 py-1.5 rounded-lg text-xs font-bold border border-white/10">
                <i class="fas fa-layer-group"></i> My Ads
            </button>
        </div>

        <div class="bg-gray-800 p-1 rounded-lg flex">
            <button onclick="switchMachineryCondition('new')" id="btn-mach-new" class="flex-1 py-2 rounded-md text-xs font-bold uppercase transition bg-kivu-orange text-white shadow-md">
                New Models
            </button>
            <button onclick="switchMachineryCondition('used')" id="btn-mach-used" class="flex-1 py-2 rounded-md text-xs font-bold uppercase transition text-gray-400 hover:text-white">
                Used / 2nd Hand
            </button>
        </div>
    

    <div id="auction-feed" class="flex-1 overflow-y-auto bg-gray-100 p-3 pb-24 grid grid-cols-1 gap-4">
        </div>

    <div id="create-machine-modal" class="hidden absolute inset-0 z-[70] bg-white flex flex-col slide-up">
    <div class="bg-gray-900 text-white p-4 flex justify-between items-center shadow-md">
        <h2 class="font-bold text-lg">Sell Machinery</h2>
        <button onclick="document.getElementById('create-machine-modal').classList.add('hidden')"><i class="fas fa-times"></i></button>
    </div>
    <div class="p-5 overflow-y-auto pb-24">
        <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Price Type</label>
        <select id="add-mach-pricetype" class="w-full border p-3 rounded mb-4 text-sm bg-white font-bold text-kivu-teal">
            <option value="FOB China">FOB China (Price in Port)</option>
            <option value="CIF Mombasa" selected>CIF Mombasa (Included Shipping)</option>
            <option value="Duty Paid">Duty Paid (Kigali Plate)</option>
        </select>

        <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Condition</label>
        <select id="add-mach-condition" class="w-full border p-3 rounded mb-4 text-sm bg-white">
            <option value="new">Brand New (Mashya)</option>
            <option value="used">Used (Akoze)</option>
        </select>

        <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Title / Model</label>
        <input type="text" id="add-mach-title" class="w-full border p-3 rounded mb-4 text-sm" placeholder="e.g. SANY Excavator SY215C">

        <div class="flex gap-2 mb-4">
            <div class="flex-1">
                <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Year</label>
                <input type="number" id="add-mach-year" class="w-full border p-3 rounded text-sm" placeholder="2022">
            </div>
            <div class="flex-1">
                <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Hours (h)</label>
                <input type="number" id="add-mach-hours" class="w-full border p-3 rounded text-sm" placeholder="1500">
            </div>
        </div>

        <div class="bg-gray-50 p-3 rounded-lg border border-gray-200 mb-4">
            <h4 class="text-xs font-bold text-gray-500 uppercase mb-2">Price Breakdown ($ USD)</h4>
            
            <div class="grid grid-cols-2 gap-2 mb-2">
                <div>
                    <label class="text-[9px] font-bold text-gray-400">Product Price (FOB)</label>
                    <input type="number" id="add-mach-base-price" oninput="calcTotalAdPrice()" class="w-full border p-2 rounded text-sm font-bold" placeholder="30000">
                </div>
                <div>
                    <label class="text-[9px] font-bold text-gray-400">Est. Shipping</label>
                    <input type="number" id="add-mach-shipping" oninput="calcTotalAdPrice()" class="w-full border p-2 rounded text-sm" placeholder="3500">
                </div>
            </div>

            <div class="mb-2">
                <label class="text-[9px] font-bold text-gray-400">Import Duty / Tax (%)</label>
                <div class="flex items-center gap-2">
                    <input type="number" id="add-mach-tax-rate" oninput="calcTotalAdPrice()" class="w-20 border p-2 rounded text-sm text-center" value="25">
                    <div class="flex-1 text-right text-xs text-gray-500">
                        Tax Amount: <span id="display-tax-amount" class="font-bold text-gray-800">$0</span>
                    </div>
                </div>
            </div>

            <div class="border-t border-gray-200 pt-2 flex justify-between items-center">
                <span class="text-xs font-bold text-gray-600">TOTAL ESTIMATED:</span>
                <span id="display-total-price" class="text-lg font-bold text-kivu-orange">$0</span>
            </div>
        </div>

        <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Photos (Max 5)</label>
        <div class="mb-4">
            <div class="flex gap-2 overflow-x-auto pb-2" id="mach-previews-container">
                <label class="w-20 h-20 shrink-0 bg-gray-100 border-2 border-dashed border-gray-300 rounded-lg flex flex-col items-center justify-center cursor-pointer hover:border-kivu-orange transition">
                    <i class="fas fa-camera text-gray-400"></i>
                    <span class="text-[8px] text-gray-500 font-bold uppercase mt-1">Add</span>
                    <input type="file" id="mach-file-input" class="hidden" accept="image/*" multiple onchange="handleMachineryFiles(this)">
                </label>
            </div>
        </div>

        <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Description</label>
        <textarea id="add-mach-desc" class="w-full border p-3 rounded mb-4 text-sm h-24" placeholder="Engine condition, service history..."></textarea>
        
        <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Contact Phone</label>
        <input type="tel" id="add-mach-phone" class="w-full border p-3 rounded mb-6 text-sm font-bold" placeholder="+250 788 123 456">
        <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Inspection Report (PDF Only)</label>
        <div class="flex items-center gap-3 mb-6 bg-gray-50 border border-gray-200 p-3 rounded-lg">
            <i class="fas fa-file-pdf text-red-500 text-xl"></i>
            <input type="file" id="add-mach-pdf" accept="application/pdf" class="text-xs text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-xs file:font-bold file:bg-red-50 file:text-red-700 hover:file:bg-red-100">
        </div>

        <button onclick="submitMachineryAd()" class="w-full bg-kivu-orange text-white font-bold py-4 rounded-xl shadow-lg">Submit for Review</button>
    </div>
</div>

<div id="my-bids-modal" class="hidden absolute inset-0 z-[80] bg-white flex flex-col slide-up">
        <div class="bg-gray-900 text-white p-4 flex items-center gap-3 shadow-md shrink-0">
            <button onclick="document.getElementById('my-bids-modal').classList.add('hidden')">
                <i class="fas fa-arrow-left text-lg"></i>
            </button>
            <h2 class="font-bold text-lg">My Listings</h2>
        </div>
        <div id="my-bids-list" class="flex-1 overflow-y-auto p-3 bg-gray-50 flex flex-col gap-3">
            </div>
    </div>
    </div>

    <div id="auction-admin-modal" class="hidden absolute inset-0 z-[60] bg-gray-100 flex flex-col slide-up">
        <div class="bg-gray-900 text-white p-4 flex justify-between items-center shadow-md">
            <h2 class="font-bold text-lg"><i class="fas fa-university text-kivu-gold mr-2"></i>Admin & Bank</h2>
            <button onclick="document.getElementById('auction-admin-modal').classList.add('hidden')" class="bg-white/20 w-8 h-8 rounded-full"><i class="fas fa-times"></i></button>
        </div>
        
        <div class="flex bg-white shadow-sm mb-2">
            <button onclick="switchAdminView('lots')" id="btn-view-lots" class="flex-1 py-3 text-sm font-bold border-b-2 border-kivu-teal text-kivu-teal bg-gray-50">
                <i class="fas fa-tractor"></i> Listings
            </button>
            <button onclick="switchAdminView('finance')" id="btn-view-finance" class="flex-1 py-3 text-sm font-bold border-b-2 border-transparent text-gray-400">
                <i class="fas fa-file-invoice-dollar"></i> Loan Requests <span id="finance-badge" class="bg-red-500 text-white text-[9px] px-1.5 rounded-full hidden">0</span>
            </button>
        </div>

        <div id="admin-view-lots" class="flex-1 overflow-y-auto p-4 pb-24">
            <div class="bg-blue-50 border border-blue-200 p-3 rounded-lg mb-4 flex justify-between items-center">
                <div>
                    <h4 class="font-bold text-blue-900 text-xs uppercase">Global Settings</h4>
                    <p class="text-[10px] text-blue-700">Set Interest Rate for ALL items</p>
                </div>
                <button onclick="openGlobalSettings()" class="bg-blue-600 text-white px-3 py-1.5 rounded text-xs font-bold shadow hover:bg-blue-700">
                    Set Default Rates
                </button>
            </div>
            <div id="admin-lots-list" class="space-y-2"></div>
        </div>

        <div id="admin-view-finance" class="hidden flex-1 overflow-y-auto p-4 pb-24 space-y-3">
            <div id="finance-requests-list">Loading...</div>
        </div>
    </div>
    <div id="edit-machine-modal" class="hidden fixed inset-0 z-[100] bg-black/80 flex items-end justify-center slide-up">
    <div class="bg-white w-full max-w-md rounded-t-3xl p-6 h-[85vh] overflow-y-auto relative">
        <div class="flex justify-between items-center mb-6 sticky top-0 bg-white z-10 pb-2 border-b border-gray-100">
            <h3 class="font-bold text-xl text-gray-900">Edit Listing ‚úèÔ∏è</h3>
            <button onclick="closeEditMachineModal()" class="w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center text-gray-500">
                <i class="fas fa-times"></i>
            </button>
        </div>

        <input type="hidden" id="edit-mach-id">

        <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Title / Model</label>
        <input type="text" id="edit-mach-title" class="w-full border border-gray-300 rounded-xl p-3 text-sm mb-4 font-bold">

        <div class="grid grid-cols-3 gap-2 mb-4">
    <div>
        <label class="block text-[10px] font-bold text-gray-500 uppercase mb-1">Price (Base)</label>
        <input type="number" id="edit-mach-price" class="w-full border border-gray-300 rounded-xl p-2 text-sm font-bold text-gray-900">
    </div>
    <div>
        <label class="block text-[10px] font-bold text-gray-500 uppercase mb-1">Shipping ($)</label>
        <input type="number" id="edit-mach-shipping" class="w-full border border-gray-300 rounded-xl p-2 text-sm font-bold text-blue-600">
    </div>
    <div>
        <label class="block text-[10px] font-bold text-gray-500 uppercase mb-1">Tax (%)</label>
        <input type="number" id="edit-mach-tax" class="w-full border border-gray-300 rounded-xl p-2 text-sm font-bold text-red-500">
    </div>
</div>

<div class="mb-4">
        <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Condition</label>
        <select id="edit-mach-condition" class="w-full border border-gray-300 rounded-xl p-3 text-sm bg-white">
        <option value="new">New</option>
        <option value="used">Used</option>
    </select>
</div>

        <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Status</label>
        <select id="edit-mach-status" class="w-full border border-gray-300 rounded-xl p-3 text-sm mb-4 bg-white font-bold">
            <option value="active" class="text-green-600">Active (Visible)</option>
            <option value="sold" class="text-red-600">Sold (Hidden/Marked)</option>
            <option value="pending" class="text-orange-600">Pending Review</option>
        </select>

        <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Description</label>
        <textarea id="edit-mach-desc" rows="5" class="w-full border border-gray-300 rounded-xl p-3 text-sm mb-4"></textarea>

        <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Image URL (Main)</label>
        <input type="text" id="edit-mach-img" class="w-full border border-gray-300 rounded-xl p-3 text-sm mb-6 text-gray-500">

        <div class="flex gap-2">
            <button onclick="saveMachineChanges()" class="flex-1 bg-kivu-teal text-white font-bold py-4 rounded-xl shadow-lg active:scale-95 transition">
                Save Changes
            </button>
            <button onclick="deleteMachine()" class="w-14 bg-red-100 text-red-500 rounded-xl font-bold flex items-center justify-center hover:bg-red-200">
                <i class="fas fa-trash"></i>
            </button>
        </div>
    </div>
</div>

<div id="finance-modal" class="hidden absolute inset-0 z-[100] bg-black/80 backdrop-blur-sm flex items-end justify-center fade-in">
    <div class="bg-white w-full rounded-t-3xl p-6 slide-up">
        <div class="flex justify-between items-center mb-6">
            <h3 class="font-bold text-xl text-blue-900 flex items-center gap-2">
                <i class="fas fa-university"></i> Bank Finance
            </h3>
            <button onclick="document.getElementById('finance-modal').classList.add('hidden')" class="w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center text-gray-500">
                <i class="fas fa-times"></i>
            </button>
        </div>

        <div class="bg-blue-50 p-4 rounded-xl border border-blue-100 mb-6">
            <div class="flex items-center gap-3 mb-4 border-b border-blue-200 pb-3">
                <img src="https://upload.wikimedia.org/wikipedia/commons/9/9e/Bank_of_Kigali_logo.jpg" class="w-10 h-10 rounded-full bg-white shadow-sm" onerror="this.src='https://via.placeholder.com/40?text=BK'">
                <div>
                    <h4 class="font-bold text-sm text-blue-900">Bank of Kigali (BK)</h4>
                    <p class="text-[10px] text-blue-600">Equipment Loan ‚Ä¢ 14% p.a.</p>
                </div>
            </div>
            
            <div class="space-y-2 text-sm">
                <div class="flex justify-between">
                    <span class="text-gray-500">Asset Price</span>
                    <span class="font-bold" id="fin-asset-price">$0</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-gray-500">Down Payment (20%)</span>
                    <span class="font-bold text-green-600" id="fin-down-payment">$0</span>
                </div>
                <div class="flex justify-between border-t border-blue-200 pt-2 mt-2">
                    <span class="font-bold text-blue-900">Loan Amount</span>
                    <span class="font-bold text-blue-900" id="fin-loan-amount">$0</span>
                </div>
                <div class="flex justify-between items-center mt-2 bg-white p-2 rounded border border-blue-100">
                    <span class="text-xs font-bold text-gray-500 uppercase">Est. Monthly</span>
                    <span class="font-bold text-xl text-kivu-orange" id="fin-monthly">$0</span>
                </div>
            </div>
        </div>

        <p class="text-[10px] text-gray-400 text-center mb-4">
            Subject to credit approval. Terms and conditions apply. <br>Powered by Kivu Pay.
        </p>

        <button onclick="submitFinanceApp()" class="w-full bg-blue-900 text-white font-bold py-4 rounded-xl shadow-lg flex justify-center items-center gap-2 active:scale-95 transition">
            <span>Submit Application</span>
            <i class="fas fa-paper-plane"></i>
        </button>
    </div>
</div>
<div id="module-maps" class="hidden h-full flex flex-col bg-gray-50 fixed inset-0 z-[60]">
    
    <div class="bg-gray-900 text-white p-4 shadow-md shrink-0 flex justify-between items-center z-20 relative">
        <div class="flex items-center gap-3">
             <button onclick="closeSuperModule()" class="bg-white/20 w-8 h-8 rounded-full flex items-center justify-center hover:bg-white/30 transition">
                <i class="fas fa-times"></i>
            </button>
            <div>
                <h2 class="font-bold text-lg"><i class="fas fa-map-marked-alt mr-2 text-kivu-teal"></i> Kivu Map</h2>
                <p class="text-[10px] text-gray-400">Events, Weather & Navigation</p>
            </div>
        </div>


        <button onclick="openCreateEventModal()" class="bg-gradient-to-r from-pink-600 to-purple-600 text-white px-3 py-1.5 rounded-full text-xs font-bold shadow-lg flex items-center gap-1 active:scale-95 transition border border-white/20">
            <i class="fas fa-plus"></i> <span class="hidden sm:inline">Add Event</span>
        </button>

    </div>

    <div class="bg-white p-2 shadow-sm flex gap-2 shrink-0 z-20 relative border-b border-gray-200">
        <button onclick="switchMapTab('map')" id="tab-btn-map" class="flex-1 py-2 rounded-lg bg-gray-900 text-white font-bold text-xs shadow transition">
            Map
        </button>
        <button onclick="switchMapTab('list')" id="tab-btn-list" class="flex-1 py-2 rounded-lg bg-white text-gray-600 font-bold text-xs border transition">
            Events List
        </button>
        <button onclick="switchMapTab('weather')" id="tab-btn-weather" class="flex-1 py-2 rounded-lg bg-white text-gray-600 font-bold text-xs border transition">
            Weather
        </button>
    </div>

    <div id="map-filters-bar" class="bg-white px-4 py-2 border-b border-gray-100 shrink-0 overflow-x-auto no-scrollbar flex gap-2 z-10 relative">
        <button onclick="filterMapEvents('all')" class="ev-filter active bg-gray-900 text-white px-4 py-1.5 rounded-full text-xs font-bold whitespace-nowrap transition shadow-sm">
            All
        </button>
        <button onclick="filterMapEvents('party')" class="ev-filter bg-gray-50 text-gray-600 px-4 py-1.5 rounded-full text-xs font-bold whitespace-nowrap border border-gray-200 transition">
            üéâ Party
        </button>
        <button onclick="filterMapEvents('sport')" class="ev-filter bg-gray-50 text-gray-600 px-4 py-1.5 rounded-full text-xs font-bold whitespace-nowrap border border-gray-200 transition">
            ‚öΩ Sport
        </button>
        <button onclick="filterMapEvents('food')" class="ev-filter bg-gray-50 text-gray-600 px-4 py-1.5 rounded-full text-xs font-bold whitespace-nowrap border border-gray-200 transition">
            üçî Food
        </button>
        <button onclick="filterMapEvents('health')" class="ev-filter bg-gray-50 text-gray-600 px-4 py-1.5 rounded-full text-xs font-bold whitespace-nowrap border border-gray-200 transition">
            üíä Health
        </button>
         <button onclick="filterMapEvents('tours')" class="ev-filter bg-gray-50 text-gray-600 px-4 py-1.5 rounded-full text-xs font-bold whitespace-nowrap border border-gray-200 transition">
            üéí Tours
        </button>
    </div>

    <div class="flex-1 relative overflow-hidden bg-gray-100">
        
        <div id="view-map" class="absolute inset-0 z-0 h-full w-full">
            <div id="weather-map-container" class="w-full h-full bg-gray-200 z-0"></div>
            
            <div class="absolute bottom-24 right-4 flex flex-col gap-3 z-[400]">
                <button onclick="locateMe()" class="w-12 h-12 bg-white rounded-full shadow-xl flex items-center justify-center text-blue-600 font-bold active:scale-90 transition border border-gray-200">
                    <i class="fas fa-crosshairs text-xl"></i>
                </button>
                <button onclick="buildRoute()" class="w-12 h-12 bg-kivu-teal text-white rounded-full shadow-xl flex items-center justify-center font-bold active:scale-90 transition border-2 border-white">
                    <i class="fas fa-directions text-xl"></i>
                </button>
            </div>

            <div id="map-event-popup" class="hidden absolute bottom-4 left-4 right-4 bg-white rounded-2xl shadow-2xl p-4 z-[500] border-l-4 border-purple-600 slide-up">
                </div>
        </div>

        <div id="events-list-container" class="hidden absolute inset-0 z-10 bg-gray-50 flex flex-col pb-20 animate-fade-in">
    </div>

        <div id="view-weather" class="hidden absolute inset-0 z-10 bg-blue-50 overflow-y-auto pb-24 animate-fade-in">
            <div class="p-10 text-center text-gray-400">
                <i class="fas fa-circle-notch fa-spin text-2xl mb-2"></i>
                <p>Loading Forecast...</p>
            </div>
        </div>

    </div>

    <div id="create-event-modal" class="hidden fixed inset-0 z-[70] bg-black/80 backdrop-blur-sm flex items-end justify-center fade-in">
        <div class="bg-white w-full rounded-t-3xl p-6 slide-up h-[85vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 class="font-bold text-xl text-gray-900">Create Event</h3>
                <button onclick="document.getElementById('create-event-modal').classList.add('hidden')" class="w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center text-gray-500">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <form onsubmit="submitNewEvent(event)" class="space-y-4">
                
                <div>
    <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Select Category</label>
    <div class="grid grid-cols-3 gap-2">
        <label class="cursor-pointer">
            <input type="radio" name="ev_cat" value="party" class="peer hidden" checked>
            <div class="p-2 border rounded-lg text-center text-xs font-bold text-gray-600 peer-checked:bg-purple-600 peer-checked:text-white peer-checked:border-purple-600 transition hover:bg-gray-50">
                üéâ Party
            </div>
        </label>
        <label class="cursor-pointer">
            <input type="radio" name="ev_cat" value="sport" class="peer hidden">
            <div class="p-2 border rounded-lg text-center text-xs font-bold text-gray-600 peer-checked:bg-green-600 peer-checked:text-white peer-checked:border-green-600 transition hover:bg-gray-50">
                ‚öΩ Sport
            </div>
        </label>
        <label class="cursor-pointer">
            <input type="radio" name="ev_cat" value="food" class="peer hidden">
            <div class="p-2 border rounded-lg text-center text-xs font-bold text-gray-600 peer-checked:bg-orange-500 peer-checked:text-white peer-checked:border-orange-500 transition hover:bg-gray-50">
                üçî Food
            </div>
        </label>
        <label class="cursor-pointer">
            <input type="radio" name="ev_cat" value="health" class="peer hidden">
            <div class="p-2 border rounded-lg text-center text-xs font-bold text-gray-600 peer-checked:bg-red-500 peer-checked:text-white peer-checked:border-red-500 transition hover:bg-gray-50">
                üßò Health
            </div>
        </label>
        <label class="cursor-pointer">
            <input type="radio" name="ev_cat" value="tours" class="peer hidden">
            <div class="p-2 border rounded-lg text-center text-xs font-bold text-gray-600 peer-checked:bg-blue-500 peer-checked:text-white peer-checked:border-blue-500 transition hover:bg-gray-50">
                üéí Tours
            </div>
        </label>
        <label class="cursor-pointer">
            <input type="radio" name="ev_cat" value="business" class="peer hidden">
            <div class="p-2 border rounded-lg text-center text-xs font-bold text-gray-600 peer-checked:bg-gray-800 peer-checked:text-white peer-checked:border-gray-800 transition hover:bg-gray-50">
                üíº Biz
            </div>
        </label>
        <label class="cursor-pointer">
            <input type="radio" name="ev_cat" value="art" class="peer hidden">
            <div class="p-2 border rounded-lg text-center text-xs font-bold text-gray-600 peer-checked:bg-pink-500 peer-checked:text-white peer-checked:border-pink-500 transition hover:bg-gray-50">
                üé® Art
            </div>
        </label>
        <label class="cursor-pointer">
            <input type="radio" name="ev_cat" value="edu" class="peer hidden">
            <div class="p-2 border rounded-lg text-center text-xs font-bold text-gray-600 peer-checked:bg-teal-500 peer-checked:text-white peer-checked:border-teal-500 transition hover:bg-gray-50">
                üéì Edu
            </div>
        </label>
        <label class="cursor-pointer">
            <input type="radio" name="ev_cat" value="other" class="peer hidden">
            <div class="p-2 border rounded-lg text-center text-xs font-bold text-gray-600 peer-checked:bg-gray-500 peer-checked:text-white peer-checked:border-gray-500 transition hover:bg-gray-50">
                ‚ùì Other
            </div>
        </label>
    </div>
</div>

                <div>
                    <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Event Title</label>
                    <input type="text" id="ev-title" required class="w-full border rounded-xl p-3 text-sm font-bold" placeholder="e.g. Roof Yoga">
                </div>

                <div class="grid grid-cols-2 gap-3">
                    <div>
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Start</label>
                        <input type="datetime-local" id="ev-start" required class="w-full border rounded-xl p-3 text-xs font-bold">
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-2">End</label>
                        <input type="datetime-local" id="ev-end" required class="w-full border rounded-xl p-3 text-xs font-bold">
                    </div>
                </div>

                <div>
    <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Price (RWF)</label>
    <input type="number" id="ev-price" placeholder="0 = Free" class="w-full border rounded-xl p-3 text-sm font-bold">
</div>

<div class="mt-4 mb-4">
    <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Description</label>
    <textarea id="ev-desc" rows="3" class="w-full bg-gray-50 border border-gray-200 rounded-xl text-sm p-3 focus:ring-2 focus:ring-black outline-none" placeholder="Describe your event..."></textarea>
</div>
<div class="space-y-3 pt-2 border-t">
    <p class="text-xs font-bold text-gray-400 uppercase">Contact Links (Optional)</p>
    
    <div class="flex items-center gap-2 bg-gray-50 p-2 rounded-xl border focus-within:border-green-500 transition">
        <i class="fab fa-whatsapp text-green-500 text-lg ml-1 w-6 text-center"></i>
        <input id="ev-social-wa" type="text" placeholder="WhatsApp Number" class="bg-transparent border-none text-sm w-full focus:ring-0 placeholder-gray-400">
    </div>

    <div class="flex items-center gap-2 bg-gray-50 p-2 rounded-xl border focus-within:border-pink-500 transition">
        <i class="fab fa-instagram text-pink-500 text-lg ml-1 w-6 text-center"></i>
        <input id="ev-social-ig" type="text" placeholder="Instagram Username" class="bg-transparent border-none text-sm w-full focus:ring-0 placeholder-gray-400">
    </div>

    <div class="flex items-center gap-2 bg-gray-50 p-2 rounded-xl border focus-within:border-gray-800 transition">
        <i class="fab fa-twitter text-gray-800 text-lg ml-1 w-6 text-center"></i>
        <input id="ev-social-tw" type="text" placeholder="Twitter Username" class="bg-transparent border-none text-sm w-full focus:ring-0 placeholder-gray-400">
    </div>

    <div class="flex items-center gap-2 bg-gray-50 p-2 rounded-xl border focus-within:border-blue-600 transition">
        <i class="fab fa-facebook text-blue-600 text-lg ml-1 w-6 text-center"></i>
        <input id="ev-social-fb" type="text" placeholder="Facebook Link or Username" class="bg-transparent border-none text-sm w-full focus:ring-0 placeholder-gray-400">
    </div>
</div>

                <div class="bg-gray-50 p-3 rounded-xl border border-dashed border-gray-300">
                    <p class="text-xs text-gray-500 mb-2">Location:</p>
                    <button type="button" onclick="pickLocationOnMap()" class="w-full bg-white border border-gray-200 text-blue-600 font-bold py-2 rounded-lg text-xs flex items-center justify-center gap-2">
                        <i class="fas fa-map-pin"></i> <span id="ev-loc-text">Tap to select on Map</span>
                    </button>
                    <input type="hidden" id="ev-lat"><input type="hidden" id="ev-lng">
                </div>

                <button type="submit" class="w-full bg-gray-900 text-white font-bold py-4 rounded-xl shadow-lg mt-2">
                    Submit Event
                </button>
            </form>
        </div>
    </div>
    <div id="admin-events-modal" class="hidden fixed inset-0 z-[80] bg-gray-100 flex flex-col slide-up">
    <div class="bg-gray-900 text-white p-4 flex justify-between items-center shadow-md shrink-0">
        <div>
            <h2 class="font-bold text-lg text-red-500"><i class="fas fa-gavel mr-2"></i>Event Moderation</h2>
            <p class="text-[10px] text-gray-400">Review user submissions</p>
        </div>
        <button onclick="document.getElementById('admin-events-modal').classList.add('hidden')" class="w-8 h-8 bg-white/20 rounded-full flex items-center justify-center hover:bg-white/30 transition">
            <i class="fas fa-times"></i>
        </button>
    </div>

    <div id="admin-events-list" class="flex-1 overflow-y-auto p-4 space-y-3 pb-24">
        <div class="text-center text-gray-400 mt-10">Loading pending requests...</div>
    </div>
</div>
<button id="btn-event-admin" onclick="openEventAdminPanel()" 
    style="position: absolute; bottom: 100px; left: 20px; z-index: 9999;"
    class="hidden bg-black text-white p-4 rounded-full shadow-2xl border-4 border-red-500 font-bold hover:scale-110 transition">
        <i class="fas fa-user-shield text-2xl"></i>
    </button>

</div>
<div id="module-finance" class="hidden fixed inset-0 bg-gray-50 z-[60] overflow-y-auto pb-24 font-sans">
    
    <div class="sticky top-0 bg-emerald-900 text-white p-4 shadow-md z-40 flex justify-between items-center">
        <div class="flex items-center gap-3">
            <button onclick="closeFinanceModule()" class="w-8 h-8 rounded-full bg-white/10 flex items-center justify-center hover:bg-white/20 transition">
                <i class="fas fa-arrow-left"></i>
            </button>
            <div>
                <h2 class="font-bold text-lg leading-none">Kivu Finance</h2>
                <p class="text-[10px] text-emerald-200 opacity-80">Banking & Insurance</p>
            </div>
        </div>
        
        <div class="flex gap-2"> 
        <button onclick="openAddBranchModal()" class="bg-yellow-400 text-yellow-900 px-3 py-1.5 rounded-full text-xs font-bold shadow-md border border-yellow-200 active:scale-95 transition flex items-center gap-1">
        <i class="fas fa-plus-circle"></i> Add Business </button>
        <button onclick="openCalcModal()" class="w-8 h-8 rounded-full bg-emerald-700 flex items-center justify-center shadow-md active:scale-95 transition">
        <i class="fas fa-calculator text-xs"></i>
    </button>
    <button onclick="openFinanceMapModal()" class="w-8 h-8 rounded-full bg-emerald-700 flex items-center justify-center shadow-md active:scale-95 transition">
        <i class="fas fa-map-marked-alt text-xs"></i>
    </button>
    <button id="btn-bank-admin" onclick="openBankAdminPanel()" class="hidden w-8 h-8 rounded-full bg-yellow-500 text-black flex items-center justify-center shadow-md animate-pulse">
        <i class="fas fa-shield-alt text-xs"></i>
    </button>
</div>
    </div>

    <div class="bg-white p-3 shadow-sm border-b border-gray-100 sticky top-[60px] z-30">
        <div class="flex gap-2 overflow-x-auto no-scrollbar">
            <button onclick="filterFinanceCategory('bank')" id="cat-btn-bank" class="px-4 py-2 rounded-full text-xs font-bold border transition whitespace-nowrap bg-emerald-600 text-white border-emerald-600 shadow-md">
                üè¶ Banks
            </button>
            <button onclick="filterFinanceCategory('forex')" id="cat-btn-forex" class="px-4 py-2 rounded-full text-xs font-bold border transition whitespace-nowrap bg-white text-gray-600 border-gray-200">
                üí± Exchange
            </button>
            <button onclick="filterFinanceCategory('loan')" id="cat-btn-loan" class="px-4 py-2 rounded-full text-xs font-bold border transition whitespace-nowrap bg-white text-gray-600 border-gray-200">
                üí∏ Loans
            </button>
            <button onclick="filterFinanceCategory('mortgage')" id="cat-btn-mortgage" class="px-4 py-2 rounded-full text-xs font-bold border transition whitespace-nowrap bg-white text-gray-600 border-gray-200">
                üè† Mortgage
            </button>
            <button onclick="filterFinanceCategory('insurance')" id="cat-btn-insurance" class="px-4 py-2 rounded-full text-xs font-bold border transition whitespace-nowrap bg-white text-gray-600 border-gray-200">
                üõ°Ô∏è Insurance
            </button>
        </div>
        
        <div id="finance-subfilters" class="flex gap-2 mt-3 hidden animate-fade-in">
            <select id="sort-currency" onchange="renderFinanceList()" class="bg-gray-50 border border-gray-200 text-xs rounded-lg px-2 py-1 outline-none font-bold text-gray-700">
                <option value="usd">USD ($)</option>
                <option value="eur">EUR (‚Ç¨)</option>
                <option value="cny">CNY (¬•)</option>
                <option value="kes">KES (Ksh)</option>
                <option value="ugx">UGX (Sh)</option>
                <option value="tzs">TZS (TSh)</option>
            </select>
            <button onclick="toggleSortOrder('buy')" id="sort-btn-buy" class="flex-1 bg-emerald-100 text-emerald-800 text-[10px] font-bold py-1 rounded border border-emerald-200">Best Buy</button>
            <button onclick="toggleSortOrder('sell')" id="sort-btn-sell" class="flex-1 bg-white text-gray-500 text-[10px] font-bold py-1 rounded border border-gray-200">Best Sell</button>
        </div>
    </div>

    <div id="finance-list-container" class="p-3 space-y-3 min-h-[50vh]">
        <div class="text-center text-gray-400 py-10 mt-10">
            <i class="fas fa-circle-notch fa-spin text-3xl mb-3 text-emerald-500"></i>
            <p class="text-xs font-bold">Loading Financial Data...</p>
        </div>
    </div>
    
    <div id="finance-pagination-container" class="pb-24 px-4"></div>

</div>

<div id="modal-finance-map" class="hidden fixed inset-0 z-[70] bg-white slide-up">
    <div class="absolute top-4 left-4 right-4 z-[500] flex justify-between items-start pointer-events-none">
        <div class="bg-white/90 backdrop-blur px-4 py-2 rounded-full shadow-lg pointer-events-auto">
            <span class="text-xs font-bold text-emerald-800" id="map-category-label">Showing Banks</span>
        </div>
        <button onclick="document.getElementById('modal-finance-map').classList.add('hidden')" class="w-10 h-10 bg-white text-black rounded-full shadow-xl flex items-center justify-center pointer-events-auto active:scale-90 transition">
            <i class="fas fa-times text-lg"></i>
        </button>
    </div>
    <div id="finance-map-container" class="w-full h-full bg-gray-200"></div>
    <button onclick="centerFinanceMap()" class="absolute bottom-8 right-4 z-[500] w-12 h-12 bg-emerald-600 text-white rounded-full shadow-lg flex items-center justify-center">
        <i class="fas fa-location-arrow"></i>
    </button>
</div>

<div id="modal-finance-calc" class="hidden fixed inset-0 z-[80] bg-black/80 backdrop-blur-sm flex items-end justify-center fade-in">
    <div class="bg-white w-full max-w-md rounded-t-3xl p-6 slide-up">
        <div class="flex justify-between items-center mb-6">
            <h3 class="text-lg font-bold text-gray-800 flex items-center gap-2"><i class="fas fa-calculator text-emerald-600"></i> Loan Calculator</h3>
            <button onclick="document.getElementById('modal-finance-calc').classList.add('hidden')" class="w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center text-gray-500"><i class="fas fa-times"></i></button>
        </div>
        
        <div class="space-y-4">
            <div>
                <label class="text-xs font-bold text-gray-500 uppercase">Amount (RWF)</label>
                <input type="number" id="f-calc-amount" placeholder="1000000" class="w-full border border-gray-300 rounded-xl p-3 text-lg font-bold mt-1 focus:border-emerald-500 outline-none">
            </div>
            <div class="flex gap-4">
                <div class="flex-1">
                    <label class="text-xs font-bold text-gray-500 uppercase">Rate (% Year)</label>
                    <input type="number" id="f-calc-rate" placeholder="18" class="w-full border border-gray-300 rounded-xl p-3 font-bold mt-1 text-center">
                </div>
                <div class="flex-1">
                    <label class="text-xs font-bold text-gray-500 uppercase">Months</label>
                    <input type="number" id="f-calc-months" placeholder="12" class="w-full border border-gray-300 rounded-xl p-3 font-bold mt-1 text-center">
                </div>
            </div>
            
            <div id="f-calc-result" class="hidden bg-emerald-50 border border-emerald-100 p-4 rounded-xl text-center">
                <p class="text-xs text-emerald-700 font-bold uppercase mb-1">Monthly Payment</p>
                <p class="text-3xl font-black text-emerald-900" id="f-calc-total">0</p>
                <p class="text-[10px] text-emerald-600">RWF</p>
            </div>

            <button onclick="calculateFinanceLoan()" class="w-full bg-emerald-600 text-white font-bold py-4 rounded-xl shadow-lg active:scale-95 transition">Calculate</button>
        </div>
    </div>
</div>

<div id="modal-finance-details" class="hidden fixed inset-0 z-[90] bg-black/80 backdrop-blur-sm flex items-end justify-center fade-in">
    <div class="bg-white w-full max-w-md rounded-t-3xl overflow-hidden slide-up max-h-[90vh] flex flex-col">
        
        <div class="h-32 bg-emerald-900 relative flex items-center justify-center shrink-0">
            <div class="w-16 h-16 bg-white rounded-full flex items-center justify-center text-3xl shadow-lg" id="fin-det-icon">
                üè¶
            </div>
            <button onclick="document.getElementById('modal-finance-details').classList.add('hidden')" class="absolute top-4 right-4 bg-black/30 text-white w-8 h-8 rounded-full flex items-center justify-center backdrop-blur hover:bg-black/50">
                <i class="fas fa-times"></i>
            </button>
        </div>

        <div class="p-6 overflow-y-auto">
            <div class="flex justify-between items-start mb-2">
                <h2 id="fin-det-title" class="text-2xl font-bold text-gray-900 leading-tight">Bank Name</h2>
                <span id="fin-det-status" class="bg-green-100 text-green-700 text-[10px] px-2 py-1 rounded font-bold uppercase">Active</span>
            </div>
            <p id="fin-det-address" class="text-sm text-gray-500 mb-4"><i class="fas fa-map-marker-alt text-red-500 mr-1"></i> Location</p>

            <div id="fin-det-rates" class="grid grid-cols-2 gap-2 mb-6 hidden">
                <div class="bg-gray-50 p-2 rounded border border-gray-100 text-center">
                    <div class="text-[9px] text-gray-400 font-bold uppercase">USD Buy</div>
                    <div class="font-bold text-gray-800" id="rate-usd-buy">-</div>
                </div>
                <div class="bg-green-50 p-2 rounded border border-green-100 text-center">
                    <div class="text-[9px] text-green-600 font-bold uppercase">USD Sell</div>
                    <div class="font-bold text-green-800 text-lg" id="rate-usd-sell">-</div>
                </div>
            </div>

            <div class="space-y-3 text-sm text-gray-600 mb-6">
                <p><i class="far fa-clock w-6 text-center text-emerald-600"></i> <span id="fin-det-hours">08:00 - 17:00</span></p>
                <p><i class="fas fa-phone w-6 text-center text-emerald-600"></i> <span id="fin-det-phone">+250...</span></p>
                <div class="bg-gray-50 p-3 rounded-lg text-xs leading-relaxed border border-gray-100" id="fin-det-desc">
                    Description...
                </div>
            </div>

            <div class="grid grid-cols-2 gap-3" id="fin-user-actions">
                <button onclick="openFinanceRoute()" class="py-3 rounded-xl border border-gray-300 font-bold text-gray-700 flex items-center justify-center gap-2 hover:bg-gray-50">
                    <i class="fas fa-directions"></i> Map
                </button>
                <button onclick="openFinanceApplyForm()" class="py-3 rounded-xl bg-emerald-600 text-white font-bold shadow-lg hover:bg-emerald-700 flex items-center justify-center gap-2">
                    <i class="fas fa-paper-plane"></i> Apply
                </button>
            </div>

            <button id="btn-delete-listing" onclick="deleteFinanceListing()" class="hidden w-full mt-4 border border-red-200 text-red-500 py-3 rounded-xl font-bold text-xs hover:bg-red-50">
                <i class="fas fa-trash"></i> Delete Listing
            </button>
        </div>
    </div>
</div>

<div id="modal-add-branch" class="hidden fixed inset-0 z-[100] bg-black/90 flex items-center justify-center p-4">
    <div class="bg-white w-full max-w-md rounded-2xl p-6 relative max-h-[90vh] overflow-y-auto">
        <button onclick="document.getElementById('modal-add-branch').classList.add('hidden')" class="absolute top-4 right-4 text-gray-400"><i class="fas fa-times text-lg"></i></button>
        
        <h3 class="font-bold text-lg text-emerald-900 mb-1">Add Your Business</h3>
        <p class="text-xs text-gray-500 mb-4">Submit your branch/ATM for verification.</p>
        
        <form onsubmit="submitNewBranch(event)">
            
            <label class="block text-[10px] font-bold text-gray-500 uppercase mb-1">Category</label>
            <select id="add-br-type" onchange="window.updateBranchFields()" class="w-full border border-gray-300 rounded-lg p-3 text-sm mb-3 bg-white font-bold text-emerald-800">
    <option value="bank">üè¶ Bank Branch (General)</option>
    <option value="forex">üí± Forex Bureau (Exchange)</option>
    <option value="loan">üí∏ Loan Center (Credits)</option>
    <option value="mortgage">üè† Mortgage Provider</option>
    <option value="insurance">üõ°Ô∏è Insurance Agency</option>
</select>
            <div id="branch-dynamic-fields" class="mb-3 p-3 bg-gray-50 border border-gray-200 rounded-lg hidden animate-fade-in">
                </div>

            <label class="block text-[10px] font-bold text-gray-500 uppercase mb-1">Business Name</label>
<input type="text" id="add-br-name" required placeholder="e.g. Bank of Kigali - Remera Branch" class="w-full border border-gray-300 rounded-lg p-3 text-sm mb-3">

<label class="block text-[10px] font-bold text-gray-500 uppercase mb-1">Description</label>
<textarea id="add-br-desc" rows="3" placeholder="Describe services, requirements, or details..." class="w-full border border-gray-300 rounded-lg p-3 text-sm mb-3"></textarea>

            <label class="block text-[10px] font-bold text-gray-500 uppercase mb-1">Location</label>
            <div class="bg-gray-50 p-3 rounded-lg border border-dashed border-gray-300 mb-3 text-center">
                <p id="add-br-coords" class="text-xs text-gray-400 mb-2">No location selected</p>
                <button type="button" onclick="pickBranchLocation()" class="bg-white border border-emerald-500 text-emerald-600 px-4 py-2 rounded-lg text-xs font-bold shadow-sm hover:bg-emerald-50">
                    <i class="fas fa-map-marker-alt"></i> Select on Map
                </button>
                <input type="hidden" id="add-br-lat">
                <input type="hidden" id="add-br-lng">
            </div>

            <label class="block text-[10px] font-bold text-gray-500 uppercase mb-1">Street / Address</label>
            <input type="text" id="add-br-address" required placeholder="e.g. KN 5 Rd" class="w-full border border-gray-300 rounded-lg p-3 text-sm mb-3">

            <div class="mb-4">
                <label class="block text-[10px] font-bold text-gray-500 uppercase mb-1">Phone</label>
                <input type="tel" id="add-br-phone" placeholder="+250..." class="w-full border border-gray-300 rounded-lg p-3 text-sm">
            </div>

            <div class="mb-4">
                <label class="block text-[10px] font-bold text-gray-500 uppercase mb-1">Working Hours</label>
                <input type="text" id="add-br-hours" placeholder="08:00 - 18:00" class="w-full border border-gray-300 rounded-lg p-3 text-sm">
            </div>
            
            <button type="submit" class="w-full bg-emerald-600 text-white font-bold py-3 rounded-xl shadow-lg hover:bg-emerald-700">Submit Application</button>
        </form>
    </div>
</div>

<div id="modal-bank-admin" class="hidden fixed inset-0 z-[110] bg-gray-100 slide-up">
    <div class="bg-emerald-900 text-white p-4 flex justify-between items-center shadow-md">
        <h2 class="font-bold text-lg"><i class="fas fa-shield-alt text-yellow-400 mr-2"></i>Admin Panel</h2>
        <button onclick="document.getElementById('modal-bank-admin').classList.add('hidden')" class="w-8 h-8 rounded-full bg-white/20 flex items-center justify-center"><i class="fas fa-times"></i></button>
    </div>
    
    <div class="p-2 bg-white shadow-sm flex gap-2 border-b">
        <button onclick="loadAdminFinance('pending')" class="flex-1 py-2 bg-yellow-100 text-yellow-800 rounded text-xs font-bold border border-yellow-200">Pending Listings</button>
        <button onclick="loadAdminRequests()" class="flex-1 py-2 bg-blue-100 text-blue-800 rounded text-xs font-bold border border-blue-200">User Requests</button>
    </div>

    <div id="admin-finance-list" class="p-4 space-y-3 overflow-y-auto h-full pb-24">
        <div class="text-center text-gray-400 mt-10">Loading...</div>
    </div>
</div>
    <div id="bid-modal" class="hidden absolute inset-0 z-[80] bg-black/80 backdrop-blur-sm flex items-end justify-center">
        <div class="bg-white w-full rounded-t-2xl p-6 slide-up">
            <div class="flex justify-between items-center mb-4">
                <h3 class="font-bold text-xl text-gray-900">Place Bid</h3>
                <button onclick="closeBidModal()" class="text-gray-400"><i class="fas fa-times text-xl"></i></button>
            </div>
            
            <div class="flex gap-4 mb-6">
                <div class="w-24 h-24 bg-gray-200 rounded-lg overflow-hidden shrink-0">
                    <img id="bid-img" src="" class="w-full h-full object-cover">
                </div>
                <div>
                    <h4 id="bid-title" class="font-bold text-sm mb-1">...</h4>
                    <div class="text-xs text-gray-500 mb-2">Current Highest Bid:</div>
                    <div id="bid-current-price" class="text-2xl font-bold text-kivu-orange">...</div>
                </div>
            </div>

            <div class="grid grid-cols-3 gap-2 mb-4">
    <button id="btn-bid-100" onclick="setBidAmount(100)" class="bid-btn py-3 border border-gray-200 rounded font-bold hover:bg-gray-50 text-sm transition">+ $100</button>
    <button id="btn-bid-500" onclick="setBidAmount(500)" class="bid-btn py-3 border border-gray-200 rounded font-bold hover:bg-gray-50 text-sm transition">+ $500</button>
    <button id="btn-bid-1000" onclick="setBidAmount(1000)" class="bid-btn py-3 border border-gray-200 rounded font-bold hover:bg-gray-50 text-sm transition">+ $1,000</button>
</div>

            <div class="flex items-start gap-3 mb-6 p-3 bg-gray-50 rounded-xl border border-gray-200 hover:border-kivu-teal transition cursor-pointer" onclick="document.getElementById('bid-confirm-check').click()">
                <div class="relative flex items-center">
                    <input type="checkbox" id="bid-confirm-check" 
                           class="w-5 h-5 accent-kivu-teal border-gray-300 rounded focus:ring-kivu-teal cursor-pointer" 
                           onchange="toggleBidButton()" onclick="event.stopPropagation()">
                </div>
                <div class="text-xs text-gray-600 leading-snug select-none">
                    I agree to the <span class="font-bold text-gray-800">Terms of Service</span>. 
                    I understand that bids are binding and <span class="text-red-500 font-bold">cannot be withdrawn</span>.
                </div>
            </div>

            <button id="btn-confirm-bid" onclick="submitBid()" disabled 
                class="w-full bg-gray-300 text-gray-500 font-bold py-4 rounded-xl shadow-none cursor-not-allowed transition-all duration-300 text-lg">
                Confirm Bid
            </button>
        </div>
    </div>
    <div id="auction-detail-modal" class="hidden absolute inset-0 z-[70] bg-white flex flex-col slide-up overflow-y-auto">
    </div>
    <div id="agent-chat-modal" class="hidden absolute inset-0 z-[80] bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 fade-in">
    <div class="bg-white rounded-xl shadow-2xl w-full max-w-sm overflow-hidden slide-up flex flex-col h-[500px]"> <div class="bg-kivu-teal text-white p-4 flex justify-between items-center shrink-0">
            <div>
                <h3 class="font-bold"><i class="fas fa-headset mr-2"></i>Support Agent</h3>
                <p class="text-[10px] opacity-80" id="chat-lot-title">Lot #...</p>
            </div>
            <button onclick="closeAgentChat()"><i class="fas fa-times"></i></button>
        </div>

        <div id="chat-history" class="flex-1 overflow-y-auto p-4 bg-gray-50 flex flex-col gap-3">
            </div>

        <div class="p-3 bg-white border-t border-gray-200 shrink-0">
            <div class="flex gap-2">
                <input type="text" id="chat-message" class="flex-1 border border-gray-300 rounded-full px-4 py-2 text-sm focus:border-kivu-teal outline-none" placeholder="Type a message...">
                <button onclick="sendAgentMessage()" id="btn-send-chat" class="bg-kivu-teal text-white w-10 h-10 rounded-full flex items-center justify-center shadow hover:bg-teal-700 transition">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
            <div id="chat-timer-msg" class="text-[9px] text-red-500 text-center mt-1 hidden">Please wait 5s before sending...</div>
        </div>
    </div>
    </div>
</div>
            

            <div id="settings-modal" class="hidden absolute inset-0 z-[70] bg-black/60 backdrop-blur-sm flex items-end justify-center fade-in">
                <div class="bg-white rounded-t-2xl shadow-2xl w-full max-w-md p-6 slide-up h-[80%] overflow-y-auto">
                    <button onclick="toggleSettings()" class="absolute top-4 right-4 text-gray-500"><i class="fas fa-times text-xl"></i></button>
                    <h2 class="text-xl font-bold text-kivu-teal mb-6">Settings</h2>
                    
                    <div class="mb-6">
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-3">Language</label>
                        <div class="grid grid-cols-2 gap-3">
                            <button onclick="setLang('en')" id="btn-lang-en" class="lang-btn p-3 rounded-lg border text-sm font-bold flex items-center gap-2"><img src="https://flagcdn.com/w20/gb.png"> English</button>
                            <button onclick="setLang('fr')" id="btn-lang-fr" class="lang-btn p-3 rounded-lg border text-sm font-bold flex items-center gap-2"><img src="https://flagcdn.com/w20/fr.png"> Fran√ßais</button>
                            <button onclick="setLang('sw')" id="btn-lang-sw" class="lang-btn p-3 rounded-lg border text-sm font-bold flex items-center gap-2"><img src="https://flagcdn.com/w20/tz.png"> Kiswahili</button>
                            <button onclick="setLang('rw')" id="btn-lang-rw" class="lang-btn p-3 rounded-lg border text-sm font-bold flex items-center gap-2"><img src="https://flagcdn.com/w20/rw.png"> Kinyarwanda</button>
                            <button onclick="setLang('lg')" id="btn-lang-lg" class="lang-btn p-3 rounded-lg border text-sm font-bold flex items-center gap-2"><img src="https://flagcdn.com/w20/ug.png"> Luganda</button>
                            <button onclick="setLang('am')" id="btn-lang-am" class="lang-btn p-3 rounded-lg border text-sm font-bold flex items-center gap-2"><img src="https://flagcdn.com/w20/et.png"> Amharic</button>
                        </div>
                    </div>

                    <div class="mb-8">
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-3">Currency</label>
                        <div class="grid grid-cols-3 gap-2">
                            <button onclick="setCurr('RWF')" id="btn-curr-RWF" class="curr-btn py-2 rounded-lg border text-xs font-bold">RWF (Rwanda)</button>
                            <button onclick="setCurr('KES')" id="btn-curr-KES" class="curr-btn py-2 rounded-lg border text-xs font-bold">KES (Kenya)</button>
                            <button onclick="setCurr('UGX')" id="btn-curr-UGX" class="curr-btn py-2 rounded-lg border text-xs font-bold">UGX (Uganda)</button>
                            <button onclick="setCurr('TZS')" id="btn-curr-TZS" class="curr-btn py-2 rounded-lg border text-xs font-bold">TZS (Tanzania)</button>
                            <button onclick="setCurr('BIF')" id="btn-curr-BIF" class="curr-btn py-2 rounded-lg border text-xs font-bold">BIF (Burundi)</button>
                            <button onclick="setCurr('CDF')" id="btn-curr-CDF" class="curr-btn py-2 rounded-lg border text-xs font-bold">CDF (Congo)</button>
                            <button onclick="setCurr('ETB')" id="btn-curr-ETB" class="curr-btn py-2 rounded-lg border text-xs font-bold">ETB (Ethiopia)</button>
                        </div>
                    </div>
                    
                    <button onclick="toggleSettings()" class="w-full bg-kivu-teal text-white font-bold py-3 rounded-lg shadow-md">Done</button>
                </div>
            </div>

            <div id="all-cats-modal" class="hidden absolute inset-0 z-[70] bg-white flex flex-col slide-up"><div class="bg-kivu-dark text-white p-4 flex items-center gap-3 shadow-md shrink-0"><button onclick="toggleAllCats()"><i class="fas fa-arrow-left text-lg"></i></button><h2 class="font-bold text-lg">All Categories</h2></div><div class="flex-1 overflow-y-auto p-2 bg-gray-50"><div class="grid grid-cols-2 gap-2" id="full-cat-grid"></div></div></div>
            <div id="product-detail-modal" class="hidden absolute inset-0 z-[70] bg-white flex flex-col slide-up overflow-y-auto pb-24"></div>
            <div id="local-ad-detail-modal" class="hidden absolute inset-0 z-[70] bg-white flex flex-col slide-up overflow-y-auto"></div>
            <div id="seller-profile-modal" class="hidden absolute inset-0 z-[70] bg-white flex flex-col slide-up overflow-y-auto"></div>

            <div id="create-ad-modal" class="hidden absolute inset-0 z-[70] bg-white flex flex-col slide-up overflow-y-auto">
                <div class="bg-kivu-teal text-white p-4 flex items-center gap-3 shadow-md shrink-0 sticky top-0 z-10"><button onclick="toggleCreateAd()"><i class="fas fa-times text-lg"></i></button><h2 class="font-bold text-lg">Post Ad</h2></div>
                <div class="p-5 pb-24">
                    <div class="mb-6">
    <div class="flex gap-2 overflow-x-auto pb-2" id="ad-previews-container">
        <label for="ad-file" class="w-20 h-20 shrink-0 bg-gray-100 rounded-lg flex flex-col items-center justify-center cursor-pointer border-2 border-dashed border-gray-300 hover:border-kivu-teal">
            <i class="fas fa-camera text-gray-400 text-xl"></i>
            <span class="text-[9px] text-gray-500 uppercase font-bold mt-1">Add (Max 5)</span>
        </label>
    </div>
    <input type="file" id="ad-file" class="hidden" accept="image/*" multiple onchange="previewAdImages(this)">
</div>
                    <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Title</label>
<input type="text" id="ad-title" class="w-full border border-gray-200 rounded p-3 text-sm mb-4" placeholder="Item name">

<label class="block text-xs font-bold text-gray-500 uppercase mb-2">Deal Type</label>
<select id="ad-type" class="w-full border border-gray-200 rounded p-3 text-sm mb-4 bg-white font-bold text-kivu-teal">
    <option value="SALE">üî• For Sale </option>
    <option value="RENT">üìÖ For Rent </option>
    <option value="JOB">üíº Job Offer </option>
    <option value="SERVICE">üõ†Ô∏è Service </option>
</select>

                    <label class="block text-xs font-bold text-gray-500 uppercase mb-2" data-i18n="price">Price</label>
<div class="flex gap-2 mb-4">
    <input type="number" id="ad-price" class="w-2/3 border border-gray-200 rounded p-3 text-sm" placeholder="e.g. 5000">
    <select id="ad-currency" class="w-1/3 border border-gray-200 rounded p-3 text-sm bg-white font-bold text-kivu-teal">
        <option value="RWF">RWF</option>
        <option value="KES">KES</option>
        <option value="UGX">UGX</option>
        <option value="TZS">TZS</option>
        <option value="BIF">BIF</option>
        <option value="CDF">CDF</option>
        <option value="ETB">ETB</option>
        <option value="USD">USD</option>
    </select>
</div>
                    
                    <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Category</label>
                    <select id="ad-category" class="w-full border border-gray-200 rounded p-3 text-sm mb-4 bg-white">
                        <option value="real_estate">üè† Real Estate</option>
                        <option value="vehicles">üöó Vehicles</option>
                        <option value="electronics">üì± Phones & Tablets</option>
                        <option value="computers">üíª Computers</option>
                        <option value="accessories">üîå Accessories</option>
                        <option value="jobs">üíº Jobs</option>
                        <option value="services">üõ†Ô∏è Services</option>
                        <option value="fashion">üëó Fashion</option>
                        <option value="home">üõãÔ∏è Home & Garden</option>
                        <option value="sports">‚öΩ Sports</option>
                        <option value="kids">üß∏ Kids</option>
                        <option value="animals">üê∂ Animals</option>
                        <option value="agriculture">üåΩ Agriculture</option>
                        <option value="construction">üß± Construction</option>
                        <option value="other">üì¶ Other</option>
                    </select>
                    <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Description</label>
<textarea id="ad-desc" rows="4" class="w-full border border-gray-200 rounded p-3 text-sm mb-4" placeholder="Describe item condition, rental terms, etc..."></textarea>
                    
                    <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Location</label>
                    <div class="flex gap-2 mb-4">
                        <select id="ad-country" class="w-1/2 border border-gray-200 rounded p-3 text-sm bg-white" onchange="updateCitySelect('ad-city', this.value)">
                            <option value="Rwanda">Rwanda</option><option value="Kenya">Kenya</option><option value="Uganda">Uganda</option><option value="Tanzania">Tanzania</option><option value="Burundi">Burundi</option><option value="DRC">DRC</option><option value="Ethiopia">Ethiopia</option>
                        </select>
                        <select id="ad-city" class="w-1/2 border border-gray-200 rounded p-3 text-sm bg-white"><option>Kigali</option></select>
                    </div>
                    <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Pin Location on Map</label>
<div id="picker-map" class="w-full h-40 bg-gray-200 rounded-lg mb-4 border border-gray-300 z-0"></div>
<input type="hidden" id="ad-lat"><input type="hidden" id="ad-lng">
                    <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Phone</label><input type="tel" id="ad-phone" class="w-full border border-gray-200 rounded p-3 text-sm mb-6" placeholder="+250...">
                    <button onclick="submitAd()" class="w-full bg-kivu-teal text-white font-bold py-4 rounded-xl shadow-lg">Submit for Review</button>
                </div>
            </div>

            
        </div> <div id="toast" class="fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-black/80 text-white px-6 py-4 rounded-lg shadow-2xl opacity-0 pointer-events-none transition-all duration-300 z-50 text-center backdrop-blur">
            <div id="toast-icon" class="text-3xl mb-2"><i class="fas fa-check-circle"></i></div><p class="font-bold text-sm" id="toast-msg">Success!</p>
        </div>
    </div>
    
    
    <div id="promote-modal" class="hidden absolute inset-0 z-[70] bg-black/60 backdrop-blur-sm flex items-center justify-center p-4 fade-in">
    <div class="bg-white rounded-xl shadow-2xl w-full max-w-sm overflow-hidden relative slide-up">
        <div class="bg-gradient-to-r from-kivu-teal to-kivu-dark p-4 text-white text-center relative">
            <button onclick="togglePromoteModal()" class="absolute top-4 right-4 text-white/80 hover:text-white"><i class="fas fa-times"></i></button>
            <div class="w-12 h-12 bg-white/20 rounded-full flex items-center justify-center mx-auto mb-2 text-2xl border-2 border-white/30">
                <i class="fas fa-rocket"></i>
            </div>
            <h2 class="text-lg font-bold">–ü–æ–¥–Ω—è—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ</h2>
            <p class="text-xs opacity-80">–ü–æ–ª—É—á–∏—Ç–µ –≤ 10 —Ä–∞–∑ –±–æ–ª—å—à–µ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤</p>
        </div>
        
        <div class="p-6">
            <div class="bg-blue-50 border border-blue-100 rounded-lg p-4 mb-4">
                <h3 class="text-xs font-bold text-blue-800 uppercase mb-2 flex items-center gap-2"><i class="fas fa-info-circle"></i> –£—Å–ª–æ–≤–∏—è –∏ –¶–µ–Ω—ã</h3>
                <p id="promo-content-text" class="text-sm text-gray-700 whitespace-pre-line leading-relaxed">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
            </div>

            <div id="admin-edit-container"></div>

            <button onclick="confirmPromote()" class="w-full bg-kivu-teal text-white font-bold py-3 rounded-xl shadow-lg hover:bg-teal-700 transition active:scale-95 mt-2">
                –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å
            </button>
            <p class="text-[10px] text-gray-400 text-center mt-3">–ù–∞–∂–∏–º–∞—è, –≤—ã —Å–æ–≥–ª–∞—à–∞–µ—Ç–µ—Å—å —Å —É—Å–ª–æ–≤–∏—è–º–∏ —Å–µ—Ä–≤–∏—Å–∞.</p>
        </div>
    </div>
</div>

<div id="module-forum" class="hidden h-full flex flex-col bg-gray-50 fixed inset-0 z-[60]">
    <div class="bg-indigo-900 text-white p-4 shadow-md shrink-0 flex justify-between items-center">
        <div class="flex items-center gap-3">
            <button onclick="closeSuperModule()" class="w-8 h-8 rounded-full bg-white/20 flex items-center justify-center"><i class="fas fa-arrow-left"></i></button>
            <h2 class="font-bold text-lg">Community Forum</h2>
        </div>
        <button onclick="openCreateTopic()" class="bg-indigo-500 hover:bg-indigo-400 text-white px-3 py-1.5 rounded-full text-xs font-bold shadow transition">
            <i class="fas fa-plus mr-1"></i> New Topic
        </button>
    </div>

    <div id="forum-feed-view" class="flex-1 overflow-y-auto p-3 pb-24 space-y-3">
        </div>

    <div id="forum-topic-view" class="hidden flex-1 flex flex-col h-full bg-white relative slide-up">
        <div class="bg-gray-100 border-b p-3 flex items-center gap-2 shrink-0">
            <button onclick="closeForumTopic()" class="text-gray-600 px-2"><i class="fas fa-arrow-left"></i> Back</button>
        </div>
        
        <div id="forum-topic-content" class="flex-1 overflow-y-auto p-4 pb-24">
            <div id="topic-header-container" class="mb-6 border-b pb-4"></div>
            <div id="comments-container" class="space-y-4"></div>
        </div>

        <div class="p-3 bg-gray-50 border-t border-gray-200 shrink-0">
            <div id="reply-preview" class="hidden text-xs text-gray-500 mb-2 flex justify-between bg-white p-2 rounded border">
                <span>Replying to...</span>
                <button onclick="cancelReply()" class="text-red-500 font-bold">Cancel</button>
            </div>
            <div class="flex gap-2">
                <input type="text" id="comment-input" class="flex-1 border border-gray-300 rounded-full px-4 py-2 text-sm outline-none focus:border-indigo-500" placeholder="Write a comment...">
                <button onclick="sendComment()" class="bg-indigo-600 text-white w-10 h-10 rounded-full shadow flex items-center justify-center hover:bg-indigo-700">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </div>

    <div id="create-topic-modal" class="hidden absolute inset-0 z-[70] bg-white flex flex-col slide-up">
        <div class="bg-indigo-900 text-white p-4 flex items-center gap-3 shadow-md shrink-0">
            <button onclick="toggleCreateTopic()"><i class="fas fa-times text-lg"></i></button>
            <h2 class="font-bold text-lg">Start Discussion</h2>
        </div>
        <div class="p-5">
            <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Subject</label>
            <input type="text" id="new-topic-title" class="w-full border border-gray-200 rounded p-3 text-sm mb-4 font-bold" placeholder="What is this about?">
            
            <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Message</label>
            <textarea id="new-topic-content" rows="6" class="w-full border border-gray-200 rounded p-3 text-sm mb-6" placeholder="Share your thoughts..."></textarea>
            
            <button onclick="submitTopic()" class="w-full bg-indigo-600 text-white font-bold py-3 rounded-xl shadow-lg">Post Topic</button>
        </div>
    </div>
</div>
<div id="module-education" class="hidden h-full flex flex-col bg-gray-50 fixed inset-0 z-[60]">
    <div class="bg-blue-600 text-white p-4 shadow-md shrink-0 flex justify-between items-center relative overflow-hidden">
        <div class="absolute -top-4 -right-4 w-24 h-24 bg-white/10 rounded-full"></div>
        <div class="absolute bottom-0 left-10 w-16 h-16 bg-white/10 rounded-full"></div>
        
        <div class="flex items-center gap-3 relative z-10">
            <button onclick="closeSuperModule()" class="w-8 h-8 rounded-full bg-white/20 flex items-center justify-center hover:bg-white/30 transition"><i class="fas fa-arrow-left"></i></button>
            <div>
                <h2 class="font-bold text-lg leading-none">My School</h2>
                <span class="text-[10px] opacity-80 uppercase font-bold tracking-wider">Student Dashboard</span>
            </div>
        </div>
        <button onclick="openAddEduModal()" class="relative z-10 bg-white text-blue-600 px-3 py-1.5 rounded-full text-xs font-bold shadow-lg active:scale-95 transition">
            <i class="fas fa-plus mr-1"></i> Add
        </button>
    </div>

    <div class="bg-white p-2 shadow-sm border-b flex gap-2 shrink-0">
        <button onclick="switchEduTab('schedule')" id="edu-tab-schedule" class="flex-1 py-2 rounded-lg text-xs font-bold bg-blue-50 text-blue-700 border border-blue-100">üìÖ Schedule</button>
        <button onclick="switchEduTab('tasks')" id="edu-tab-tasks" class="flex-1 py-2 rounded-lg text-xs font-bold text-gray-500 hover:bg-gray-50">üìù Homework</button>
        <button onclick="switchEduTab('grades')" id="edu-tab-grades" class="flex-1 py-2 rounded-lg text-xs font-bold text-gray-500 hover:bg-gray-50">üèÜ Grades</button>
    </div>

    <div class="flex-1 overflow-y-auto relative bg-gray-50">
        
        <div id="edu-view-schedule" class="p-4 space-y-4 pb-24">
            <div class="flex justify-between items-center bg-white p-2 rounded-xl shadow-sm border border-gray-100 mb-2">
                <button onclick="changeEduDay(-1)" class="w-8 h-8 flex items-center justify-center text-gray-400"><i class="fas fa-chevron-left"></i></button>
                <div class="text-center">
                    <div class="text-xs text-gray-400 font-bold uppercase" id="edu-date-display">Today</div>
                    <div class="font-bold text-lg text-blue-900" id="edu-day-display">Monday</div>
                </div>
                <button onclick="changeEduDay(1)" class="w-8 h-8 flex items-center justify-center text-gray-400"><i class="fas fa-chevron-right"></i></button>
            </div>

            <div id="schedule-list" class="space-y-3">
                </div>
        </div>

        <div id="edu-view-tasks" class="hidden p-4 space-y-4 pb-24">
            <div class="flex justify-between items-center mb-2">
                <h3 class="font-bold text-gray-700">Pending Tasks</h3>
                <span id="tasks-count" class="bg-red-100 text-red-600 text-xs font-bold px-2 py-0.5 rounded-full">0</span>
            </div>
            <div id="tasks-list" class="space-y-2"></div>
        </div>

        <div id="edu-view-grades" class="hidden p-4 space-y-4 pb-24">
            <div class="bg-gradient-to-r from-purple-500 to-indigo-600 text-white p-5 rounded-2xl shadow-lg text-center mb-4 relative overflow-hidden">
                <i class="fas fa-medal absolute -bottom-6 -right-6 text-9xl text-white/10"></i>
                <div class="text-xs uppercase font-bold opacity-80 mb-1">Overall GPA (Average)</div>
                <div id="gpa-score" class="text-5xl font-bold mb-1">0.0</div>
                <div class="text-xs opacity-90">Keep it up!</div>
            </div>
            <div id="grades-list" class="grid grid-cols-1 gap-3"></div>
        </div>
    </div>

    <div id="edu-add-modal" class="hidden absolute inset-0 z-[70] bg-black/60 backdrop-blur-sm flex items-end justify-center fade-in">
        <div class="bg-white rounded-t-2xl w-full p-6 slide-up h-[80%] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 class="font-bold text-xl text-blue-900">Add New</h3>
                <button onclick="toggleEduModal()" class="w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center text-gray-500"><i class="fas fa-times"></i></button>
            </div>

            <div class="flex gap-2 mb-6 border-b pb-4">
                <button onclick="setAddType('task')" id="btn-add-task" class="flex-1 py-2 bg-blue-600 text-white rounded-lg text-xs font-bold shadow-md transition">Task</button>
                <button onclick="setAddType('grade')" id="btn-add-grade" class="flex-1 py-2 bg-gray-100 text-gray-600 rounded-lg text-xs font-bold transition">Grade</button>
                <button onclick="setAddType('subject')" id="btn-add-subject" class="flex-1 py-2 bg-gray-100 text-gray-600 rounded-lg text-xs font-bold transition">Subject</button>
            </div>

            <div id="form-add-task">
                <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Subject</label>
                <select id="task-subject" class="w-full border rounded p-3 mb-4 text-sm bg-white font-bold text-gray-700"></select>
                <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Homework / Assignment</label>
                <input type="text" id="task-title" class="w-full border rounded p-3 mb-4 text-sm" placeholder="e.g. Solve page 42">
                <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Due Date</label>
                <input type="date" id="task-date" class="w-full border rounded p-3 mb-6 text-sm">
                <button onclick="submitEduTask()" class="w-full bg-blue-600 text-white font-bold py-3 rounded-xl shadow-lg">Add Homework</button>
            </div>

            <div id="form-add-grade" class="hidden">
                <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Subject</label>
                <select id="grade-subject" class="w-full border rounded p-3 mb-4 text-sm bg-white font-bold text-gray-700"></select>
                <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Score / Grade</label>
                <input type="number" id="grade-score" class="w-full border rounded p-3 mb-6 text-sm" placeholder="e.g. 95 or 5">
                <button onclick="submitEduGrade()" class="w-full bg-purple-600 text-white font-bold py-3 rounded-xl shadow-lg">Add Grade</button>
            </div>

            <div id="form-add-subject" class="hidden">
                <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Subject Name</label>
                <input type="text" id="subj-name" class="w-full border rounded p-3 mb-4 text-sm" placeholder="e.g. Physics">
                <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Teacher Name</label>
                <input type="text" id="subj-teacher" class="w-full border rounded p-3 mb-4 text-sm" placeholder="e.g. Mr. Smith">
                <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Color</label>
                <div class="flex gap-2 mb-6">
                    <div onclick="selectColor('bg-red-500')" class="w-8 h-8 rounded-full bg-red-500 cursor-pointer hover:scale-110 border-2 border-transparent hover:border-black"></div>
                    <div onclick="selectColor('bg-blue-500')" class="w-8 h-8 rounded-full bg-blue-500 cursor-pointer hover:scale-110 border-2 border-transparent hover:border-black"></div>
                    <div onclick="selectColor('bg-green-500')" class="w-8 h-8 rounded-full bg-green-500 cursor-pointer hover:scale-110 border-2 border-transparent hover:border-black"></div>
                    <div onclick="selectColor('bg-yellow-500')" class="w-8 h-8 rounded-full bg-yellow-500 cursor-pointer hover:scale-110 border-2 border-transparent hover:border-black"></div>
                    <div onclick="selectColor('bg-purple-500')" class="w-8 h-8 rounded-full bg-purple-500 cursor-pointer hover:scale-110 border-2 border-transparent hover:border-black"></div>
                </div>
                <input type="hidden" id="subj-color" value="bg-blue-500">
                <button onclick="submitEduSubject()" class="w-full bg-gray-800 text-white font-bold py-3 rounded-xl shadow-lg">Create Subject</button>
            </div>
        </div>
    </div>
</div>
<div id="module-invest" class="hidden h-full flex flex-col bg-gray-50 fixed inset-0 z-[60]">
    <div class="bg-emerald-900 text-white p-4 pb-16 shadow-md shrink-0 relative overflow-hidden">
        <div class="absolute top-0 right-0 w-40 h-40 bg-white/5 rounded-full blur-2xl -mr-10 -mt-10"></div>
        
        <div class="flex justify-between items-center relative z-10 mb-4">
            <button onclick="closeSuperModule()" class="w-8 h-8 rounded-full bg-white/20 flex items-center justify-center hover:bg-white/30 transition"><i class="fas fa-arrow-left"></i></button>
            <h2 class="font-bold text-lg tracking-wide">Kivu Finance</h2>
            <button class="w-8 h-8 rounded-full bg-white/20 flex items-center justify-center"><i class="fas fa-bell"></i></button>
        </div>

        <div class="text-center relative z-10">
            <p class="text-emerald-300 text-xs font-bold uppercase tracking-wider mb-1">Total Portfolio Value</p>
            <h1 class="text-4xl font-bold text-white mb-2">$<span id="invest-total-balance">0.00</span></h1>
            <div id="invest-pnl" class="inline-flex items-center gap-1 bg-white/10 px-3 py-1 rounded-full text-xs font-bold text-green-400 backdrop-blur-sm">
                <i class="fas fa-arrow-up"></i> +$0.00 (0%)
            </div>
        </div>

        <div class="absolute -bottom-6 left-4 right-4 bg-white rounded-xl shadow-lg p-1 flex z-20">
            <button onclick="switchInvestTab('market')" id="tab-inv-market" class="flex-1 py-3 rounded-lg text-xs font-bold bg-emerald-900 text-white shadow-md transition">üìà Market</button>
            <button onclick="switchInvestTab('portfolio')" id="tab-inv-portfolio" class="flex-1 py-3 rounded-lg text-xs font-bold text-gray-500 hover:bg-gray-50 transition">üíº My Assets</button>
            <button onclick="switchInvestTab('insurance')" id="tab-inv-insurance" class="flex-1 py-3 rounded-lg text-xs font-bold text-gray-500 hover:bg-gray-50 transition">üõ°Ô∏è Insurance</button>
        </div>
    </div>

    <div class="flex-1 overflow-y-auto pt-10 pb-24 bg-gray-50 relative">
        
        <div id="view-inv-market" class="px-4 space-y-4 fade-in">
            <div class="flex gap-2 overflow-x-auto no-scrollbar pb-2">
                <button onclick="filterInvest('all')" class="px-4 py-1.5 bg-emerald-100 text-emerald-800 rounded-full text-xs font-bold border border-emerald-200">All</button>
                <button onclick="filterInvest('crypto')" class="px-4 py-1.5 bg-white text-gray-600 rounded-full text-xs font-bold border border-gray-200">Crypto</button>
                <button onclick="filterInvest('stock')" class="px-4 py-1.5 bg-white text-gray-600 rounded-full text-xs font-bold border border-gray-200">Stocks</button>
                <button onclick="filterInvest('bond')" class="px-4 py-1.5 bg-white text-gray-600 rounded-full text-xs font-bold border border-gray-200">Bonds</button>
            </div>

            <div id="invest-assets-list" class="space-y-3"></div>
        </div>

        <div id="view-inv-portfolio" class="hidden px-4 space-y-4 fade-in">
            <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-100">
                <h3 class="font-bold text-sm mb-3">Asset Allocation</h3>
                <div class="h-2 w-full bg-gray-100 rounded-full overflow-hidden flex" id="portfolio-bar">
                    </div>
                <div class="flex gap-4 mt-3 text-[10px] font-bold text-gray-500" id="portfolio-legend"></div>
            </div>
            
            <h3 class="font-bold text-gray-700 text-sm mt-4">Your Holdings</h3>
            <div id="invest-my-list" class="space-y-3">
                <p class="text-center text-gray-400 py-4 text-xs">You have no assets yet.</p>
            </div>
        </div>

        <div id="view-inv-insurance" class="hidden px-4 space-y-4 fade-in">
            <div id="my-policies-container" class="space-y-3">
                </div>

            <h3 class="font-bold text-gray-700 text-sm mt-4">Get Protection</h3>
            <div id="insurance-plans-list" class="grid grid-cols-1 gap-3"></div>
        </div>
    </div>

    <div id="buy-asset-modal" class="hidden absolute inset-0 z-[70] bg-black/60 backdrop-blur-sm flex items-end justify-center fade-in">
        <div class="bg-white rounded-t-2xl w-full p-6 slide-up">
            <div class="flex justify-between items-center mb-4">
                <div>
                    <h3 class="font-bold text-xl text-gray-900" id="buy-modal-title">Buy Asset</h3>
                    <p class="text-xs text-gray-500" id="buy-modal-price">Current Price: $0.00</p>
                </div>
                <button onclick="toggleBuyModal()" class="w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center"><i class="fas fa-times"></i></button>
            </div>

            <div class="bg-gray-50 p-4 rounded-xl mb-4 border border-gray-100">
                <label class="block text-xs font-bold text-gray-400 uppercase mb-1">Amount to Buy ($)</label>
                <input type="number" id="buy-amount-usd" oninput="calcBuyQty()" class="w-full bg-transparent text-2xl font-bold text-gray-800 outline-none" placeholder="0.00">
            </div>

            <div class="flex justify-between text-xs font-bold text-gray-500 mb-6">
                <span>You receive approx:</span>
                <span id="buy-qty-display">0.00 UNITS</span>
            </div>

            <button onclick="confirmBuyAsset()" class="w-full bg-emerald-600 text-white font-bold py-4 rounded-xl shadow-lg hover:bg-emerald-700 transition">Confirm Purchase</button>
        </div>
    </div>
</div>
<div id="module-pay" class="hidden h-full flex flex-col bg-gray-900 fixed inset-0 z-[60]">
    <div class="p-5 flex justify-between items-center text-white">
        <button onclick="closeSuperModule()" class="w-8 h-8 rounded-full bg-white/10 flex items-center justify-center hover:bg-white/20"><i class="fas fa-arrow-left"></i></button>
        <div class="font-bold text-lg tracking-wider">Kivu<span class="text-teal-400">Pay</span></div>
        <button onclick="initPay()" class="w-8 h-8 rounded-full bg-white/10 flex items-center justify-center hover:bg-white/20"><i class="fas fa-sync-alt text-xs"></i></button>
    </div>

    <div class="px-5 mb-6">
        <div class="bg-gradient-to-br from-teal-600 to-emerald-900 rounded-2xl p-6 shadow-2xl relative overflow-hidden border border-white/10 h-48 flex flex-col justify-between">
            <div class="absolute -top-10 -right-10 w-40 h-40 bg-white/10 rounded-full blur-2xl"></div>
            
            <div class="flex justify-between items-start relative z-10">
                <span class="text-xs font-bold text-teal-100 tracking-widest uppercase">Total Balance</span>
                <i class="fas fa-wifi text-white/50 rotate-90"></i>
            </div>

            <div class="relative z-10">
                <h1 class="text-4xl font-bold text-white tracking-tight flex items-baseline gap-1">
                    <span id="pay-balance">0.00</span> 
                    <span class="text-sm text-teal-200 font-normal">KVC</span>
                </h1>
            </div>

            <div class="flex justify-between items-end relative z-10">
                <div class="text-xs text-teal-100 font-mono tracking-widest" id="pay-wallet-id">ID: Loading...</div>
                <div class="flex items-center gap-1">
                    <div class="w-6 h-6 rounded-full bg-red-500/80"></div>
                    <div class="w-6 h-6 rounded-full bg-yellow-500/80 -ml-3"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="px-5 grid grid-cols-4 gap-4 mb-6 text-white">
        <button onclick="openSendModal()" class="flex flex-col items-center gap-2 group">
            <div class="w-12 h-12 rounded-full bg-teal-500 flex items-center justify-center text-xl shadow-lg group-active:scale-90 transition"><i class="fas fa-paper-plane"></i></div>
            <span class="text-xs font-bold opacity-80">Send</span>
        </button>
        <button onclick="openReceiveModal()" class="flex flex-col items-center gap-2 group">
            <div class="w-12 h-12 rounded-full bg-gray-700 flex items-center justify-center text-xl shadow-lg group-active:scale-90 transition"><i class="fas fa-qrcode"></i></div>
            <span class="text-xs font-bold opacity-80">Receive</span>
        </button>
        <button onclick="showToast('Use Credit Card')" class="flex flex-col items-center gap-2 group">
            <div class="w-12 h-12 rounded-full bg-gray-700 flex items-center justify-center text-xl shadow-lg group-active:scale-90 transition"><i class="fas fa-plus"></i></div>
            <span class="text-xs font-bold opacity-80">Top Up</span>
        </button>
        <button onclick="showToast('History')" class="flex flex-col items-center gap-2 group">
            <div class="w-12 h-12 rounded-full bg-gray-700 flex items-center justify-center text-xl shadow-lg group-active:scale-90 transition"><i class="fas fa-history"></i></div>
            <span class="text-xs font-bold opacity-80">History</span>
        </button>
    </div>

    <div class="flex-1 bg-gray-50 rounded-t-[30px] overflow-hidden flex flex-col">
        <div class="p-5 pb-2 border-b border-gray-100 flex justify-between items-center">
            <h3 class="font-bold text-gray-800">Recent Transactions</h3>
            <span class="text-xs text-teal-600 font-bold">View All</span>
        </div>
        <div id="pay-tx-list" class="flex-1 overflow-y-auto p-5 space-y-4 pb-24">
            </div>
    </div>

    <div id="pay-send-modal" class="hidden absolute inset-0 z-[70] bg-black/80 backdrop-blur-sm flex items-end justify-center">
        <div class="bg-white w-full rounded-t-2xl p-6 slide-up">
            <div class="flex justify-between items-center mb-6">
                <h3 class="font-bold text-xl text-gray-900">Send Money</h3>
                <button onclick="document.getElementById('pay-send-modal').classList.add('hidden')" class="w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center text-gray-500"><i class="fas fa-times"></i></button>
            </div>

            <label class="block text-xs font-bold text-gray-400 uppercase mb-2">Receiver User ID</label>
            <div class="flex gap-2 mb-4">
                <input type="text" id="pay-send-id" class="flex-1 bg-gray-50 border border-gray-200 rounded-xl p-3 text-sm font-mono focus:border-teal-500 outline-none transition" placeholder="Paste ID here...">
                <button class="bg-gray-100 px-4 rounded-xl text-gray-600"><i class="fas fa-qrcode"></i></button>
            </div>

            <label class="block text-xs font-bold text-gray-400 uppercase mb-2">Amount (KVC)</label>
            <div class="relative mb-6">
                <input type="number" id="pay-send-amount" class="w-full bg-gray-50 border border-gray-200 rounded-xl p-4 text-2xl font-bold text-gray-900 focus:border-teal-500 outline-none transition" placeholder="0.00">
                <span class="absolute right-4 top-5 text-gray-400 font-bold text-sm">KVC</span>
            </div>

            <button onclick="submitTransfer()" class="w-full bg-teal-600 text-white font-bold py-4 rounded-xl shadow-lg hover:bg-teal-700 transition active:scale-95 flex items-center justify-center gap-2">
                Send Now <i class="fas fa-arrow-right"></i>
            </button>
        </div>
    </div>

    <div id="pay-receive-modal" class="hidden absolute inset-0 z-[70] bg-black/90 backdrop-blur-sm flex items-center justify-center p-6 fade-in">
        <div class="bg-white rounded-2xl w-full max-w-sm p-8 text-center relative">
            <button onclick="document.getElementById('pay-receive-modal').classList.add('hidden')" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600"><i class="fas fa-times text-xl"></i></button>
            
            <h3 class="font-bold text-gray-800 text-xl mb-1">Receive Kivu Coin</h3>
            <p class="text-xs text-gray-400 mb-6">Scan to pay me</p>
            
            <div class="bg-white p-2 rounded-xl shadow-inner border border-gray-100 inline-block mb-4">
                <img id="pay-qr-code" src="" class="w-48 h-48 object-contain">
            </div>

            <div class="bg-gray-100 p-3 rounded-xl flex items-center justify-between gap-2">
                <span id="pay-my-id-full" class="font-mono text-xs text-gray-600 truncate">...</span>
                <button onclick="copyMyId()" class="text-teal-600 font-bold text-xs shrink-0">COPY</button>
            </div>
        </div>
    </div>
</div>
<div id="module-gov" class="hidden h-full flex flex-col bg-gray-50 fixed inset-0 z-[60]">
    <div class="bg-blue-700 text-white p-4 pb-12 shadow-md shrink-0 relative overflow-hidden">
        <div class="absolute top-0 right-0 w-32 h-32 bg-yellow-400/20 rounded-full blur-2xl -mr-10 -mt-10"></div>
        <div class="absolute bottom-0 left-0 w-24 h-24 bg-green-500/20 rounded-full blur-xl -ml-5 -mb-5"></div>
        
        <div class="flex items-center gap-3 relative z-10 mb-4">
            <button onclick="closeSuperModule()" class="w-8 h-8 rounded-full bg-white/20 flex items-center justify-center hover:bg-white/30 transition"><i class="fas fa-arrow-left"></i></button>
            <div>
                <h2 class="font-bold text-lg leading-none">E-Government</h2>
                <span class="text-[10px] opacity-80 uppercase font-bold tracking-wider">Irembo Integrated</span>
            </div>
        </div>

        <div class="relative z-10">
            <input type="text" id="gov-search" oninput="filterGovServices(this.value)" class="w-full bg-white/10 border border-white/20 text-white placeholder-blue-200 rounded-xl px-4 py-3 text-sm focus:bg-white/20 outline-none backdrop-blur-md" placeholder="Search service (e.g. Birth, Tax)...">
            <i class="fas fa-search absolute right-4 top-3.5 text-blue-200"></i>
        </div>
    </div>

    <div class="flex-1 overflow-y-auto -mt-6 relative z-20 pb-24 px-4">
        
        <div class="bg-white rounded-xl shadow-sm p-4 mb-4 border border-gray-100">
            <h3 class="font-bold text-xs text-gray-500 uppercase mb-3 flex items-center gap-2"><i class="fas fa-bolt text-yellow-500"></i> Quick Pay (Utilities & Taxes)</h3>
            <div class="grid grid-cols-4 gap-2">
                <div onclick="openBillModal('Traffic Fine', 'fas fa-traffic-light text-red-500')" class="flex flex-col items-center gap-1 cursor-pointer group">
                    <div class="w-12 h-12 bg-red-50 rounded-full flex items-center justify-center group-active:scale-90 transition border border-red-100"><i class="fas fa-traffic-light text-red-500 text-lg"></i></div>
                    <span class="text-[9px] font-bold text-center leading-tight">Traffic<br>Fines</span>
                </div>
                <div onclick="openBillModal('Electricity (REG)', 'fas fa-lightbulb text-yellow-500')" class="flex flex-col items-center gap-1 cursor-pointer group">
                    <div class="w-12 h-12 bg-yellow-50 rounded-full flex items-center justify-center group-active:scale-90 transition border border-yellow-100"><i class="fas fa-lightbulb text-yellow-500 text-lg"></i></div>
                    <span class="text-[9px] font-bold text-center leading-tight">Buy<br>Power</span>
                </div>
                <div onclick="openBillModal('Water (WASAC)', 'fas fa-tint text-blue-500')" class="flex flex-col items-center gap-1 cursor-pointer group">
                    <div class="w-12 h-12 bg-blue-50 rounded-full flex items-center justify-center group-active:scale-90 transition border border-blue-100"><i class="fas fa-tint text-blue-500 text-lg"></i></div>
                    <span class="text-[9px] font-bold text-center leading-tight">Water<br>Bill</span>
                </div>
                <div onclick="openBillModal('RRA Taxes', 'fas fa-building text-blue-800')" class="flex flex-col items-center gap-1 cursor-pointer group">
                    <div class="w-12 h-12 bg-gray-50 rounded-full flex items-center justify-center group-active:scale-90 transition border border-gray-100"><i class="fas fa-building text-blue-800 text-lg"></i></div>
                    <span class="text-[9px] font-bold text-center leading-tight">RRA<br>Taxes</span>
                </div>
            </div>
        </div>

        <h3 class="font-bold text-xs text-gray-500 uppercase mb-3 ml-1">All Services Catalogue</h3>
        <div id="gov-services-list" class="flex flex-col gap-3">
            </div>
    </div>

    <div id="gov-bill-modal" class="hidden absolute inset-0 z-[70] bg-black/60 backdrop-blur-sm flex items-end justify-center fade-in">
        <div class="bg-white rounded-t-2xl w-full p-6 slide-up">
            <div class="flex justify-between items-center mb-4">
                <div class="flex items-center gap-3">
                    <div id="bill-icon-container" class="w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center"></div>
                    <div>
                        <h3 class="font-bold text-lg text-gray-900" id="bill-title">Pay Bill</h3>
                        <p class="text-xs text-gray-500">Instant payment via Kivu Pay</p>
                    </div>
                </div>
                <button onclick="document.getElementById('gov-bill-modal').classList.add('hidden')" class="w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center text-gray-500"><i class="fas fa-times"></i></button>
            </div>

            <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Reference Number / ID</label>
            <input type="text" id="bill-ref" class="w-full border border-gray-200 rounded-xl p-3 text-sm mb-4 font-mono uppercase" placeholder="e.g. 123-456-789">

            <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Amount (RWF)</label>
            <input type="number" id="bill-amount" class="w-full border border-gray-200 rounded-xl p-3 text-lg font-bold mb-6" placeholder="0">

            <button onclick="processBillPay()" class="w-full bg-blue-600 text-white font-bold py-4 rounded-xl shadow-lg hover:bg-blue-700 transition flex justify-center gap-2 items-center">
                <i class="fas fa-check-circle"></i> Confirm Payment
            </button>
        </div>
    </div>

    <div id="gov-service-modal" class="hidden absolute inset-0 z-[70] bg-white flex flex-col slide-up">
        <div class="bg-blue-700 text-white p-4 flex items-center gap-3 shadow-md shrink-0">
            <button onclick="document.getElementById('gov-service-modal').classList.add('hidden')"><i class="fas fa-times text-lg"></i></button>
            <h2 class="font-bold text-lg" id="service-app-title">Apply</h2>
        </div>
        <div class="p-6 flex-1 overflow-y-auto">
            <div class="bg-blue-50 border border-blue-100 p-4 rounded-xl mb-6">
                <h3 class="font-bold text-blue-900 text-sm mb-2"><i class="fas fa-info-circle mr-1"></i> Requirements</h3>
                <ul class="text-xs text-blue-800 space-y-1 list-disc pl-4">
                    <li>Valid National ID / Passport</li>
                    <li>Supporting documents (PDF/JPG)</li>
                    <li>Application fee may apply</li>
                </ul>
            </div>

            <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Applicant Name</label>
            <input type="text" id="app-name" class="w-full border border-gray-200 rounded-xl p-3 text-sm mb-4 bg-gray-50" readonly>

            <label class="block text-xs font-bold text-gray-500 uppercase mb-2">National ID / Passport</label>
            <input type="text" class="w-full border border-gray-200 rounded-xl p-3 text-sm mb-4" placeholder="Enter ID number">

            <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Reason / Details</label>
            <textarea class="w-full border border-gray-200 rounded-xl p-3 text-sm mb-6 h-24" placeholder="Provide necessary details..."></textarea>

            <button onclick="submitGovApp()" class="w-full bg-blue-600 text-white font-bold py-4 rounded-xl shadow-lg">Submit Application</button>
        </div>
    </div>
</div>
<div id="module-play" class="hidden h-full flex flex-col bg-[#0f1014] fixed inset-0 z-[60] text-white">
    <div class="absolute top-0 left-0 w-full p-4 z-20 flex justify-between items-center bg-gradient-to-b from-black/80 to-transparent">
        <button onclick="closeSuperModule()" class="w-8 h-8 rounded-full bg-white/10 backdrop-blur flex items-center justify-center hover:bg-white/20"><i class="fas fa-arrow-left"></i></button>
        <div class="text-red-600 font-bold text-xl tracking-tighter uppercase italic">KIVU <span class="text-white">PLAY</span></div>
        <div class="w-8 h-8 rounded-full bg-red-600 flex items-center justify-center text-xs font-bold">KP</div>
    </div>

    <div id="play-feed" class="flex-1 overflow-y-auto no-scrollbar pb-24">
        <div id="play-hero" class="relative h-[60vh] w-full bg-gray-800">
            <img id="hero-img" src="" class="w-full h-full object-cover opacity-60">
            <div class="absolute bottom-0 left-0 w-full h-full bg-gradient-to-t from-[#0f1014] via-transparent to-transparent"></div>
            
            <div class="absolute bottom-8 left-0 w-full p-6">
                <div id="hero-genre" class="text-xs text-red-500 font-bold uppercase tracking-widest mb-2 flex items-center gap-2">
                    <span class="px-2 py-0.5 border border-red-500 rounded text-[9px]">TOP 10</span> Action
                </div>
                <h1 id="hero-title" class="text-4xl font-extrabold mb-2 leading-none drop-shadow-lg">Loading...</h1>
                <p id="hero-desc" class="text-xs text-gray-300 line-clamp-2 mb-4 max-w-[80%]">...</p>
                
                <div class="flex gap-3">
                    <button id="hero-play-btn" class="flex-1 bg-white text-black font-bold py-3 rounded-lg flex items-center justify-center gap-2 shadow-lg active:scale-95 transition">
                        <i class="fas fa-play"></i> Play
                    </button>
                    <button class="flex-1 bg-white/20 backdrop-blur text-white font-bold py-3 rounded-lg flex items-center justify-center gap-2 active:scale-95 transition">
                        <i class="fas fa-plus"></i> My List
                    </button>
                </div>
            </div>
        </div>

        <div class="px-4 space-y-6 -mt-4 relative z-10">
            <div class="flex gap-3 overflow-x-auto no-scrollbar pb-2">
                <button onclick="filterMedia('all')" class="px-4 py-1.5 rounded-full border border-white/20 text-xs font-bold hover:bg-white hover:text-black transition">All</button>
                <button onclick="filterMedia('movie')" class="px-4 py-1.5 rounded-full border border-white/20 text-xs font-bold hover:bg-white hover:text-black transition">Movies</button>
                <button onclick="filterMedia('series')" class="px-4 py-1.5 rounded-full border border-white/20 text-xs font-bold hover:bg-white hover:text-black transition">Series</button>
                <button onclick="filterMedia('cartoon')" class="px-4 py-1.5 rounded-full border border-white/20 text-xs font-bold hover:bg-white hover:text-black transition">Kids</button>
            </div>

            <div>
                <h3 class="font-bold text-sm mb-3 text-gray-200">Trending Now</h3>
                <div id="row-trending" class="flex gap-3 overflow-x-auto no-scrollbar pb-4 snap-x">
                    </div>
            </div>

            <div>
                <h3 class="font-bold text-sm mb-3 text-gray-200">New Releases</h3>
                <div id="row-new" class="flex gap-3 overflow-x-auto no-scrollbar pb-4 snap-x">
                    </div>
            </div>
        </div>
    </div>

    <div id="video-player-modal" class="hidden absolute inset-0 z-[100] bg-black flex flex-col justify-center items-center">
        <video id="main-video" class="w-full h-full object-contain" playsinline></video>

        <div id="video-ui" class="absolute inset-0 flex flex-col justify-between p-4 bg-gradient-to-b from-black/60 via-transparent to-black/80 transition-opacity duration-300">
            
            <div class="flex justify-between items-start">
                <button onclick="closePlayer()" class="text-white text-2xl drop-shadow-md"><i class="fas fa-chevron-down"></i></button>
                <div class="flex flex-col items-end">
                    <button onclick="openPartySettings()" class="bg-kivu-teal/80 backdrop-blur px-3 py-1 rounded-full text-[10px] font-bold mb-2 flex items-center gap-1">
                        <i class="fas fa-users"></i> Watch Party
                    </button>
                    <div id="party-status" class="hidden text-[9px] text-green-400 font-bold animate-pulse">‚óè LIVE SYNC</div>
                </div>
            </div>

            <div class="absolute inset-0 flex items-center justify-center pointer-events-none">
                <i id="center-play-icon" class="fas fa-play text-6xl opacity-0 transition-opacity duration-500 drop-shadow-xl"></i>
                <i id="buffering-icon" class="fas fa-circle-notch fa-spin text-4xl opacity-0"></i>
            </div>

            <div class="space-y-2">
                <h2 id="player-title" class="font-bold text-sm drop-shadow-md">Movie Title</h2>
                
                <div class="w-full bg-gray-600/50 h-1 rounded-full overflow-hidden relative group cursor-pointer" onclick="seekVideo(event)">
                    <div id="video-progress" class="bg-red-600 h-full w-0 relative">
                        <div class="absolute right-0 top-1/2 -translate-y-1/2 w-3 h-3 bg-red-600 rounded-full scale-0 group-hover:scale-100 transition-transform"></div>
                    </div>
                </div>
                <div class="flex justify-between text-[9px] font-mono text-gray-300">
                    <span id="time-current">00:00</span>
                    <span id="time-total">00:00</span>
                </div>

                <div class="flex justify-between items-center mt-2">
                    <div class="flex gap-4 items-center">
                        <button onclick="togglePlay()" class="text-xl"><i id="btn-play-pause" class="fas fa-play"></i></button>
                        <button onclick="skipTime(-10)" class="text-lg opacity-80"><i class="fas fa-undo-alt"></i> 10s</button>
                        <button onclick="skipTime(10)" class="text-lg opacity-80"><i class="fas fa-redo-alt"></i> 10s</button>
                    </div>
                    
                    <div class="flex gap-4 items-center">
                        <button onclick="toggleSpeed()" id="btn-speed" class="text-xs font-bold border border-white/30 px-2 py-0.5 rounded">1.0x</button>
                        <button onclick="toggleSettingsMenu()" class="text-lg"><i class="fas fa-cog"></i></button>
                    </div>
                </div>
            </div>
        </div>

        <div id="player-settings-panel" class="hidden absolute bottom-20 right-4 bg-black/90 border border-gray-800 p-4 rounded-xl w-48 slide-up">
            <h4 class="text-xs font-bold text-gray-500 uppercase mb-2">Audio</h4>
            <div class="space-y-1 mb-4">
                <button onclick="setAudio('Original')" class="w-full text-left text-xs font-bold text-red-500">English (Original)</button>
                <button onclick="setAudio('Rus')" class="w-full text-left text-xs text-gray-400">Russian (Dub)</button>
                <button onclick="setAudio('Fra')" class="w-full text-left text-xs text-gray-400">French</button>
            </div>
            <h4 class="text-xs font-bold text-gray-500 uppercase mb-2">Quality</h4>
            <div class="space-y-1">
                <button onclick="setQuality('1080p')" class="w-full text-left text-xs font-bold text-red-500">1080p Full HD</button>
                <button onclick="setQuality('720p')" class="w-full text-left text-xs text-gray-400">720p HD</button>
                <button onclick="setQuality('480p')" class="w-full text-left text-xs text-gray-400">480p Data Saver</button>
            </div>
        </div>

        <div id="party-modal" class="hidden absolute inset-0 bg-black/95 flex items-center justify-center p-6 z-[110]">
            <div class="w-full max-w-sm text-center">
                <i class="fas fa-users text-4xl text-kivu-teal mb-4"></i>
                <h2 class="text-xl font-bold mb-2">Watch Party</h2>
                <p class="text-xs text-gray-400 mb-6">Watch in sync with friends.</p>
                
                <div class="bg-gray-800 p-3 rounded-lg mb-4 flex justify-between items-center">
                    <span id="party-code-display" class="font-mono text-lg font-bold tracking-widest text-white">...</span>
                    <button onclick="copyPartyCode()" class="text-xs bg-gray-700 px-2 py-1 rounded">COPY</button>
                </div>

                <div class="flex gap-2 mb-4">
                    <input type="text" id="join-party-input" placeholder="Enter Code" class="flex-1 bg-gray-800 border-none rounded p-3 text-sm text-white text-center uppercase">
                </div>

                <div class="flex gap-2">
                    <button onclick="createParty()" class="flex-1 bg-kivu-teal py-3 rounded-lg font-bold text-sm">Create New</button>
                    <button onclick="joinParty()" class="flex-1 bg-gray-700 py-3 rounded-lg font-bold text-sm">Join</button>
                </div>
                <button onclick="document.getElementById('party-modal').classList.add('hidden')" class="mt-4 text-xs text-gray-500 underline">Cancel</button>
            </div>
        </div>
    </div>
</div>
<div id="vision-modal" class="hidden absolute inset-0 z-[70] bg-gray-900/95 backdrop-blur-md flex items-end justify-center sm:items-center p-4 fade-in">
    <div class="bg-white w-full max-w-md rounded-2xl overflow-hidden shadow-2xl slide-up max-h-[90vh] overflow-y-auto">
        <div class="bg-gradient-to-r from-indigo-600 to-purple-700 p-6 text-white relative">
            <button onclick="document.getElementById('vision-modal').classList.add('hidden')" class="absolute top-4 right-4 text-white/70 hover:text-white"><i class="fas fa-times text-xl"></i></button>
            <h2 class="text-2xl font-bold mb-1">Our Vision</h2>
            <p class="text-xs opacity-80">Choose your path to receive the presentation.</p>
        </div>

        <div class="p-5 space-y-6">
            <div class="border border-gray-100 rounded-xl p-4 shadow-sm hover:shadow-md transition bg-blue-50/50">
                <div class="flex items-center gap-3 mb-3">
                    <div class="w-10 h-10 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center"><i class="fas fa-landmark"></i></div>
                    <div>
                        <h3 class="font-bold text-sm text-gray-800">Government & Public Sector</h3>
                        <p class="text-[10px] text-gray-500">Digitalization, Tax Integration, Smart Cities.</p>
                    </div>
                </div>
                <div class="flex gap-2">
                    <input type="email" id="email-gov" placeholder="official@gov.rw" class="flex-1 border border-gray-300 rounded-lg px-3 py-2 text-xs outline-none focus:border-blue-500">
                    <button onclick="submitVision('government', 'email-gov')" class="bg-blue-600 text-white px-4 py-2 rounded-lg text-xs font-bold shadow hover:bg-blue-700">Send</button>
                </div>
            </div>

            <div class="border border-gray-100 rounded-xl p-4 shadow-sm hover:shadow-md transition bg-emerald-50/50">
                <div class="flex items-center gap-3 mb-3">
                    <div class="w-10 h-10 rounded-full bg-emerald-100 text-emerald-600 flex items-center justify-center"><i class="fas fa-chart-line"></i></div>
                    <div>
                        <h3 class="font-bold text-sm text-gray-800">Investors & Partners</h3>
                        <p class="text-[10px] text-gray-500">Equity, Growth Metrics, Financial Projections.</p>
                    </div>
                </div>
                <div class="flex gap-2">
                    <input type="email" id="email-inv" placeholder="partner@fund.com" class="flex-1 border border-gray-300 rounded-lg px-3 py-2 text-xs outline-none focus:border-emerald-500">
                    <button onclick="submitVision('investor', 'email-inv')" class="bg-emerald-600 text-white px-4 py-2 rounded-lg text-xs font-bold shadow hover:bg-emerald-700">Send</button>
                </div>
            </div>

            <div class="border border-gray-100 rounded-xl p-4 shadow-sm hover:shadow-md transition bg-orange-50/50">
                <div class="flex items-center gap-3 mb-3">
                    <div class="w-10 h-10 rounded-full bg-orange-100 text-orange-600 flex items-center justify-center"><i class="fas fa-user-friends"></i></div>
                    <div>
                        <h3 class="font-bold text-sm text-gray-800">Clients & Users</h3>
                        <p class="text-[10px] text-gray-500">Product Roadmap, Features, Early Access.</p>
                    </div>
                </div>
                <div class="flex gap-2">
                    <input type="email" id="email-cli" placeholder="you@email.com" class="flex-1 border border-gray-300 rounded-lg px-3 py-2 text-xs outline-none focus:border-orange-500">
                    <button onclick="submitVision('client', 'email-cli')" class="bg-orange-500 text-white px-4 py-2 rounded-lg text-xs font-bold shadow hover:bg-orange-600">Send</button>
                </div>
            </div>
        </div>
        
        <div class="bg-gray-50 p-4 text-center border-t border-gray-100">
            <p class="text-[10px] text-gray-400">By submitting, you agree to receive the selected materials via email automatically.</p>
        </div>
    </div>
    <div id="module-creator" class="hidden h-full flex flex-col bg-black fixed inset-0 z-[60]">
    
    <div class="absolute top-0 left-0 w-full p-4 z-20 flex justify-between items-end bg-gradient-to-b from-black/80 to-transparent pointer-events-none">
        <button onclick="closeSuperModule()" class="text-white drop-shadow-md pointer-events-auto"><i class="fas fa-arrow-left text-xl"></i></button>
        
        <div class="flex gap-4 text-sm font-bold text-white/50 pointer-events-auto">
            <button onclick="switchCreatorTab('live')" id="tab-stars-live" class="hover:text-white transition">LIVE</button>
            <button onclick="switchCreatorTab('foryou')" id="tab-stars-foryou" class="text-white border-b-2 border-white pb-1">For You</button>
            <button onclick="switchCreatorTab('following')" id="tab-stars-following" class="hover:text-white transition">Following</button>
        </div>

        <button onclick="openUploadModal()" class="text-white drop-shadow-md pointer-events-auto"><i class="fas fa-plus-square text-xl"></i></button>
    </div>

    <div id="creator-feed" class="flex-1 overflow-y-scroll snap-y snap-mandatory no-scrollbar h-full bg-black relative z-10">
        </div>

    <div id="creator-live-feed" class="hidden flex-1 overflow-y-auto bg-[#0f1014] pt-20 pb-24 relative z-10">
        
        <div class="px-4 mb-4">
            <div class="flex gap-2 overflow-x-auto no-scrollbar">
                <button onclick="filterLive('all')" class="bg-white/10 text-white px-4 py-1.5 rounded-full text-xs font-bold border border-white/10 hover:bg-white/20">All</button>
                <button onclick="filterLive('Gaming')" class="bg-white/10 text-white px-4 py-1.5 rounded-full text-xs font-bold border border-white/10 hover:bg-white/20">üéÆ Gaming</button>
                <button onclick="filterLive('Music')" class="bg-white/10 text-white px-4 py-1.5 rounded-full text-xs font-bold border border-white/10 hover:bg-white/20">üéµ Music</button>
                <button onclick="filterLive('Just Chatting')" class="bg-white/10 text-white px-4 py-1.5 rounded-full text-xs font-bold border border-white/10 hover:bg-white/20">üí¨ Chat</button>
                <button onclick="filterLive('Education')" class="bg-white/10 text-white px-4 py-1.5 rounded-full text-xs font-bold border border-white/10 hover:bg-white/20">üìö Edu</button>
            </div>
        </div>

        <div class="px-4 mb-4">
            <button onclick="startMyStream()" class="w-full bg-gradient-to-r from-red-500 to-pink-600 text-white font-bold py-3 rounded-xl shadow-lg flex items-center justify-center gap-2 active:scale-95 transition">
                <i class="fas fa-broadcast-tower"></i> GO LIVE NOW
            </button>
        </div>

        <div id="live-grid" class="grid grid-cols-2 gap-2 px-2">
            </div>
    </div>

    <div id="live-room" class="hidden absolute inset-0 z-50 bg-black flex flex-col">
        <div class="absolute inset-0 z-0">
            <img id="live-bg-img" src="" class="w-full h-full object-cover opacity-60">
            <video id="live-user-cam" class="hidden w-full h-full object-cover" autoplay playsinline muted></video>
        </div>

        <div class="absolute inset-0 z-10 flex flex-col justify-between p-4 bg-gradient-to-b from-black/40 via-transparent to-black/60">
            
            <div class="flex justify-between items-start mt-8">
                <div class="flex items-center gap-2 bg-black/30 backdrop-blur rounded-full p-1 pr-4 border border-white/10">
                    <img id="live-avatar" src="" class="w-8 h-8 rounded-full border border-kivu-teal">
                    <div>
                        <h4 id="live-username" class="text-xs font-bold text-white">Streamer</h4>
                        <p class="text-[8px] text-white/80">12.5k followers</p>
                    </div>
                    <button class="bg-kivu-teal text-white text-xs px-2 py-1 rounded-full font-bold ml-1">Follow</button>
                </div>
                
                <div class="flex gap-2">
                    <div class="bg-red-600 text-white text-xs font-bold px-2 py-1 rounded flex items-center gap-1">
                        <i class="fas fa-user"></i> <span id="live-viewers">0</span>
                    </div>
                    <button onclick="closeLiveRoom()" class="w-8 h-8 bg-black/30 rounded-full text-white flex items-center justify-center"><i class="fas fa-times"></i></button>
                </div>
            </div>

            <div>
                <div id="live-chat-box" class="h-48 overflow-y-auto mask-image-b mb-4 flex flex-col gap-1 text-sm text-white text-shadow">
                    </div>

                <div class="flex items-center gap-3">
                    <input type="text" id="live-chat-input" class="flex-1 bg-black/40 border border-white/20 rounded-full px-4 py-2.5 text-white text-xs placeholder-white/70 backdrop-blur-md outline-none focus:border-kivu-teal" placeholder="Say something...">
                    
                    <button class="w-10 h-10 rounded-full bg-gradient-to-tr from-pink-500 to-purple-600 text-white flex items-center justify-center shadow-lg active:scale-90 transition">
                        <i class="fas fa-gift"></i>
                    </button>
                    <button onclick="sendLiveHeart()" class="w-10 h-10 rounded-full bg-black/40 border border-white/20 text-red-500 flex items-center justify-center shadow-lg active:scale-90 transition">
                        <i class="fas fa-heart"></i>
                    </button>
                </div>
            </div>
        </div>
        
        <div id="hearts-container" class="absolute bottom-20 right-4 w-10 h-60 pointer-events-none z-20"></div>
    </div>

    <div id="upload-modal" class="hidden absolute inset-0 z-50 bg-white flex flex-col slide-up">
        <div class="bg-black text-white p-4 flex justify-between items-center">
            <h2 class="font-bold">Upload Content</h2>
            <button onclick="document.getElementById('upload-modal').classList.add('hidden')"><i class="fas fa-times"></i></button>
        </div>
        <div class="p-5">
            <div class="border-2 border-dashed border-gray-300 rounded-xl h-40 flex flex-col items-center justify-center mb-4 bg-gray-50">
                <i class="fas fa-cloud-upload-alt text-3xl text-gray-400 mb-2"></i>
                <span class="text-xs text-gray-500">Select Video or Photo</span>
            </div>
            <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Caption</label>
            <input type="text" id="upload-caption" class="w-full border p-3 rounded-lg mb-4 text-sm" placeholder="#Kigali #Life">
            <button onclick="uploadContent()" class="w-full bg-kivu-teal text-white font-bold py-3 rounded-xl">Post Now</button>
        </div>
    </div>
</div>
</div>
<div id="module-tools" class="hidden h-full flex flex-col bg-gray-50 fixed inset-0 z-[60]">
    <div class="bg-gray-900 text-white p-4 flex items-center gap-3 shadow-md shrink-0">
        <button onclick="closeSuperModule()" class="w-8 h-8 rounded-full bg-white/20 flex items-center justify-center hover:bg-white/30"><i class="fas fa-arrow-left"></i></button>
        <div>
            <h2 class="font-bold text-lg">Workspace</h2>
            <p class="text-[10px] text-gray-400">AI, Office & PDF Tools</p>
        </div>
    </div>

    <div class="flex-1 overflow-y-auto p-4 pb-24">
        
        <div onclick="openAIChat()" class="bg-gradient-to-r from-indigo-600 to-purple-600 rounded-xl p-4 text-white shadow-lg mb-6 flex items-center gap-4 cursor-pointer active:scale-95 transition relative overflow-hidden">
            <div class="absolute -right-4 -top-4 w-24 h-24 bg-white/20 rounded-full blur-xl"></div>
            <div class="w-12 h-12 bg-white/20 rounded-full flex items-center justify-center text-2xl backdrop-blur-md">
                <i class="fas fa-robot"></i>
            </div>
            <div>
                <h3 class="font-bold text-lg">Kivu AI Assistant</h3>
                <p class="text-xs opacity-90">Ask anything, generate text & ideas.</p>
            </div>
        </div>

        <h3 class="font-bold text-gray-700 text-sm mb-3 uppercase">Office Cloud</h3>
        <div class="grid grid-cols-3 gap-3 mb-6">
            <div onclick="openToolFrame('Word', 'https://word.new')" class="bg-white p-3 rounded-xl shadow-sm border border-blue-100 flex flex-col items-center gap-2 cursor-pointer hover:bg-blue-50">
                <img src="https://upload.wikimedia.org/wikipedia/commons/f/fd/Microsoft_Office_Word_%282019%E2%80%93present%29.svg" class="w-8 h-8">
                <span class="text-xs font-bold text-blue-900">Word</span>
            </div>
            <div onclick="openToolFrame('Excel', 'https://excel.new')" class="bg-white p-3 rounded-xl shadow-sm border border-green-100 flex flex-col items-center gap-2 cursor-pointer hover:bg-green-50">
                <img src="https://upload.wikimedia.org/wikipedia/commons/3/34/Microsoft_Office_Excel_%282019%E2%80%93present%29.svg" class="w-8 h-8">
                <span class="text-xs font-bold text-green-900">Excel</span>
            </div>
            <div onclick="openToolFrame('PowerPoint', 'https://powerpoint.new')" class="bg-white p-3 rounded-xl shadow-sm border border-orange-100 flex flex-col items-center gap-2 cursor-pointer hover:bg-orange-50">
                <img src="https://upload.wikimedia.org/wikipedia/commons/0/0d/Microsoft_Office_PowerPoint_%282019%E2%80%93present%29.svg" class="w-8 h-8">
                <span class="text-xs font-bold text-orange-900">PowerPoint</span>
            </div>
        </div>

        <h3 class="font-bold text-gray-700 text-sm mb-3 uppercase">PDF Tools</h3>
        <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
            <div class="grid grid-cols-4 divide-x divide-y divide-gray-100">
                <div onclick="openToolFrame('Merge PDF', 'https://www.ilovepdf.com/merge_pdf')" class="p-3 flex flex-col items-center gap-1 hover:bg-gray-50 cursor-pointer">
                    <i class="fas fa-object-group text-red-500 text-lg"></i>
                    <span class="text-[9px] font-bold text-center">Merge</span>
                </div>
                <div onclick="openToolFrame('Split PDF', 'https://www.ilovepdf.com/split_pdf')" class="p-3 flex flex-col items-center gap-1 hover:bg-gray-50 cursor-pointer">
                    <i class="fas fa-cut text-red-500 text-lg"></i>
                    <span class="text-[9px] font-bold text-center">Split</span>
                </div>
                <div onclick="openToolFrame('Compress', 'https://www.ilovepdf.com/compress_pdf')" class="p-3 flex flex-col items-center gap-1 hover:bg-gray-50 cursor-pointer">
                    <i class="fas fa-compress-arrows-alt text-green-500 text-lg"></i>
                    <span class="text-[9px] font-bold text-center">Compress</span>
                </div>
                <div onclick="openToolFrame('PDF to Word', 'https://www.ilovepdf.com/pdf_to_word')" class="p-3 flex flex-col items-center gap-1 hover:bg-gray-50 cursor-pointer">
                    <i class="fas fa-file-word text-blue-500 text-lg"></i>
                    <span class="text-[9px] font-bold text-center">To Word</span>
                </div>
                
                <div onclick="openToolFrame('Word to PDF', 'https://www.ilovepdf.com/word_to_pdf')" class="p-3 flex flex-col items-center gap-1 hover:bg-gray-50 cursor-pointer">
                    <i class="fas fa-file-pdf text-red-500 text-lg"></i>
                    <span class="text-[9px] font-bold text-center">To PDF</span>
                </div>
                <div onclick="openToolFrame('Edit PDF', 'https://www.ilovepdf.com/edit_pdf')" class="p-3 flex flex-col items-center gap-1 hover:bg-gray-50 cursor-pointer">
                    <i class="fas fa-pen text-indigo-500 text-lg"></i>
                    <span class="text-[9px] font-bold text-center">Edit</span>
                </div>
                <div onclick="openToolFrame('Sign PDF', 'https://www.ilovepdf.com/sign_pdf')" class="p-3 flex flex-col items-center gap-1 hover:bg-gray-50 cursor-pointer">
                    <i class="fas fa-signature text-gray-600 text-lg"></i>
                    <span class="text-[9px] font-bold text-center">Sign</span>
                </div>
                <div onclick="openToolFrame('Unlock', 'https://www.ilovepdf.com/unlock_pdf')" class="p-3 flex flex-col items-center gap-1 hover:bg-gray-50 cursor-pointer">
                    <i class="fas fa-lock-open text-orange-500 text-lg"></i>
                    <span class="text-[9px] font-bold text-center">Unlock</span>
                </div>
            </div>
        </div>
    </div>

    <div id="tool-browser-modal" class="hidden absolute inset-0 z-[70] bg-white flex flex-col slide-up">
        <div class="bg-gray-800 text-white p-2 flex justify-between items-center shadow-md shrink-0">
            <span id="tool-browser-title" class="font-bold text-sm ml-2">Tool</span>
            <div class="flex gap-2">
                <a id="tool-browser-external" href="#" target="_blank" class="bg-white/20 px-3 py-1 rounded text-xs font-bold hover:bg-white/30"><i class="fas fa-external-link-alt"></i> Open Browser</a>
                <button onclick="closeBrowserModal()" class="bg-red-500 px-3 py-1 rounded text-xs font-bold hover:bg-red-600">Close X</button>
            </div>
        </div>
        <div class="flex-1 bg-gray-100 relative">
            <iframe id="browser-iframe" src="" class="w-full h-full border-none" allow="camera; microphone; clipboard-write; clipboard-read;"></iframe>
            <div id="tool-loading" class="absolute inset-0 flex items-center justify-center bg-white z-0">
                <i class="fas fa-spinner fa-spin text-4xl text-gray-300"></i>
            </div>
        </div>
    </div>

    <div id="ai-chat-modal" class="hidden absolute inset-0 z-[70] bg-white flex flex-col slide-up">
        <div class="bg-gradient-to-r from-indigo-600 to-purple-600 text-white p-4 flex justify-between items-center shadow-md shrink-0">
            <div class="flex items-center gap-2">
                <div class="w-8 h-8 bg-white/20 rounded-full flex items-center justify-center"><i class="fas fa-robot"></i></div>
                <h2 class="font-bold">Kivu AI</h2>
            </div>
            <button onclick="closeAIChat()" class="bg-white/20 w-8 h-8 rounded-full">
    <i class="fas fa-times"></i>
</button>
        </div>
        
        <div id="ai-chat-history" class="flex-1 overflow-y-auto p-4 bg-gray-50 flex flex-col gap-3">
            <div class="self-start bg-white border border-gray-200 text-gray-800 text-sm py-2 px-3 rounded-r-xl rounded-tl-xl max-w-[80%] shadow-sm">
                üëã Hello! I am your AI Assistant. I can help you write emails, translate text, or summarize documents.
            </div>
        </div>

        <div class="p-3 bg-white border-t border-gray-200 shrink-0">
            <div class="flex gap-2">
                <input type="text" id="ai-input" class="flex-1 border border-gray-300 rounded-full px-4 py-2 text-sm focus:border-indigo-500 outline-none" placeholder="Ask something...">
                <button onclick="sendAIMessage()" class="bg-indigo-600 text-white w-10 h-10 rounded-full flex items-center justify-center hover:bg-indigo-700 shadow">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </div>
</div>
<div id="module-arcade" class="hidden h-full flex flex-col bg-[#1a1a2e] fixed inset-0 z-[60]">
    <div class="bg-purple-900 text-white p-4 shadow-md shrink-0 flex justify-between items-center relative overflow-hidden">
        <div class="absolute top-0 right-0 w-32 h-32 bg-pink-500/20 rounded-full blur-3xl"></div>
        
        <div class="flex items-center gap-3 relative z-10">
            <button onclick="closeSuperModule()" class="w-8 h-8 rounded-full bg-white/10 flex items-center justify-center hover:bg-white/20"><i class="fas fa-arrow-left"></i></button>
            <div>
                <h2 class="font-bold text-lg italic tracking-wider text-pink-400">KIVU <span class="text-white">ARCADE</span></h2>
                <p class="text-[10px] opacity-70">Play Free. No Install.</p>
            </div>
        </div>
        <div class="relative z-10 bg-black/30 px-3 py-1 rounded-full text-xs font-mono text-yellow-400 border border-yellow-400/30">
            <i class="fas fa-coins"></i> <span id="arcade-coins">0</span>
        </div>
    </div>

    <div class="bg-[#16213e] p-3 flex gap-3 overflow-x-auto no-scrollbar border-b border-white/5">
        <button onclick="filterGames('all')" class="bg-purple-600 text-white px-4 py-1.5 rounded-full text-xs font-bold border border-white/10 whitespace-nowrap shadow-lg shadow-purple-500/20">All Games</button>
        <button onclick="filterGames('Action')" class="bg-white/5 text-gray-300 px-4 py-1.5 rounded-full text-xs font-bold border border-white/10 whitespace-nowrap hover:bg-white/10">üî• Action</button>
        <button onclick="filterGames('Puzzle')" class="bg-white/5 text-gray-300 px-4 py-1.5 rounded-full text-xs font-bold border border-white/10 whitespace-nowrap hover:bg-white/10">üß© Puzzle</button>
        <button onclick="filterGames('Racing')" class="bg-white/5 text-gray-300 px-4 py-1.5 rounded-full text-xs font-bold border border-white/10 whitespace-nowrap hover:bg-white/10">üèé Racing</button>
    </div>

    <div id="arcade-list" class="flex-1 overflow-y-auto p-4 pb-24 grid grid-cols-2 gap-4 content-start">
        </div>

    <div id="game-player-modal" class="hidden absolute inset-0 z-[70] bg-black flex flex-col">
        <div class="bg-gray-900 text-white p-2 flex justify-between items-center shrink-0 border-b border-gray-800">
            <button onclick="closeArcadeGame()" class="bg-red-600 px-3 py-1 rounded text-xs font-bold flex items-center gap-1">
                <i class="fas fa-sign-out-alt"></i> EXIT
            </button>
            <span id="game-player-title" class="font-bold text-sm text-gray-300">Game Name</span>
            <button onclick="toggleFullscreen()" class="bg-gray-700 w-8 h-8 rounded flex items-center justify-center text-xs">
                <i class="fas fa-expand"></i>
            </button>
        </div>
        
        <div class="flex-1 relative bg-black flex items-center justify-center overflow-hidden">
            <iframe id="game-frame" class="w-full h-full border-0" allow="autoplay; fullscreen; vibration; gyroscope; accelerometer" src=""></iframe>
            
            <div id="game-loader" class="absolute inset-0 bg-gray-900 flex flex-col items-center justify-center z-10">
                <i class="fas fa-gamepad text-6xl text-purple-500 animate-bounce mb-4"></i>
                <p class="text-white font-bold animate-pulse">Loading Game...</p>
            </div>
        </div>
    </div>
</div>
<div id="module-lingo" class="hidden h-full flex flex-col bg-gray-50 fixed inset-0 z-[60]">
    <div class="bg-teal-700 text-white p-4 shadow-md shrink-0 flex justify-between items-center">
        <div class="flex items-center gap-3">
            <button onclick="closeSuperModule()" class="w-8 h-8 rounded-full bg-white/20 flex items-center justify-center hover:bg-white/30"><i class="fas fa-arrow-left"></i></button>
            <div>
                <h2 class="font-bold text-lg"><i class="fas fa-book-reader mr-2"></i>Kivu Lingo</h2>
                <p class="text-[10px] opacity-80">Learn Languages Free</p>
            </div>
        </div>
        <button onclick="openLingoSettings()" class="bg-white/20 px-3 py-1 rounded-full text-xs font-bold border border-white/10">
            <i class="fas fa-cog"></i> Settings
        </button>
    </div>

    <div class="bg-teal-800 p-3 shadow-inner shrink-0">
        <select id="lingo-mode" onchange="setLingoMode(this.value)" class="w-full bg-black/20 text-white border border-white/20 rounded-lg p-2 text-sm font-bold outline-none">
            <option value="en">RW üá∑üáº ‚û° English üá∫üá∏</option>
            <option value="sw">RW üá∑üáº ‚û° Swahili üáπüáø</option>
            <option value="cn">RW üá∑üáº ‚û° Chinese üá®üá≥</option>
            <option value="fr">RW üá∑üáº ‚û° French üá´üá∑</option>
        </select>
    </div>

    <div class="flex bg-white shadow-sm border-b border-gray-200">
        <button onclick="switchLingoTab('learn')" id="tab-lingo-learn" class="flex-1 py-3 text-xs font-bold text-teal-700 border-b-2 border-teal-700 bg-teal-50">üéì Practice</button>
        <button onclick="switchLingoTab('books')" id="tab-lingo-books" class="flex-1 py-3 text-xs font-bold text-gray-500 hover:bg-gray-50">üìö Books</button>
        <button onclick="switchLingoTab('tutors')" id="tab-lingo-tutors" class="flex-1 py-3 text-xs font-bold text-gray-500 hover:bg-gray-50">üë®‚Äçüè´ Tutors</button>
    </div>

    <div class="flex-1 overflow-y-auto p-4 pb-24 bg-gray-100">
        
        <div id="lingo-view-learn" class="flex flex-col items-center h-full justify-center min-h-[400px]">
            
            <div class="w-full max-w-sm mb-6 relative perspective-1000 group cursor-pointer" onclick="flipCard()">
                <div id="flashcard-inner" class="relative w-full h-64 transition-transform duration-500 transform-style-3d shadow-xl rounded-2xl">
                    
                    <div class="absolute inset-0 bg-white rounded-2xl flex flex-col items-center justify-center p-6 backface-hidden border-b-4 border-gray-200">
                        <div class="text-xs text-gray-400 font-bold uppercase tracking-widest mb-2">Kinyarwanda</div>
                        <h2 id="card-front" class="text-3xl font-bold text-gray-800 text-center">Mwaramutse</h2>
                        <div class="mt-4 text-teal-600 text-sm font-bold animate-pulse">Tap to Flip ‚Üª</div>
                    </div>

                    <div class="absolute inset-0 bg-teal-600 text-white rounded-2xl flex flex-col items-center justify-center p-6 backface-hidden rotate-y-180">
                        <div class="text-xs text-teal-200 font-bold uppercase tracking-widest mb-2" id="card-lang-label">English</div>
                        <h2 id="card-back" class="text-3xl font-bold text-center">Good Morning</h2>
                        <div class="mt-2 text-teal-200 text-sm italic" id="card-pronounce">/…° äd Ààm…îÀêrn…™≈ã/</div>
                    </div>
                </div>
            </div>

            <div class="flex gap-4 w-full max-w-sm">
                <button onclick="nextCard()" class="flex-1 bg-white border border-gray-200 text-gray-700 py-3 rounded-xl font-bold shadow-sm hover:bg-gray-50">Skip</button>
                <button onclick="nextCard(true)" class="flex-1 bg-teal-600 text-white py-3 rounded-xl font-bold shadow-lg hover:bg-teal-700">I Knew It! üéâ</button>
            </div>
            
            <div class="mt-6 text-center">
                <p class="text-xs text-gray-400">Daily Goal: <span id="lingo-progress">0</span>/10 words</p>
                <div class="w-48 h-1.5 bg-gray-200 rounded-full mt-1 mx-auto overflow-hidden">
                    <div id="lingo-bar" class="h-full bg-teal-500 w-0 transition-all duration-500"></div>
                </div>
            </div>
        </div>

        <div id="lingo-view-books" class="hidden space-y-3">
            <div class="bg-blue-50 p-4 rounded-xl border border-blue-100 mb-4">
                <h3 class="font-bold text-blue-900 text-sm mb-1">Free Library</h3>
                <p class="text-xs text-blue-700">Download PDFs or read online to improve fast.</p>
            </div>

            <div onclick="openToolFrame('English Basics PDF', 'https://www.pdfdrive.com/search?q=english+grammar')" class="bg-white p-3 rounded-xl shadow-sm flex items-center gap-3 cursor-pointer hover:bg-gray-50">
                <div class="w-12 h-16 bg-red-100 flex items-center justify-center rounded text-red-500 text-2xl"><i class="fas fa-file-pdf"></i></div>
                <div>
                    <h4 class="font-bold text-sm text-gray-800">English Grammar 101</h4>
                    <p class="text-[10px] text-gray-500">Basic rules for beginners</p>
                </div>
            </div>

            <div onclick="openToolFrame('Swahili Conversational', 'https://www.pdfdrive.com/search?q=learn+swahili')" class="bg-white p-3 rounded-xl shadow-sm flex items-center gap-3 cursor-pointer hover:bg-gray-50">
                <div class="w-12 h-16 bg-green-100 flex items-center justify-center rounded text-green-600 text-2xl"><i class="fas fa-book"></i></div>
                <div>
                    <h4 class="font-bold text-sm text-gray-800">Swahili Daily Talk</h4>
                    <p class="text-[10px] text-gray-500">Useful phrases for East Africa</p>
                </div>
            </div>

            <div onclick="openToolFrame('Chinese HSK 1', 'https://www.pdfdrive.com/search?q=hsk+1+standard+course')" class="bg-white p-3 rounded-xl shadow-sm flex items-center gap-3 cursor-pointer hover:bg-gray-50">
                <div class="w-12 h-16 bg-orange-100 flex items-center justify-center rounded text-orange-600 text-2xl"><i class="fas fa-scroll"></i></div>
                <div>
                    <h4 class="font-bold text-sm text-gray-800">Chinese HSK 1</h4>
                    <p class="text-[10px] text-gray-500">Mandarin for beginners</p>
                </div>
            </div>
        </div>

        <div id="lingo-view-tutors" class="hidden space-y-3">
            <div class="bg-yellow-50 p-4 rounded-xl border border-yellow-100 mb-4 flex gap-3">
                <i class="fas fa-chalkboard-teacher text-yellow-600 text-2xl"></i>
                <div>
                    <h3 class="font-bold text-yellow-900 text-sm">Become a Tutor?</h3>
                    <p class="text-xs text-yellow-700">Earn money teaching your language.</p>
                    <button class="mt-2 bg-yellow-600 text-white text-[10px] px-3 py-1 rounded font-bold">Apply Now</button>
                </div>
            </div>

            <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-100 flex gap-4">
                <img src="https://randomuser.me/api/portraits/women/65.jpg" class="w-16 h-16 rounded-full object-cover">
                <div class="flex-1">
                    <div class="flex justify-between">
                        <h4 class="font-bold text-sm">Grace M.</h4>
                        <span class="text-xs font-bold text-teal-600">5000 RWF/hr</span>
                    </div>
                    <p class="text-[10px] text-gray-500 mb-2">Teaches: English, French</p>
                    <div class="flex items-center gap-1 text-[10px] text-yellow-500 mb-2">
                        <i class="fas fa-star"></i> 4.9 (20 students)
                    </div>
                    <button onclick="window.open('https://wa.me/250788000000?text=Hello%20Grace,%20I%20want%20to%20learn%20English', '_blank')" class="w-full bg-green-500 text-white py-2 rounded-lg text-xs font-bold flex items-center justify-center gap-2">
                        <i class="fab fa-whatsapp"></i> Chat on WhatsApp
                    </button>
                </div>
            </div>
        </div>

    </div>
</div>

<style>
.perspective-1000 { perspective: 1000px; }
.transform-style-3d { transform-style: preserve-3d; }
.backface-hidden { backface-visibility: hidden; }
.rotate-y-180 { transform: rotateY(180deg); }
.flipped { transform: rotateY(180deg); }
</style>
<div id="module-kitchen" class="hidden h-full flex flex-col bg-orange-50 fixed inset-0 z-[60]">
    <div class="bg-orange-600 text-white p-4 shadow-md shrink-0 flex justify-between items-center relative overflow-hidden">
        <div class="absolute -top-6 -right-6 w-32 h-32 bg-yellow-400/20 rounded-full blur-2xl"></div>
        
        <div class="flex items-center gap-3 relative z-10">
            <button onclick="closeSuperModule()" class="w-8 h-8 rounded-full bg-white/20 flex items-center justify-center hover:bg-white/30 transition"><i class="fas fa-arrow-left"></i></button>
            <div>
                <h2 class="font-bold text-lg"><i class="fas fa-hat-chef mr-2"></i>Kivu Kitchen</h2>
                <p class="text-[10px] opacity-80">Cook like a Pro</p>
            </div>
        </div>
        <button class="relative z-10 bg-white/20 px-3 py-1 rounded-full text-xs font-bold border border-white/10 hover:bg-white/30">
            <i class="fas fa-bookmark"></i> Saved
        </button>
    </div>

    <div class="bg-white p-3 shadow-sm flex gap-3 overflow-x-auto no-scrollbar shrink-0">
        <button onclick="filterKitchen('all')" class="flex items-center gap-2 bg-orange-100 text-orange-800 px-4 py-2 rounded-full text-xs font-bold border border-orange-200 whitespace-nowrap shadow-sm">
            <i class="fas fa-th"></i> All
        </button>
        <button onclick="filterKitchen('Dessert')" class="flex items-center gap-2 bg-white text-gray-600 px-4 py-2 rounded-full text-xs font-bold border border-gray-200 whitespace-nowrap hover:bg-gray-50">
            <i class="fas fa-cookie"></i> Desserts
        </button>
        <button onclick="filterKitchen('Breakfast')" class="flex items-center gap-2 bg-white text-gray-600 px-4 py-2 rounded-full text-xs font-bold border border-gray-200 whitespace-nowrap hover:bg-gray-50">
            <i class="fas fa-coffee"></i> Breakfast
        </button>
        <button onclick="filterKitchen('Healthy')" class="flex items-center gap-2 bg-white text-gray-600 px-4 py-2 rounded-full text-xs font-bold border border-gray-200 whitespace-nowrap hover:bg-gray-50">
            <i class="fas fa-leaf"></i> Healthy
        </button>
    </div>

    <div id="kitchen-feed" class="flex-1 overflow-y-auto p-4 pb-24 grid grid-cols-1 gap-4">
        </div>

    <div id="recipe-modal" class="hidden absolute inset-0 z-[70] bg-white flex flex-col slide-up overflow-y-auto">
        </div>
</div><div id="module-travel" class="hidden h-full flex flex-col bg-gray-50 fixed inset-0 z-[60]">
    
    <div class="bg-cyan-800 text-white p-4 shadow-md shrink-0 relative overflow-hidden">
        <div class="absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full blur-2xl -mr-10 -mt-10"></div>
        <div class="flex justify-between items-center relative z-10">
            <div class="flex items-center gap-3">
                <button onclick="closeSuperModule()" class="w-8 h-8 rounded-full bg-white/20 flex items-center justify-center hover:bg-white/30 transition"><i class="fas fa-arrow-left"></i></button>
                <div>
                    <h2 class="font-bold text-lg"><i class="fas fa-bus mr-2"></i>Kivu Travel</h2>
                    <p class="text-[10px] opacity-80 text-cyan-200">East Africa Connected</p>
                </div>
            </div>
            <div class="text-right">
                <button onclick="openMyTickets()" class="bg-white/20 border border-white/30 text-white text-xs font-bold px-3 py-1.5 rounded-full hover:bg-white/30 transition">
                    <i class="fas fa-ticket-alt mr-1"></i> My Tickets
                </button>
            </div>
        </div>
    </div>

    <div class="bg-cyan-900 p-3 shrink-0 shadow-inner">
        <div class="flex justify-between items-center mb-2">
            <h3 class="text-xs font-bold text-white flex items-center gap-2">
                <span class="w-2 h-2 bg-red-500 rounded-full animate-pulse"></span> Urgent Departures
            </h3>
            <span class="text-[9px] text-cyan-300">Last seats!</span>
        </div>
        <div id="travel-live-board" class="flex gap-3 overflow-x-auto no-scrollbar pb-1">
            <div class="text-white text-xs opacity-50">Loading live schedule...</div>
        </div>
    </div>

    <div class="bg-white p-4 rounded-b-3xl shadow-sm z-10 shrink-0">
        <div class="mb-4 text-center">
            <h3 class="font-bold text-cyan-700 text-sm uppercase tracking-wider">Search Bus Routes</h3>
        </div>

        <div class="flex gap-2 mb-3">
            <div class="flex-1">
                <label class="text-[9px] font-bold text-gray-400 uppercase ml-1">From</label>
                <input type="text" id="travel-from" oninput="searchTickets()" value="KIGALI" class="w-full border border-gray-200 bg-gray-50 rounded-lg p-3 text-sm font-bold uppercase text-gray-800 focus:border-cyan-500 outline-none">
            </div>
            <div class="flex items-end pb-3 text-gray-300"><i class="fas fa-exchange-alt"></i></div>
            <div class="flex-1">
                <label class="text-[9px] font-bold text-gray-400 uppercase ml-1">To</label>
                <input type="text" id="travel-to" oninput="searchTickets()" value="KAMPALA" class="w-full border border-gray-200 bg-gray-50 rounded-lg p-3 text-sm font-bold uppercase text-gray-800 focus:border-cyan-500 outline-none">
            </div>
        </div>
        
        <div class="mb-4 mt-3">
            <label class="text-[9px] font-bold text-gray-400 uppercase ml-1">Travel Date</label>
            <input type="date" id="travel-date" onchange="searchTickets()" class="w-full border border-gray-200 bg-gray-50 rounded-lg pl-10 p-3 text-sm font-bold uppercase text-gray-800 focus:border-cyan-500 outline-none">
        </div>
        
        <button id="btn-search-tickets" class="w-full bg-cyan-700 text-white font-bold py-3.5 rounded-xl shadow-lg active:scale-95 transition flex justify-center items-center gap-2">
            <i class="fas fa-search"></i> Search Routes
        </button>
    </div>

    <div class="flex-1 overflow-y-auto bg-gray-50 relative z-0 pb-32">
        <div id="travel-feed" class="p-4 space-y-3 min-h-[100px]"></div>

        <div class="p-4 pb-8"> 
            <button id="btn-become-partner" onclick="openBusPartnerModal()" class="w-full border-2 border-dashed border-gray-300 text-gray-500 font-bold py-4 rounded-xl text-xs hover:border-kivu-teal hover:text-kivu-teal transition flex flex-col items-center gap-1 group">
                <i class="fas fa-bus text-xl group-hover:scale-110 transition"></i>
                <span>Bus Operator? Add Your Fleet</span>
            </button>
            
            <button id="btn-company-dash" onclick="openCompanyDashboard()" class="hidden w-full bg-indigo-900 text-white font-bold py-4 rounded-xl text-sm shadow-lg flex items-center justify-center gap-2 mb-3">
                <i class="fas fa-chart-pie text-kivu-orange"></i> Company Dashboard
            </button>
            
            <button id="btn-bus-admin" onclick="openBusAdminPanel()" class="hidden w-full mt-3 bg-gray-900 text-white font-bold py-3 rounded-xl text-xs shadow-lg flex items-center justify-center gap-2">
                <i class="fas fa-user-shield text-kivu-gold"></i> Admin Dashboard 
                <span id="admin-pending-badge" class="bg-red-600 text-white px-1.5 rounded-full text-[9px] hidden">0</span>
            </button>
        </div>
    </div>

    <div id="booking-modal" class="hidden absolute inset-0 z-[70] bg-black/80 backdrop-blur-sm flex items-end justify-center">
        <div class="bg-white w-full rounded-t-3xl p-6 slide-up max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-4">
                <h3 class="font-bold text-xl text-gray-900">Checkout</h3>
                <button onclick="closeBookingModal()" class="w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center"><i class="fas fa-times"></i></button>
            </div>
            <div id="book-ticket-preview" class="bg-gray-50 p-4 rounded-xl border border-gray-200 mb-4 border-l-4 border-cyan-600"></div>
            <div id="bus-seat-map" class="mb-6 bg-white border border-gray-200 p-4 rounded-xl"></div>
            <button onclick="processBooking()" class="w-full bg-cyan-700 text-white font-bold py-4 rounded-xl shadow-lg flex justify-between px-6 items-center active:scale-95 transition">
                <span>Confirm & Pay</span>
                <i class="fas fa-check-circle"></i>
            </button>
        </div>
    </div>

    <div id="bus-partner-modal" class="hidden absolute inset-0 z-[70] bg-white flex flex-col slide-up">
        <div class="bg-kivu-teal text-white p-4 flex justify-between items-center shadow-md shrink-0">
            <h2 class="font-bold text-lg">Add New Route</h2>
            <button onclick="document.getElementById('bus-partner-modal').classList.add('hidden')" class="w-8 h-8 bg-white/20 rounded-full flex items-center justify-center"><i class="fas fa-times"></i></button>
        </div>
        <div class="p-5 flex-1 overflow-y-auto">
            <div class="bg-blue-50 border border-blue-100 p-3 rounded-lg mb-4 text-xs text-blue-800">
                <i class="fas fa-info-circle mr-1"></i> Your route will be reviewed by Kivu Admin.
            </div>
            <div class="bg-yellow-50 border border-yellow-200 p-3 rounded-lg mb-4">
                <h3 class="font-bold text-xs text-yellow-800 uppercase mb-2"><i class="fas fa-coins"></i> Direct Payment Setup</h3>
                <p class="text-[10px] text-gray-600 mb-2">Money goes directly to your MoMo. We take 0%.</p>
                <label class="block text-xs font-bold text-gray-500 uppercase mb-1">MoMo Merchant Code</label>
                <input type="text" id="bus-add-momo" class="w-full border rounded p-2 text-sm font-mono font-bold" placeholder="e.g. 123456">
            </div>
            <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Company Name</label>
            <input type="text" id="bus-add-company" class="w-full border rounded p-3 mb-4 text-sm" placeholder="e.g. Trinity Express">
            <div class="flex gap-2 mb-4">
                <div class="flex-1">
                    <label class="block text-xs font-bold text-gray-500 uppercase mb-2">From</label>
                    <select id="bus-add-from" class="w-full border rounded p-3 text-sm bg-white font-bold">
                        <option>Kigali</option><option>Kampala</option><option>Nairobi</option><option>Mombasa</option><option>Juba</option><option>Bujumbura</option>
                    </select>
                </div>
                <div class="flex-1">
                    <label class="block text-xs font-bold text-gray-500 uppercase mb-2">To</label>
                    <select id="bus-add-to" class="w-full border rounded p-3 text-sm bg-white font-bold">
                        <option>Kampala</option><option>Kigali</option><option>Nairobi</option><option>Mombasa</option><option>Juba</option><option>Bujumbura</option>
                    </select>
                </div>
            </div>
            <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Departure Date</label>
            <input type="date" id="bus-add-date" class="w-full border rounded p-3 mb-4 text-sm font-bold bg-gray-50">
            <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Departure Time</label>
            <input type="time" id="bus-add-time" class="w-full border rounded p-3 mb-4 text-sm font-bold bg-gray-50">
            <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Arrival Time</label>
            <input type="time" id="bus-add-arr-time" class="w-full border rounded p-3 mb-4 text-sm font-bold bg-gray-50">
            <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Contact Phone</label>
            <input type="tel" id="bus-add-phone" class="w-full border rounded p-3 text-sm mb-4" placeholder="+250...">
            <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Bus Type</label>
            <select id="bus-add-capacity" class="w-full border rounded p-3 mb-4 text-sm bg-white font-bold text-indigo-900">
                <option value="40">Standard Coach (40 seats)</option>
                <option value="29">Coaster (29 seats)</option>
                <option value="60">Large Bus (60 seats)</option>
                <option value="14">Mini-Van / Taxi (14 seats)</option>
            </select>
            <div class="bg-gray-100 p-3 rounded-lg border border-gray-200 mb-4">
                <div class="flex justify-between items-center mb-2">
                    <label class="text-xs font-bold text-gray-500 uppercase">Seat Configurator</label>
                    <span class="text-[9px] text-gray-400">Click to block/unblock seats</span>
                </div>
                <div id="seat-configurator-grid" class="grid grid-cols-4 gap-2 max-h-40 overflow-y-auto p-1"></div>
                <div class="flex gap-3 mt-2 text-[9px] font-bold text-gray-500 justify-center">
                    <span class="flex items-center gap-1"><div class="w-3 h-3 border border-gray-400 bg-white rounded"></div> Sellable</span>
                    <span class="flex items-center gap-1"><div class="w-3 h-3 bg-black rounded"></div> Blocked</span>
                </div>
            </div>
            <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Bus Amenities</label>
            <div class="grid grid-cols-2 gap-2 mb-4">
                <label class="flex items-center gap-2 p-2 border rounded bg-gray-50"><input type="checkbox" class="bus-amenity-check" value="wifi"> <span class="text-xs"><i class="fas fa-wifi text-blue-500"></i> Wi-Fi</span></label>
                <label class="flex items-center gap-2 p-2 border rounded bg-gray-50"><input type="checkbox" class="bus-amenity-check" value="ac"> <span class="text-xs"><i class="fas fa-snowflake text-cyan-500"></i> A/C</span></label>
                <label class="flex items-center gap-2 p-2 border rounded bg-gray-50"><input type="checkbox" class="bus-amenity-check" value="power"> <span class="text-xs"><i class="fas fa-plug text-yellow-500"></i> Power</span></label>
                <label class="flex items-center gap-2 p-2 border rounded bg-gray-50"><input type="checkbox" class="bus-amenity-check" value="vip"> <span class="text-xs"><i class="fas fa-crown text-kivu-gold"></i> VIP Seat</span></label>
            </div>
            <div class="flex gap-2 mb-6">
                <div class="flex-1">
                    <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Price</label>
                    <input type="number" id="bus-add-price" class="w-full border rounded p-3 text-sm font-bold text-kivu-teal" placeholder="e.g. 30000">
                </div>
                <div class="w-1/3">
                    <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Currency</label>
                    <select id="bus-add-curr" class="w-full border rounded p-3 text-sm bg-white font-bold">
                        <option>RWF</option><option>UGX</option><option>KES</option><option>SSP</option>
                    </select>
                </div>
            </div>
            <button onclick="submitBusRoute()" class="w-full bg-kivu-teal text-white font-bold py-4 rounded-xl shadow-lg active:scale-95 transition">Submit Route</button>
        </div>
    </div>

    <div id="bus-admin-modal" class="hidden absolute inset-0 z-[70] bg-gray-100 flex flex-col slide-up">
        <div class="bg-gray-900 text-white p-4 flex justify-between items-center shadow-md">
            <h2 class="font-bold text-lg text-kivu-gold"><i class="fas fa-crown mr-2"></i>Route Admin</h2>
            <button onclick="document.getElementById('bus-admin-modal').classList.add('hidden')" class="w-8 h-8 bg-white/20 rounded-full flex items-center justify-center"><i class="fas fa-times"></i></button>
        </div>
        <div class="p-2 flex gap-2 border-b bg-white shrink-0">
            <button onclick="filterBusAdmin('pending')" class="flex-1 py-2 bg-yellow-100 text-yellow-800 rounded text-xs font-bold border border-yellow-200">Pending</button>
            <button onclick="filterBusAdmin('active')" class="flex-1 py-2 bg-green-100 text-green-800 rounded text-xs font-bold border border-green-200">Active</button>
        </div>
        <div id="bus-admin-list" class="flex-1 overflow-y-auto p-3 space-y-3"></div>
    </div>

    <div id="my-tickets-modal" class="hidden absolute inset-0 z-[70] bg-white flex flex-col slide-up">
        <div class="bg-cyan-800 text-white p-4 flex justify-between items-center shadow-md">
            <h2 class="font-bold text-lg">My Tickets</h2>
            <button onclick="document.getElementById('my-tickets-modal').classList.add('hidden')" class="w-8 h-8 bg-white/20 rounded-full flex items-center justify-center"><i class="fas fa-times"></i></button>
        </div>
        <div id="my-tickets-list" class="flex-1 overflow-y-auto p-4 bg-gray-50 flex flex-col gap-3"></div>
    </div>

    <div id="company-dashboard-modal" class="hidden absolute inset-0 z-[70] bg-gray-50 flex flex-col slide-up">
        <div class="bg-indigo-900 text-white p-4 flex justify-between items-center shadow-md shrink-0">
            <div class="flex items-center gap-3">
                <h2 class="font-bold text-lg"><i class="fas fa-building mr-2 text-kivu-orange"></i>My Company</h2>
            </div>
            <div class="flex gap-2">
                <button onclick="openCompanyHistory()" class="bg-white/10 hover:bg-white/20 text-white text-xs font-bold px-3 py-1.5 rounded-lg border border-white/20 shadow-sm transition flex items-center gap-2">
                    <i class="fas fa-history text-kivu-gold"></i> History
                </button>
                <button onclick="document.getElementById('company-dashboard-modal').classList.add('hidden')" class="w-8 h-8 bg-white/20 rounded-full flex items-center justify-center"><i class="fas fa-times"></i></button>
            </div>
        </div>

        <div class="p-4 grid grid-cols-2 gap-3 shrink-0">
            <div class="bg-white p-3 rounded-xl shadow-sm border border-gray-100 col-span-2 flex justify-between items-center">
                <div>
                    <div class="text-[10px] text-gray-500 uppercase font-bold">Total Tickets Today</div>
                    <div class="text-2xl font-bold text-indigo-900 mt-1" id="dash-stats-count">0</div>
                </div>
                <div class="text-right">
                    <div class="text-[10px] text-gray-500 uppercase font-bold">Total Revenue</div>
                    <div class="text-xl font-bold text-gray-800" id="dash-stats-total">0 RWF</div>
                </div>
            </div>
            <div class="bg-green-50 p-3 rounded-xl shadow-sm border border-green-100">
                <div class="text-[9px] text-green-700 uppercase font-bold mb-1"><i class="fas fa-hand-holding-usd"></i> Cash in Hand</div>
                <div class="text-lg font-bold text-green-800" id="dash-stats-cash">0</div>
                <div class="text-[9px] text-green-600 opacity-80">Collect from agent</div>
            </div>
            <div class="bg-blue-50 p-3 rounded-xl shadow-sm border border-blue-100">
                <div class="text-[9px] text-blue-700 uppercase font-bold mb-1"><i class="fas fa-credit-card"></i> Digital / MoMo</div>
                <div class="text-lg font-bold text-blue-800" id="dash-stats-digital">0</div>
                <div class="text-[9px] text-blue-600 opacity-80">Bank Account</div>
            </div>
        </div>
        
        <div id="company-live-monitor" class="hidden px-4 py-4 bg-gray-100 border-t border-b border-gray-200 mt-2">
            <div class="flex justify-between items-center mb-3">
                <h3 class="font-bold text-gray-800 text-sm"><i class="fas fa-satellite-dish text-red-500 animate-pulse mr-2"></i>Live Seat Monitor</h3>
                <button onclick="closeMonitor()" class="text-xs text-gray-500 underline">Close Map</button>
            </div>
            <div id="admin-seat-map-container" class="bg-white p-4 rounded-xl shadow-inner border border-gray-300 flex justify-center"></div>
            <div id="passenger-info-display" class="mt-3 text-center text-xs text-gray-500 min-h-[20px]">Hover over a red seat to see passenger details</div>
        </div>
        <div id="company-routes-list" class="flex-1 overflow-y-auto p-4 space-y-3 pb-24"></div>
    </div>

    <div id="admin-route-manager" class="hidden absolute inset-0 z-[80] bg-gray-100 flex flex-col slide-up">
        <div class="bg-indigo-900 text-white p-4 flex justify-between items-center shadow-md shrink-0">
            <div>
                <h2 class="font-bold text-lg"><i class="fas fa-bus mr-2"></i>Trip Manager</h2>
                <p class="text-[10px] text-gray-400" id="adm-route-title">Route Control</p>
            </div>
            <div class="flex gap-2">
                <button onclick="printManifest()" class="bg-white/20 hover:bg-white/30 text-white px-3 py-1.5 rounded-lg text-xs font-bold flex items-center gap-2 border border-white/10 transition">
                    <i class="fas fa-print"></i> Manifest
                </button>
                <button onclick="closeRouteManager()" class="w-8 h-8 bg-white/20 rounded-full flex items-center justify-center hover:bg-red-500 transition"><i class="fas fa-times"></i></button>
            </div>
        </div>
        <div class="bg-white p-2 shadow-sm flex justify-center gap-4 text-xs font-bold text-gray-600 border-b">
            <span class="flex items-center gap-1"><div class="w-3 h-3 border-2 border-gray-300 rounded"></div> Free</span>
            <span class="flex items-center gap-1"><div class="w-3 h-3 bg-red-600 rounded"></div> Sold</span>
            <span class="flex items-center gap-1"><div class="w-3 h-3 bg-green-500 rounded"></div> Selected</span>
        </div>
        <div class="flex-1 overflow-y-auto p-6 flex justify-center bg-gray-50">
            <div id="pos-seat-map-container" class="bg-white p-6 rounded-2xl shadow-sm border border-gray-200 h-fit">Loading Map...</div>
        </div>
    </div>

    <div id="offline-sale-modal" class="hidden absolute inset-0 z-[90] bg-black/80 backdrop-blur-sm flex items-end justify-center fade-in">
        <div class="bg-white w-full rounded-t-2xl p-6 slide-up">
            <div class="flex justify-between items-center mb-4">
                <h3 class="font-bold text-xl text-gray-900">Sell Ticket (Cash)</h3>
                <button onclick="closeOfflineSale()" class="w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center"><i class="fas fa-times"></i></button>
            </div>
            <div class="bg-indigo-50 p-3 rounded-lg mb-4 flex justify-between items-center border border-indigo-100">
                <span class="text-sm font-bold text-indigo-900">Seat #<span id="pos-seat-num" class="text-xl"></span></span>
                <span class="text-sm font-bold text-green-600" id="pos-price">0 RWF</span>
            </div>
            <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Passenger Name</label>
            <input type="text" id="pos-name" class="w-full border border-gray-200 rounded-xl p-3 text-sm mb-3 font-bold" placeholder="e.g. John Doe">
            <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Phone Number</label>
            <input type="tel" id="pos-phone" class="w-full border border-gray-200 rounded-xl p-3 text-sm mb-3" placeholder="+250...">
            <label class="block text-xs font-bold text-gray-500 uppercase mb-2">ID / Passport (For Police)</label>
            <input type="text" id="pos-passport" class="w-full border border-gray-200 rounded-xl p-3 text-sm mb-6" placeholder="Document Number">
            <div class="flex flex-col gap-2">
                <div class="flex gap-2">
                    <button onclick="submitOfflineTicket('reserve')" class="flex-1 bg-yellow-500 text-white font-bold py-3 rounded-xl shadow-sm border-b-4 border-yellow-600 active:border-b-0 active:translate-y-1 transition">
                        <i class="far fa-clock"></i> Reserve
                    </button>
                    <button onclick="submitOfflineTicket('cash')" class="flex-[2] bg-green-600 text-white font-bold py-3 rounded-xl shadow-lg border-b-4 border-green-800 active:border-b-0 active:translate-y-1 transition flex justify-center items-center gap-2">
                        <i class="fas fa-money-bill-wave"></i> Cash
                    </button>
                </div>
                <button onclick="submitOfflineTicket('momo')" class="w-full bg-blue-600 text-white font-bold py-3 rounded-xl shadow-lg border-b-4 border-blue-800 active:border-b-0 active:translate-y-1 transition flex justify-center items-center gap-2">
                    <i class="fas fa-mobile-alt"></i> Paid via MoMo / Card
                </button>
            </div>
        </div>
    </div>

    <div id="company-history-modal" class="hidden absolute inset-0 z-[70] bg-gray-100 flex flex-col slide-up">
        <div class="bg-gray-900 text-white p-4 flex items-center gap-3 shadow-md shrink-0">
            <button onclick="document.getElementById('company-history-modal').classList.add('hidden')" class="w-8 h-8 rounded-full bg-white/20 flex items-center justify-center"><i class="fas fa-arrow-left"></i></button>
            <div>
                <h2 class="font-bold text-lg">Trip History</h2>
                <p class="text-[10px] text-gray-400">Financial Reports & Manifests</p>
            </div>
        </div>
        <div id="company-history-list" class="flex-1 overflow-y-auto p-4 space-y-3 pb-24"></div>
    </div>

    <div id="ticket-action-modal" class="hidden absolute inset-0 z-[110] bg-black/60 backdrop-blur-sm flex items-end justify-center fade-in">
        <div class="bg-white w-full max-w-md rounded-t-3xl p-6 shadow-2xl slide-up relative">
            <div class="w-12 h-1.5 bg-gray-300 rounded-full mx-auto mb-6"></div>
            <div class="mb-6 text-center">
                <div class="inline-block bg-gray-100 px-3 py-1 rounded-full text-xs font-bold text-gray-500 uppercase tracking-wide mb-2">
                    Seat #<span id="sheet-seat-num">00</span>
                </div>
                <h3 id="sheet-pax-name" class="text-2xl font-bold text-gray-900 mb-1">Passenger Name</h3>
                <p id="sheet-status" class="text-sm text-gray-500">Status: Valid</p>
            </div>
            <div class="space-y-3">
                <button onclick="executeAction('board')" class="w-full bg-emerald-600 hover:bg-emerald-700 active:scale-[0.98] text-white py-4 rounded-xl font-bold text-lg shadow-lg flex items-center justify-center gap-3 transition">
                    <i class="fas fa-check-circle text-2xl"></i>
                    <span id="btn-board-text">Check In (Board)</span>
                </button>
                <button onclick="executeAction('refund')" class="w-full bg-white border-2 border-red-100 hover:bg-red-50 text-red-500 py-4 rounded-xl font-bold text-lg flex items-center justify-center gap-3 transition active:scale-[0.98]">
                    <i class="fas fa-undo-alt"></i> Refund / Cancel
                </button>
                <button onclick="closeTicketActionSheet()" class="w-full bg-gray-100 text-gray-600 py-3 rounded-xl font-bold text-sm mt-2">Close</button>
            </div>
        </div>
    </div>

</div>
<div id="module-music" class="hidden h-full flex flex-col bg-gray-900 fixed inset-0 z-[60]">
    <div class="bg-gradient-to-b from-green-900 to-gray-900 p-4 pt-12 pb-6 shrink-0 relative">
    <div class="flex justify-between items-center relative z-10">
        <button onclick="closeSuperModule()" class="w-8 h-8 rounded-full bg-black/20 flex items-center justify-center text-white hover:bg-white/10"><i class="fas fa-chevron-down"></i></button>
        <h2 class="font-bold text-white tracking-widest text-xs uppercase">Kivu Vibe</h2>
        <button onclick="openMusicUpload()" class="w-8 h-8 rounded-full bg-black/20 flex items-center justify-center text-white"><i class="fas fa-plus"></i></button>
    </div>
    <h1 class="text-2xl font-bold text-white mt-4 mb-1">Made in Rwanda üá∑üáº</h1>
    
    <div class="flex items-center justify-between">
        <p class="text-xs text-gray-400">Top hits & local vibes</p>
        <button onclick="openMusicInfoModal()" class="bg-white/10 border border-white/20 text-white text-[10px] px-3 py-1 rounded-full font-bold hover:bg-white/20 transition flex items-center gap-1">
            <i class="fas fa-info-circle text-kivu-teal"></i> About Project
        </button>
    </div>
</div>

    <div class="px-4 py-2 flex gap-3 overflow-x-auto no-scrollbar bg-gray-900 shrink-0 border-b border-white/5">
    <button onclick="kivuAudio.loadLibrary()" class="bg-red-900/50 text-red-200 border border-red-500/30 px-4 py-1.5 rounded-full text-xs font-bold whitespace-nowrap">
        ‚ù§Ô∏è My Library
    </button>
    <button onclick="filterMusic('all')" class="bg-kivu-teal text-white px-4 py-1.5 rounded-full text-xs font-bold shadow-lg">üî• Top 50</button>
    <button onclick="filterMusic('army')" class="bg-gray-800 text-gray-300 px-4 py-1.5 rounded-full text-xs font-bold border border-gray-700">üá∑üáº Army</button>
    <button onclick="filterMusic('drill')" class="bg-gray-800 text-gray-300 px-4 py-1.5 rounded-full text-xs font-bold border border-gray-700">üé§ Drill</button>
    <button onclick="filterMusic('gospel')" class="bg-gray-800 text-gray-300 px-4 py-1.5 rounded-full text-xs font-bold border border-gray-700">‚õ™ Gospel</button>
</div>

    <div class="px-4 py-2 flex gap-3 overflow-x-auto no-scrollbar bg-gray-900 shrink-0">
        </div>

    <div id="music-admin-panel" class="hidden mx-4 mt-4 mb-2">
        <div class="bg-gray-800 border border-gray-700 rounded-xl overflow-hidden">
            <div class="bg-gray-700 p-3 flex justify-between items-center">
                <h3 class="text-white text-xs font-bold uppercase"><i class="fas fa-user-shield text-yellow-500 mr-2"></i> Requests (<span id="admin-pending-count">0</span>)</h3>
                <button onclick="fetchPendingTracks()" class="text-xs text-blue-400 hover:text-white"><i class="fas fa-sync"></i></button>
            </div>
            <div id="admin-pending-list" class="p-2 space-y-2 max-h-60 overflow-y-auto">
                <p class="text-center text-[10px] text-gray-500 py-2">No pending tracks</p>
            </div>
        </div>
    </div>
    <div id="music-feed" class="flex-1 overflow-y-auto p-4 pb-32 space-y-3 bg-gray-900">
    </div>

    <div id="mini-player" class="absolute bottom-0 left-0 w-full bg-gray-800 border-t border-white/10 p-3 pb-safe z-50 flex items-center gap-3 backdrop-blur-md bg-opacity-95 transform translate-y-full transition-transform duration-300">
    <img id="mini-player-img" src="" class="w-10 h-10 rounded bg-gray-700 object-cover">
    
    <div class="flex-1 min-w-0" onclick="toggleFullPlayer()"> 
        <h4 id="mini-music-title" class="text-white text-xs font-bold truncate">Select a song</h4>
        <p id="mini-player-artist" class="text-gray-400 text-[10px] truncate">...</p>
    </div>

    <div class="flex items-center gap-3 text-white">
        <button onclick="toggleMusicPlay()" class="w-8 h-8 rounded-full bg-white text-black flex items-center justify-center shadow-lg">
            <i id="mini-btn-icon" class="fas fa-play text-xs ml-0.5"></i>
        </button>
    </div>
    
    <div class="absolute top-0 left-0 w-full h-0.5 bg-gray-700">
        <div id="mini-player-progress" class="h-full bg-green-500 w-0 transition-all duration-1000"></div>
    </div>
</div>

<div id="sticky-player" class="fixed bottom-0 left-0 w-full bg-gray-900/95 backdrop-blur-md border-t border-white/10 p-3 pb-safe z-[200] flex items-center gap-3 transform translate-y-full transition-transform duration-300">
    <audio id="global-audio" preload="none"></audio>

    <img id="player-img" src="https://via.placeholder.com/50" class="w-10 h-10 rounded bg-gray-700 object-cover shadow-md">
    
    <div class="flex-1 min-w-0" onclick="toggleFullPlayer()">
        <h4 id="player-title" class="text-white text-xs font-bold truncate">Select a song</h4>
        <p id="player-artist" class="text-gray-400 text-[10px] truncate">Kivu Music</p>
    </div>

    <div class="flex items-center gap-4 text-white pr-2">
        <button onclick="kivuAudio.toggleLike()" class="text-gray-400 active:scale-125 transition"><i class="far fa-heart"></i></button>
        <button onclick="kivuAudio.togglePlay()" class="w-10 h-10 rounded-full bg-kivu-teal text-white flex items-center justify-center shadow-lg active:scale-90 transition">
            <i id="player-play-icon" class="fas fa-play ml-0.5"></i>
        </button>
    </div>
    
    <div class="absolute top-0 left-0 w-full h-0.5 bg-gray-700">
        <div id="player-progress" class="h-full bg-kivu-teal w-0 transition-all duration-300"></div>
    </div>
</div>

<div id="music-upload-modal" class="hidden fixed inset-0 z-[210] bg-black/90 backdrop-blur-sm flex items-center justify-center p-4">
    <div class="bg-gray-800 w-full max-w-sm rounded-2xl p-5 border border-white/10 shadow-2xl relative">
        <button onclick="closeMusicUpload()" class="absolute top-4 right-4 text-gray-400 hover:text-white"><i class="fas fa-times"></i></button>
        
        <h3 class="text-white font-bold text-lg mb-1">Become a Kivu Star üåü</h3>
        <p class="text-xs text-gray-400 mb-4">Submit your track. We review & publish to the world.</p>

        <div class="space-y-3">
            <div>
                <label class="text-[10px] text-gray-500 uppercase font-bold">Artist / Stage Name</label>
                <input type="text" id="up-artist" class="w-full bg-black/30 border border-white/10 rounded-lg p-3 text-white text-sm focus:border-kivu-teal outline-none" placeholder="e.g. MC Kigali">
            </div>
            
            <div>
                <label class="text-[10px] text-gray-500 uppercase font-bold">Song Title</label>
                <input type="text" id="up-title" class="w-full bg-black/30 border border-white/10 rounded-lg p-3 text-white text-sm focus:border-kivu-teal outline-none" placeholder="e.g. African Vibe">
            </div>

            <div>
                <label class="text-[10px] text-gray-500 uppercase font-bold">Genre</label>
                <select id="up-genre" class="w-full bg-black/30 border border-white/10 rounded-lg p-3 text-white text-sm outline-none">
                    <option value="vibe">üî• Vibe / Afro-Pop</option>
                    <option value="drill">üé§ Drill / Hip-Hop</option>
                    <option value="army">üá∑üáº Army / Patriotic</option>
                    <option value="gospel">‚õ™ Gospel</option>
                    <option value="wedding">üíç Wedding / Traditional</option>
                </select>
            </div>

            <div>
                <label class="text-[10px] text-gray-500 uppercase font-bold flex items-center gap-1">
                    Link to MP3 / Video <i class="fas fa-info-circle text-kivu-teal" onclick="alert('Upload your song to Google Drive, Dropbox, or YouTube. Copy the link and paste it here. We will download it!')"></i>
                </label>
                <input type="url" id="up-link" class="w-full bg-black/30 border border-white/10 rounded-lg p-3 text-white text-sm focus:border-kivu-teal outline-none" placeholder="https://drive.google.com/...">
                
                <div class="mt-2 p-2 bg-blue-900/30 border border-blue-500/30 rounded-lg flex gap-2 items-start">
                    <i class="fas fa-lightbulb text-yellow-400 text-xs mt-0.5"></i>
                    <p class="text-[9px] text-gray-300 leading-tight">
                        Do not upload files directly. Just paste a link from Google Drive, Instagram, or YouTube. We handle the rest.
                    </p>
                </div>
            </div>
            
            <div>
                <label class="text-[10px] text-gray-500 uppercase font-bold">Contact (WhatsApp / IG)</label>
                <textarea id="up-desc" rows="2" class="w-full bg-black/30 border border-white/10 rounded-lg p-3 text-white text-sm focus:border-kivu-teal outline-none" placeholder="+250... or @username"></textarea>
            </div>
        </div>

        <button onclick="submitMusicUpload()" class="w-full bg-gradient-to-r from-green-600 to-teal-600 text-white font-bold py-3 rounded-xl shadow-lg mt-6 active:scale-95 transition">
            Submit Request <i class="fas fa-paper-plane ml-2"></i>
        </button>
    </div>
</div>
<div id="song-info-modal" class="hidden fixed inset-0 z-[220] bg-black/90 backdrop-blur-sm flex items-end justify-center slide-up">
    <div class="bg-gray-900 w-full h-[80vh] rounded-t-3xl border-t border-white/10 flex flex-col relative">
        
        <div class="relative h-48 w-full shrink-0">
            <img id="info-modal-img" src="" class="w-full h-full object-cover opacity-60">
            <div class="absolute inset-0 bg-gradient-to-t from-gray-900 to-transparent"></div>
            <button onclick="document.getElementById('song-info-modal').classList.add('hidden')" class="absolute top-4 right-4 bg-black/50 text-white w-8 h-8 rounded-full flex items-center justify-center backdrop-blur-md z-10">
                <i class="fas fa-times"></i>
            </button>
            <div class="absolute bottom-4 left-4 right-4">
                <h2 id="info-modal-title" class="text-2xl font-bold text-white leading-tight mb-1">Title</h2>
                <p id="info-modal-artist" class="text-kivu-teal font-bold text-sm">Artist</p>
            </div>
        </div>

        <div class="flex-1 overflow-y-auto p-6">
            <h4 class="text-xs font-bold text-gray-500 uppercase mb-3">Lyrics / Description</h4>
            <p id="info-modal-desc" class="text-gray-300 text-sm leading-relaxed whitespace-pre-wrap font-medium">
                Loading...
            </p>
        </div>

        <div class="p-4 border-t border-white/10 bg-gray-900">
            <button onclick="shareTrack(document.getElementById('info-modal-title').innerText, document.getElementById('info-modal-artist').innerText)" class="w-full bg-green-600 text-white font-bold py-3 rounded-xl shadow-lg flex items-center justify-center gap-2">
                <i class="fab fa-whatsapp"></i> Share this Song
            </button>
        </div>
    </div>
</div>
<div id="edit-track-modal" class="hidden fixed inset-0 z-[230] bg-black/90 backdrop-blur-sm flex items-center justify-center p-4">
    <div class="bg-gray-800 w-full max-w-sm rounded-2xl p-5 border border-white/10 shadow-2xl relative">
        <button onclick="document.getElementById('edit-track-modal').classList.add('hidden')" class="absolute top-4 right-4 text-gray-400 hover:text-white"><i class="fas fa-times"></i></button>
        
        <h3 class="text-white font-bold text-lg mb-4">Edit Track</h3>
        <input type="hidden" id="edit-track-id">

        <div class="space-y-3">
            <div>
                <label class="text-[10px] text-gray-500 uppercase font-bold">Title</label>
                <input type="text" id="edit-title" class="w-full bg-black/30 border border-white/10 rounded-lg p-2 text-white text-xs font-bold" placeholder="Track Name">
            </div>

            <div>
                <label class="text-[10px] text-gray-500 uppercase font-bold">Genre</label>
                <select id="edit-genre" class="w-full bg-black/30 border border-white/10 rounded-lg p-2 text-white text-xs outline-none font-bold">
                    <option value="vibe">üî• Vibe / Afro-Pop</option>
                    <option value="drill">üé§ Drill / Hip-Hop</option>
                    <option value="army">üá∑üáº Army / Patriotic</option>
                    <option value="gospel">‚õ™ Gospel</option>
                    <option value="wedding">üíç Wedding / Traditional</option>
                </select>
            </div>

            <div>
                <label class="text-[10px] text-gray-500 uppercase font-bold">Cover Image URL</label>
                <input type="text" id="edit-cover" class="w-full bg-black/30 border border-white/10 rounded-lg p-2 text-white text-xs" placeholder="https://...">
            </div>
            
            <div>
                <label class="text-[10px] text-yellow-500 uppercase font-bold"><i class="fas fa-bolt"></i> Battle Group ID</label>
                <input type="text" id="edit-group" class="w-full bg-black/30 border border-yellow-500/30 rounded-lg p-2 text-white text-xs font-bold" placeholder="e.g. battle_1">
            </div>

            <div>
                <label class="text-[10px] text-gray-500 uppercase font-bold">Lyrics / Description</label>
                <textarea id="edit-desc" rows="3" class="w-full bg-black/30 border border-white/10 rounded-lg p-2 text-white text-xs" placeholder="Paste lyrics..."></textarea>
            </div>
        </div>

        <button onclick="saveTrackChanges()" class="w-full bg-blue-600 text-white font-bold py-3 rounded-xl shadow-lg mt-6 active:scale-95 transition">
            Save Changes
        </button>
    </div>
</div>
<div id="music-info-modal" class="hidden fixed inset-0 z-[250] bg-black/90 backdrop-blur-sm flex items-center justify-center p-6 fade-in">
    <div class="bg-gray-900 w-full max-w-sm rounded-2xl border border-white/10 shadow-2xl relative overflow-hidden">
        
        <div class="bg-gradient-to-r from-green-800 to-teal-900 p-4 text-white flex justify-between items-center">
            <h3 class="font-bold text-lg flex items-center gap-2"><i class="fas fa-robot"></i> Music Project</h3>
            <button onclick="document.getElementById('music-info-modal').classList.add('hidden')" class="w-8 h-8 bg-black/20 rounded-full flex items-center justify-center hover:bg-white/20 transition">
                <i class="fas fa-times"></i>
            </button>
        </div>

        <div class="p-6">
            <div id="music-info-display" class="text-sm text-gray-300 leading-relaxed whitespace-pre-wrap mb-4 font-medium">
                –ó–∞–≥—Ä—É–∑–∫–∞...
            </div>

            <div id="music-info-edit-box" class="hidden">
                <label class="text-[10px] text-gray-500 uppercase font-bold mb-1 block">Admin Editor</label>
                <textarea id="music-info-input" rows="6" class="w-full bg-black/30 border border-white/20 rounded-xl p-3 text-white text-sm focus:border-kivu-teal outline-none mb-3" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç..."></textarea>
                <button onclick="saveMusicInfoText()" class="w-full bg-kivu-teal text-white font-bold py-3 rounded-xl shadow-lg active:scale-95 transition">
                    –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
                </button>
            </div>
        </div>

    </div>
</div>
<div id="module-restricted" class="hidden h-full flex flex-col bg-gray-900 fixed inset-0 z-[60]">
    <div class="bg-black text-white p-4 flex justify-between items-center shadow-md shrink-0 z-20 relative">
        <div class="flex items-center gap-2">
            <h2 class="font-bold text-lg text-red-500 tracking-widest uppercase">Kivu Priv√©</h2>
            <span id="vip-status-badge" class="bg-gray-800 text-gray-400 text-[9px] px-2 py-0.5 rounded border border-gray-700">LOCKED</span>
        </div>
        <button onclick="closeSuperModule()" class="bg-white/10 w-8 h-8 rounded-full"><i class="fas fa-times"></i></button>
    </div>

    <div class="flex-1 relative overflow-hidden">
        
        <div id="restricted-blur-content" class="absolute inset-0 p-6 grid grid-cols-2 gap-4 content-start filter blur-md transition-all duration-1000 opacity-50 pointer-events-none">
            <div class="bg-gradient-to-br from-pink-600 to-purple-800 rounded-2xl p-4 h-40 flex flex-col justify-between items-center text-center shadow-lg border border-white/10">
                <i class="fas fa-heart text-4xl text-white drop-shadow-md"></i>
                <div>
                    <h3 class="font-bold text-white text-sm">Dating</h3>
                    <p class="text-[9px] text-white/70">Verified Models Only</p>
                </div>
            </div>
            
            <div class="bg-gradient-to-br from-yellow-600 to-yellow-800 rounded-2xl p-4 h-40 flex flex-col justify-between items-center text-center shadow-lg border border-white/10">
                <i class="fas fa-dice text-4xl text-white drop-shadow-md"></i>
                <div>
                    <h3 class="font-bold text-white text-sm">Casino</h3>
                    <p class="text-[9px] text-white/70">High Stakes Poker</p>
                </div>
            </div>

            <div class="bg-gradient-to-br from-green-600 to-green-900 rounded-2xl p-4 h-40 flex flex-col justify-between items-center text-center shadow-lg border border-white/10">
                <i class="fas fa-cannabis text-4xl text-white drop-shadow-md"></i>
                <div>
                    <h3 class="font-bold text-white text-sm">Green Shop</h3>
                    <p class="text-[9px] text-white/70">Medical Grade</p>
                </div>
            </div>

            <div class="bg-gradient-to-br from-blue-600 to-blue-900 rounded-2xl p-4 h-40 flex flex-col justify-between items-center text-center shadow-lg border border-white/10">
                <i class="fas fa-concierge-bell text-4xl text-white drop-shadow-md"></i>
                <div>
                    <h3 class="font-bold text-white text-sm">Concierge</h3>
                    <p class="text-[9px] text-white/70">24/7 Personal Agent</p>
                </div>
            </div>
        </div>

        <div id="restricted-lock-overlay" class="absolute inset-0 z-10 flex flex-col items-center justify-center bg-black/60 backdrop-blur-sm p-6 text-center">
            <div class="w-24 h-24 bg-red-600/20 rounded-full flex items-center justify-center mb-6 border-2 border-red-500 animate-pulse">
                <i class="fas fa-lock text-4xl text-red-500"></i>
            </div>
            <h1 class="text-2xl font-bold text-white mb-2">VIP Access Only</h1>
            <p class="text-gray-400 text-sm mb-8 leading-relaxed">
                This zone is restricted to verified members (21+). 
                <br>To unlock Dating, Gaming & More, you must pass a live video verification.
            </p>
            
            <button onclick="document.getElementById('verify-booking-modal').classList.remove('hidden')" class="w-full bg-gradient-to-r from-red-600 to-red-800 text-white font-bold py-4 rounded-xl shadow-[0_0_20px_rgba(220,38,38,0.5)] uppercase tracking-wider active:scale-95 transition">
                Book Video Verification
            </button>
            
            <button id="btn-verify-admin" onclick="openVerifyAdmin()" class="hidden mt-4 text-xs text-gray-500 underline">
                Admin: View Requests
            </button>
        </div>

        <div id="restricted-real-content" class="hidden absolute inset-0 z-10 p-4 pt-20 overflow-y-auto">
            <div class="grid grid-cols-2 gap-4">
                <div onclick="openSuperModule('dating')" class="bg-gray-800 p-6 rounded-xl flex flex-col items-center gap-2 cursor-pointer hover:bg-gray-700 border border-pink-500/30">
                    <i class="fas fa-heart text-3xl text-pink-500"></i>
                    <span class="text-white font-bold">Dating</span>
                </div>
                <div onclick="showToast('Connecting to Casino API...')" class="bg-gray-800 p-6 rounded-xl flex flex-col items-center gap-2 cursor-pointer hover:bg-gray-700 border border-yellow-500/30">
                    <i class="fas fa-dice text-3xl text-yellow-500"></i>
                    <span class="text-white font-bold">Casino</span>
                </div>
                <div onclick="showToast('Checking License...')" class="bg-gray-800 p-6 rounded-xl flex flex-col items-center gap-2 cursor-pointer hover:bg-gray-700 border border-green-500/30">
                    <i class="fas fa-cannabis text-3xl text-green-500"></i>
                    <span class="text-white font-bold">Green</span>
                </div>
                <div onclick="openAgentChat()" class="bg-gray-800 p-6 rounded-xl flex flex-col items-center gap-2 cursor-pointer hover:bg-gray-700 border border-blue-500/30">
                    <i class="fas fa-headset text-3xl text-blue-500"></i>
                    <span class="text-white font-bold">Support</span>
                </div>
            </div>
        </div>

    </div>

    <div id="verify-booking-modal" class="hidden absolute inset-0 z-[70] bg-black/90 flex flex-col justify-end">
        <div class="bg-gray-800 rounded-t-3xl p-6 slide-up w-full">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-white font-bold text-lg">Schedule Video Call</h3>
                <button onclick="document.getElementById('verify-booking-modal').classList.add('hidden')" class="text-gray-400"><i class="fas fa-times"></i></button>
            </div>
            
            <p class="text-gray-400 text-xs mb-4">Select a time for a 2-minute video call via WhatsApp to confirm your age and identity.</p>

            <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Date</label>
            <input type="date" id="verify-date" class="w-full bg-gray-900 border border-gray-700 text-white rounded p-3 mb-4">
            
            <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Time</label>
            <select id="verify-time" class="w-full bg-gray-900 border border-gray-700 text-white rounded p-3 mb-6">
                <option>09:00 - 10:00</option>
                <option>10:00 - 11:00</option>
                <option>14:00 - 15:00</option>
                <option>19:00 - 20:00</option>
                <option>21:00 - 22:00</option>
            </select>

            <button onclick="submitVerificationRequest()" class="w-full bg-red-600 text-white font-bold py-4 rounded-xl shadow-lg">Confirm Appointment</button>
        </div>
    </div>

    <div id="verify-admin-modal" class="hidden absolute inset-0 z-[70] bg-gray-100 flex flex-col slide-up">
        <div class="bg-gray-900 text-white p-4 flex justify-between items-center shadow-md">
            <h2 class="font-bold text-lg">Verification Requests</h2>
            <button onclick="document.getElementById('verify-admin-modal').classList.add('hidden')" class="w-8 h-8 bg-white/20 rounded-full flex items-center justify-center"><i class="fas fa-times"></i></button>
        </div>
        <div id="verify-requests-list" class="flex-1 overflow-y-auto p-3 space-y-3">
            </div>
    </div>
</div>
<div id="module-dating" class="hidden h-full flex flex-col bg-gray-50 fixed inset-0 z-[70]">
    <div class="bg-gradient-to-r from-pink-500 to-rose-600 text-white p-4 shadow-md shrink-0 flex justify-between items-center">
        <div class="flex items-center gap-2">
            <button onclick="openSuperModule('restricted')" class="w-8 h-8 bg-white/20 rounded-full flex items-center justify-center"><i class="fas fa-arrow-left"></i></button>
            <h2 class="font-bold text-lg italic">Kivu Match</h2>
        </div>
        <button onclick="showToast('Filter Settings')" class="text-white"><i class="fas fa-sliders-h"></i></button>
    </div>

    <div class="flex-1 relative overflow-hidden bg-gray-100">
        <div id="tinder-card" class="absolute inset-4 bottom-24 bg-white rounded-2xl shadow-xl overflow-hidden transform transition-all duration-300">
            <img id="date-img" src="" class="w-full h-full object-cover bg-gray-200">
            <div class="absolute bottom-0 left-0 w-full bg-gradient-to-t from-black/80 via-black/40 to-transparent p-6 pt-20 text-white">
                <h3 class="text-2xl font-bold mb-1 flex items-center gap-2">
                    <span id="date-name">Loading...</span> 
                    <i class="fas fa-check-circle text-blue-400 text-sm" title="ID Verified"></i>
                </h3>
                <p class="text-sm opacity-90 mb-2" id="date-dist">...</p>
                <div class="flex gap-2">
                    <span class="bg-white/20 px-2 py-1 rounded text-[10px] backdrop-blur-md">Travel ‚úàÔ∏è</span>
                    <span class="bg-white/20 px-2 py-1 rounded text-[10px] backdrop-blur-md">Music üéµ</span>
                </div>
            </div>
        </div>

        <div class="absolute bottom-6 left-0 w-full flex justify-center gap-6 z-30">
            <button onclick="swipe('left')" class="w-14 h-14 bg-white text-red-500 rounded-full shadow-lg flex items-center justify-center text-2xl hover:scale-110 transition border border-gray-100">
                <i class="fas fa-times"></i>
            </button>
            <button onclick="showToast('Super Like! ‚≠ê')" class="w-10 h-10 bg-white text-blue-500 rounded-full shadow flex items-center justify-center text-lg mt-2 hover:scale-110 transition">
                <i class="fas fa-star"></i>
            </button>
            <button onclick="swipe('right')" class="w-14 h-14 bg-pink-600 text-white rounded-full shadow-xl flex items-center justify-center text-2xl hover:scale-110 transition hover:bg-pink-700">
                <i class="fas fa-heart"></i>
            </button>
        </div>
    </div>
</div>
</div>
<div id="lightbox-modal" class="hidden fixed inset-0 z-[150] bg-black flex items-center justify-center fade-in touch-none">
    <button onclick="closeLightbox()" class="absolute top-4 right-4 text-white/80 hover:text-white text-3xl bg-black/30 w-10 h-10 rounded-full flex items-center justify-center z-[160] transition">
        <i class="fas fa-times"></i>
    </button>
    
    <div class="relative w-full h-full flex items-center justify-center">
        <button onclick="changeLightboxSlide(-1)" class="absolute left-2 z-[160] text-white/70 hover:text-white text-4xl p-4 drop-shadow-lg">
            <i class="fas fa-chevron-left"></i>
        </button>

        <img id="lightbox-img" src="" class="max-w-full max-h-full object-contain p-1 transition-transform duration-300 select-none">

        <button onclick="changeLightboxSlide(1)" class="absolute right-2 z-[160] text-white/70 hover:text-white text-4xl p-4 drop-shadow-lg">
            <i class="fas fa-chevron-right"></i>
        </button>
    </div>

    <div class="absolute bottom-6 left-1/2 transform -translate-x-1/2 bg-black/50 text-white px-3 py-1 rounded-full text-xs font-bold pointer-events-none backdrop-blur-sm">
        <span id="lightbox-counter">1 / 1</span>
    </div>
</div>
<div id="auth-modal" class="hidden fixed inset-0 z-[9999] bg-black/60 backdrop-blur-sm flex items-center justify-center p-4 fade-in">
    <div class="bg-white rounded-xl shadow-2xl w-full max-w-xs p-5 relative slide-up">
        <button onclick="toggleAuthModal()" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600"><i class="fas fa-times"></i></button>
        <h2 class="text-lg font-bold mb-4 text-kivu-teal">Authentication</h2>
        
        <div id="auth-success-msg" class="hidden text-center py-4">
            <div class="w-16 h-16 bg-green-100 text-green-500 rounded-full flex items-center justify-center mx-auto mb-3 text-2xl"><i class="fas fa-check"></i></div>
            <h3 class="font-bold text-lg mb-2">Success!</h3>
        </div>

        <div id="auth-forms">
            <div class="flex gap-2 mb-4">
                <button onclick="switchAuthTab('signin')" id="tab-signin" class="flex-1 py-2 rounded font-bold text-sm tab-active transition">Sign In</button>
                <button onclick="switchAuthTab('signup')" id="tab-signup" class="flex-1 py-2 rounded font-bold text-sm tab-inactive transition">Sign Up</button>
            </div>
            
            <div id="form-signin">
                <input type="email" id="signin-email" placeholder="Email" class="w-full border border-gray-200 rounded p-3 text-sm mb-3 focus:border-kivu-teal outline-none">
                <input type="password" id="signin-password" placeholder="Password" class="w-full border border-gray-200 rounded p-3 text-sm mb-4 focus:border-kivu-teal outline-none">
                <button onclick="handleSignIn()" class="w-full bg-kivu-teal text-white py-3 rounded-lg font-bold shadow-lg hover:bg-teal-700 transition">Sign In</button>
            </div>
            
            <div id="form-signup" class="hidden">
                <input type="text" id="signup-name" placeholder="Full Name" class="w-full border border-gray-200 rounded p-3 text-sm mb-3">
                <input type="email" id="signup-email" placeholder="Email" class="w-full border border-gray-200 rounded p-3 text-sm mb-3">
                
                <div class="flex gap-2 mb-3">
                    <select id="signup-country-code" class="w-[110px] shrink-0 border border-gray-200 rounded p-3 text-sm bg-white">
                        <option value="+250">üá∑üáº +250</option>
                        <option value="+254">üá∞üá™ +254</option>
                        <option value="+256">üá∫üá¨ +256</option>
                        <option value="+255">üáπüáø +255</option>
                        <option value="+257">üáßüáÆ +257</option>
                        <option value="+243">üá®üá© +243</option>
                        <option value="+251">üá™üáπ +251</option>
                    </select>
                    <input type="tel" id="signup-phone" placeholder="Phone (e.g. 788...)" class="flex-1 min-w-0 border border-gray-200 rounded p-3 text-sm">
                </div>

                <select id="signup-country-select" class="w-full border border-gray-200 rounded p-3 text-sm mb-3 bg-white" onchange="updateCitySelect('signup-city-select', this.value)">
                    <option value="" disabled selected>Select Country</option>
                    <option value="Rwanda">Rwanda</option>
                    <option value="Kenya">Kenya</option>
                    <option value="Uganda">Uganda</option>
                    <option value="Tanzania">Tanzania</option>
                    <option value="Burundi">Burundi</option>
                    <option value="DRC">DRC</option>
                    <option value="Ethiopia">Ethiopia</option>
                </select>
                <select id="signup-city-select" class="w-full border border-gray-200 rounded p-3 text-sm mb-3 bg-white"><option>Select City</option></select>
                
                <input type="password" id="signup-password" placeholder="Password" class="w-full border border-gray-200 rounded p-3 text-sm mb-4">
                
                <button onclick="handleSignUpOTP()" class="w-full bg-kivu-teal text-white py-3 rounded-lg font-bold shadow-lg hover:bg-teal-700 transition">Get Code</button>
            </div>

            <div id="form-verify-otp" class="hidden text-center pt-4">
                <div class="mb-4">
                    <i class="fas fa-envelope-open-text text-4xl text-kivu-teal mb-2"></i>
                    <p class="text-xs text-gray-500">We sent a code to <br><span id="otp-email-display" class="font-bold text-gray-800"></span></p>
                </div>
                
                <input type="text" id="otp-input" placeholder="123 456" maxlength="8" class="w-full border-2 border-kivu-teal rounded-xl p-4 text-center text-2xl font-bold tracking-[0.5em] mb-4 outline-none focus:ring-4 focus:ring-teal-100 transition">
                
                <button onclick="verifyEmailCode()" class="w-full bg-green-600 text-white py-3 rounded-lg font-bold shadow-lg hover:bg-green-700 transition mb-3">Verify & Login</button>
                
                <button onclick="switchAuthTab('signup'); document.getElementById('form-verify-otp').classList.add('hidden'); document.getElementById('form-signup').classList.remove('hidden');" class="text-xs text-gray-400 underline">Change Email / Back</button>
            </div>

        </div>
    </div>
</div>
<div id="event-details-modal" class="hidden fixed inset-0 z-[10000] flex items-end sm:items-center justify-center bg-black/80 backdrop-blur-sm p-4 animate-fade-in">
    <div class="bg-white w-full max-w-md rounded-3xl overflow-hidden shadow-2xl relative max-h-[90vh] flex flex-col">
        
        <div class="h-48 bg-gray-200 relative">
            <div id="view-ev-img-placeholder" class="w-full h-full flex items-center justify-center bg-gradient-to-br from-purple-500 to-pink-500 text-white text-4xl">
                <i class="fas fa-ticket-alt"></i>
            </div>
            <button onclick="document.getElementById('event-details-modal').classList.add('hidden')" class="absolute top-4 right-4 bg-black/50 text-white w-8 h-8 rounded-full flex items-center justify-center hover:bg-black/70 backdrop-blur-md">
                <i class="fas fa-times"></i>
            </button>
            <div id="view-ev-cat" class="absolute bottom-4 left-4 bg-white/90 px-3 py-1 rounded-full text-xs font-bold shadow-sm uppercase tracking-wide">
                Category
            </div>
        </div>

        <div class="p-6 overflow-y-auto">
            <div class="flex justify-between items-start mb-2">
                <h2 id="view-ev-title" class="text-2xl font-black text-gray-800 leading-tight">Event Title</h2>
                <div class="text-right">
                    <p id="view-ev-price" class="text-xl font-bold text-green-600">$0</p>
                </div>
            </div>

            <div id="view-ev-org" class="mb-4 p-3 bg-gray-50 rounded-xl border border-gray-100 flex justify-between items-center">
                </div>

            <div class="space-y-3 mb-6">
                <div class="flex items-center text-gray-600 gap-3">
                    <div class="w-8 h-8 rounded-full bg-blue-50 flex items-center justify-center text-blue-500"><i class="far fa-calendar-alt"></i></div>
                    <div>
                        <p class="text-xs text-gray-400">Date & Time</p>
                        <p id="view-ev-date" class="font-medium text-sm">Mon, 12 Oct ‚Ä¢ 19:00</p>
                    </div>
                </div>
                <div class="flex items-center text-gray-600 gap-3">
                    <div class="w-8 h-8 rounded-full bg-red-50 flex items-center justify-center text-red-500"><i class="fas fa-map-marker-alt"></i></div>
                    <div>
                        <p class="text-xs text-gray-400">Location</p>
                        <p id="view-ev-loc" class="font-medium text-sm">Kigali Heights</p>
                    </div>
                </div>
            </div>

            <div class="bg-gray-50 p-4 rounded-xl mb-6">
                <h3 class="font-bold text-sm mb-2 text-gray-700">Description</h3>
                <p id="view-ev-desc" class="text-sm text-gray-500 leading-relaxed overflow-y-auto max-h-32">No description provided.</p>
            </div>

            <button onclick="joinEvent()" class="w-full bg-black text-white py-4 rounded-xl font-bold text-lg shadow-lg active:scale-95 transition flex justify-center items-center gap-2">
                <i class="fas fa-ticket-alt"></i> Join Event
            </button>
        </div>
    </div>
</div>
<div id="modal-finance-wizard" class="hidden fixed inset-0 z-[110] bg-black/90 backdrop-blur-sm flex items-end justify-center fade-in">
    <div class="bg-white w-full max-w-md rounded-t-3xl p-6 slide-up max-h-[90vh] overflow-y-auto">
        
        <div id="wizard-step-1">
            <div class="flex justify-between items-center mb-6">
                <h3 class="font-bold text-xl text-gray-900">Select Service</h3>
                <button onclick="closeApplyWizard()" class="bg-gray-100 w-8 h-8 rounded-full flex items-center justify-center"><i class="fas fa-times"></i></button>
            </div>
            
            <div class="grid grid-cols-2 gap-3">
                <button onclick="wizardSelectType('loan')" class="p-4 bg-blue-50 border border-blue-100 rounded-xl flex flex-col items-center gap-2 hover:bg-blue-100 transition">
                    <div class="w-12 h-12 bg-blue-500 text-white rounded-full flex items-center justify-center text-xl"><i class="fas fa-hand-holding-usd"></i></div>
                    <span class="font-bold text-sm text-blue-900">Personal Loan</span>
                </button>
                <button onclick="wizardSelectType('mortgage')" class="p-4 bg-purple-50 border border-purple-100 rounded-xl flex flex-col items-center gap-2 hover:bg-purple-100 transition">
                    <div class="w-12 h-12 bg-purple-500 text-white rounded-full flex items-center justify-center text-xl"><i class="fas fa-home"></i></div>
                    <span class="font-bold text-sm text-purple-900">Mortgage</span>
                </button>
                <button onclick="wizardSelectType('exchange')" class="p-4 bg-green-50 border border-green-100 rounded-xl flex flex-col items-center gap-2 hover:bg-green-100 transition">
                    <div class="w-12 h-12 bg-green-500 text-white rounded-full flex items-center justify-center text-xl"><i class="fas fa-sync-alt"></i></div>
                    <span class="font-bold text-sm text-green-900">Currency Exch.</span>
                </button>
                <button onclick="wizardSelectType('insurance')" class="p-4 bg-orange-50 border border-orange-100 rounded-xl flex flex-col items-center gap-2 hover:bg-orange-100 transition">
                    <div class="w-12 h-12 bg-orange-500 text-white rounded-full flex items-center justify-center text-xl"><i class="fas fa-shield-alt"></i></div>
                    <span class="font-bold text-sm text-orange-900">Get Insurance</span>
                </button>
            </div>
        </div>

        <div id="wizard-step-2" class="hidden">
            <div class="flex items-center gap-3 mb-6">
                <button onclick="wizardBack()" class="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center"><i class="fas fa-arrow-left"></i></button>
                <h3 class="font-bold text-xl text-gray-900" id="wizard-title">Application</h3>
            </div>

            <form onsubmit="submitWizardForm(event)">
                <input type="hidden" id="wiz-type">
                <input type="hidden" id="wiz-branch-id"> <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Your Name</label>
                <input type="text" id="wiz-name" required class="w-full border border-gray-300 rounded-xl p-3 mb-4 bg-gray-50 font-bold">

                <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Phone Number</label>
                <input type="tel" id="wiz-phone" required class="w-full border border-gray-300 rounded-xl p-3 mb-4 bg-gray-50 font-bold">

                <div id="wiz-dynamic-fields" class="mb-6 space-y-3"></div>

                <button type="submit" class="w-full bg-emerald-600 text-white font-bold py-4 rounded-xl shadow-lg hover:bg-emerald-700 active:scale-95 transition">
                    Submit Application <i class="fas fa-paper-plane ml-2"></i>
                </button>
            </form>
        </div>
    </div>
</div>
<div id="pwa-lite-modal" class="hidden fixed inset-0 z-[9999] bg-black/90 backdrop-blur-sm flex items-center justify-center p-6 fade-in">
    <div class="bg-white w-full max-w-sm rounded-3xl p-6 text-center relative slide-up shadow-2xl border border-gray-100">
        
        <div class="w-20 h-20 bg-gray-50 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-inner border border-gray-100 relative">
            <img src="https://raw.githubusercontent.com/gefrd/site-images/main/favicon.png" class="w-12 h-12 object-contain animate-bounce" alt="App Icon">
            <div class="absolute -top-2 -right-2 bg-green-500 text-white text-[10px] font-bold px-2 py-1 rounded-full shadow-md border border-white transform rotate-12">
                < 1 MB
            </div>
        </div>

        <h3 class="text-xl font-black text-gray-900 mb-1 tracking-tight">Add Shortcut üöÄ</h3>
        <p class="text-xs text-gray-500 mb-5 font-medium leading-relaxed">
            Instant access. Zero storage used.<br>
            <span class="text-kivu-teal font-bold">It's just a lightweight icon!</span>
        </p>
        
        <div class="bg-gray-50 rounded-xl p-4 border border-gray-100 text-left space-y-4 mb-6">
            
            <div>
                <div class="text-[10px] font-bold text-gray-400 uppercase mb-1 flex items-center gap-1"><i class="fab fa-android text-green-600"></i> Android</div>
                <p class="text-sm text-gray-700 leading-snug">
                    Tap <span class="font-bold text-black"><i class="fas fa-ellipsis-v mx-1"></i> (Menu)</span> ‚ûù Select <span class="font-bold text-kivu-teal">Install App</span> or <span class="font-bold text-kivu-teal">Add to Home Screen</span>.
                </p>
            </div>

            <div class="h-px bg-gray-200 w-full"></div>

            <div>
                <div class="text-[10px] font-bold text-gray-400 uppercase mb-1 flex items-center gap-1"><i class="fab fa-apple text-black"></i> iPhone (iOS)</div>
                <p class="text-sm text-gray-700 leading-snug">
                    Tap <span class="font-bold text-blue-600"><i class="fas fa-share-square mx-1"></i> Share</span> ‚ûù Scroll down & select <span class="font-bold text-black"><i class="fas fa-plus-square mx-1"></i> Add to Home Screen</span>.
                </p>
            </div>

        </div>

        <button onclick="dismissPwaLite()" class="w-full bg-gray-900 text-white font-bold py-4 rounded-xl shadow-lg active:scale-95 transition flex items-center justify-center gap-2">
            <span>Okay, I'll do it!</span> <i class="fas fa-thumbs-up text-yellow-400"></i>
        </button>
        
        <button onclick="dismissPwaLite()" class="absolute top-4 right-4 text-gray-300 hover:text-gray-500 transition p-2">
            <i class="fas fa-times text-xl"></i>
        </button>
    </div>
</div>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
<script type="text/javascript">
   (function(){
      // –í–°–¢–ê–í–¨–¢–ï –°–Æ–î–ê –í–ê–® PUBLIC KEY –° –°–ê–ô–¢–ê EMAILJS
      emailjs.init("bLIvRPpE00mg2t7fi"); 
   })();
</script>
<script src="script.js"></script>
<script src="machinery.js" defer></script>
<script src="travel.js"></script>
<script src="music.js" defer></script>
<script src="lingo.js" defer></script>
<script src="kitchen.js" defer></script>
<script src="arcade.js" defer></script>
<script src="tools.js" defer></script>
<script src="streaming.js" defer></script>
<script src="player.js" defer></script>
<script src="gov.js" defer></script>
<script src="pay.js" defer></script>
<script src="investment.js" defer></script>
<script src="education.js" defer></script>
<script src="forum.js" defer></script>
<script src="banks.js" defer></script>
<script src="weather.js" defer></script>
<script src="vision.js" defer></script>
</body>
</html>